<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Training With Gradient Descent" name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Training with Gradient Descent | In Too Deep</title>
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../../rss.xml" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/In-Too-Deep/posts/nano/introduction-to-neural-networks/training-with-gradient-descent/" rel="canonical"><!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../../site.webmanifest" rel="manifest">
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
<meta content="Cloistered Monkey" name="author">
<link href="../gradient-descent-again/" rel="prev" title="Gradient Descent (Again)" type="text/html">
<link href="../multi-layer-perceptrons/" rel="next" title="Multi-Layer Perceptrons" type="text/html">
<meta content="In Too Deep" property="og:site_name">
<meta content="Training with Gradient Descent" property="og:title">
<meta content="https://necromuralist.github.io/In-Too-Deep/posts/nano/introduction-to-neural-networks/training-with-gradient-descent/" property="og:url">
<meta content="Training With Gradient Descent" property="og:description">
<meta content="article" property="og:type">
<meta content="2018-11-17T13:42:37-08:00" property="article:published_time">
<meta content="gradient descent" property="article:tag">
<meta content="lecture" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="https://necromuralist.github.io/In-Too-Deep/"><span id="blog-title">In Too Deep</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../../rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/In-Too-Deep/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Training with Gradient Descent</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2018-11-17T13:42:37-08:00" itemprop="datePublished" title="2018-11-17 13:42">2018-11-17 13:42</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org3f698af">Set Up</a></li>
<li><a href="#org6409453">The Data</a></li>
<li><a href="#org81edfbc">Pre-Processing the Data</a></li>
<li><a href="#org2a54343">The Error</a></li>
<li><a href="#orgb7a4a91">The General Training Algorithm</a></li>
<li><a href="#org208294c">The Numpy Implementation</a></li>
</ul>
</div>
</div>
<p>This is an example of implementing gradient descent to update the weights in a neural network.</p>
<div class="outline-2" id="outline-container-org3f698af">
<h2 id="org3f698af">Set Up</h2>
<div class="outline-text-2" id="text-org3f698af"></div>
<div class="outline-3" id="outline-container-orgf8f9079">
<h3 id="orgf8f9079">Imports</h3>
<div class="outline-text-3" id="text-orgf8f9079"></div>
<div class="outline-4" id="outline-container-org327e3a0">
<h4 id="org327e3a0">From PyPi</h4>
<div class="outline-text-4" id="text-org327e3a0">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">scale</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org37b1418">
<h4 id="org37b1418">This Project</h4>
<div class="outline-text-4" id="text-org37b1418">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.tangles.data_paths</span> <span class="kn">import</span> <span class="n">DataPath</span>
<span class="kn">from</span> <span class="nn">neurotic.tangles.helpers</span> <span class="kn">import</span> <span class="n">org_table</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgecf2fe4">
<h3 id="orgecf2fe4">Plotting</h3>
<div class="outline-text-3" id="text-orgecf2fe4">
<div class="highlight">
<pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">"whitegrid"</span><span class="p">,</span>
            <span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s2">"axes.grid"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s2">"font.family"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"sans-serif"</span><span class="p">],</span>
                <span class="s2">"font.sans-serif"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Latin Modern Sans"</span><span class="p">,</span> <span class="s2">"Lato"</span><span class="p">],</span>
                <span class="s2">"figure.figsize"</span><span class="p">:</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">)},</span>
            <span class="n">font_scale</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">FIGURE_SIZE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org6409453">
<h2 id="org6409453">The Data</h2>
<div class="outline-text-2" id="text-org6409453">
<p>We will use data originally take from the <a href="https://stats.idre.ucla.edu/">UCLA Institute for Digital Research and Education</a> (I couldn't find the dataset when I went to look for it). It has three features:</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Feature</th>
<th class="org-left" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>gre</code></td>
<td class="org-left">Graduate Record Exam score</td>
</tr>
<tr>
<td class="org-left"><code>gpa</code></td>
<td class="org-left">Grade Point Average</td>
</tr>
<tr>
<td class="org-left"><code>rank</code></td>
<td class="org-left">Rank of the undergraduate school</td>
</tr>
</tbody>
</table>
<p>The <code>rank</code> is a scale from 1 to 4, with 1 being the most prestigious school and 4 being the least.</p>
<p>It also has one output value - <code>admit</code> which indicates whether the student was admitted or not.</p>
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">DataPath</span><span class="p">(</span><span class="s2">"student_data.csv"</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">from_folder</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">org_table</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">admit</th>
<th class="org-right" scope="col">gre</th>
<th class="org-right" scope="col">gpa</th>
<th class="org-right" scope="col">rank</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">380</td>
<td class="org-right">3.61</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">660</td>
<td class="org-right">3.67</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">800</td>
<td class="org-right">4</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">640</td>
<td class="org-right">3.19</td>
<td class="org-right">4</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">520</td>
<td class="org-right">2.93</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
<pre class="example">
(400, 7)

</pre>
<p>So there are 400 applications - not a huge data set.</p>
<div class="highlight">
<pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">relplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"gpa"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"gre"</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">"admit"</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">"rank"</span><span class="p">,</span>
                       <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">title</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">"UCLA Student Admissions"</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="admissions.png" src="admissions.png"></p>
</div>
<p>It does look like the rank of the school matters, perhaps even more than scores.</p>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">"PuBuGn_d"</span><span class="p">):</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"rank"</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">"count"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                           <span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">12</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">"UCLA Student Submissions By Rank"</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="rank_distribution.png" src="rank_distribution.png"></p>
</div>
<p>So most of the applicants came from second and third-ranked schools.</p>
<div class="highlight">
<pre><span></span><span class="n">admitted</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">admit</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
<span class="k">with</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">"PuBuGn_d"</span><span class="p">):</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"rank"</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">"count"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">admitted</span><span class="p">,</span>
                           <span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">12</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">"UCLA Student Admissions By Rank"</span><span class="p">,</span>
                              <span class="n">weight</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">)</span>
</pre></div>
<p><img alt="admitted_ranks.png" src="admitted_ranks.png"> And it looks like most of the admitted were from first and second-ranked schools, with most coming from the second-ranked schools.</p>
<div class="highlight">
<pre><span></span><span class="n">admission_rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">admitted</span><span class="p">[</span><span class="s2">"rank"</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                  <span class="o">/</span><span class="n">data</span><span class="p">[</span><span class="s2">"rank"</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
<span class="n">admission_rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">admission_rate</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">admission_rate</span> <span class="o">=</span> <span class="n">admission_rate</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">admission_rate</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Rank"</span><span class="p">,</span> <span class="s2">"Percent Admitted"</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">org_table</span><span class="p">(</span><span class="n">admission_rate</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Rank</th>
<th class="org-right" scope="col">Percent Admitted</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">54.1</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">35.76</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">23.14</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">17.91</td>
</tr>
</tbody>
</table>
<p>So, even though the second-tier schools had the most admitted, the top-tier school was admitted at a higher rate.</p>
</div>
<div class="outline-3" id="outline-container-orgb215e5e">
<h3 id="orgb215e5e">Did GRE Matter?</h3>
<div class="outline-text-3" id="text-orgb215e5e">
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">"hls"</span><span class="p">):</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"rank"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"gre"</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">"admit"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                           <span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">12</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">"Admissions by School Rank"</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="gre_rank_admissions.png" src="gre_rank_admissions.png"></p>
</div>
<p>This one's a little tough to say, it looks like it's better to have a higher GRE, but once you get below 700 it isn't as clear, at least not to me.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org34aee81">
<h3 id="org34aee81">What about GPA?</h3>
<div class="outline-text-3" id="text-org34aee81">
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">"hls"</span><span class="p">):</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"rank"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"gpa"</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">"admit"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                           <span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">12</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">"Admissions by School Rank"</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="gpa_rank_admissions.png" src="gpa_rank_admissions.png"></p>
</div>
<p>This one seems even less demonstrative than GRE does.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org81edfbc">
<h2 id="org81edfbc">Pre-Processing the Data</h2>
<div class="outline-text-2" id="text-org81edfbc"></div>
<div class="outline-3" id="outline-container-org2cba93b">
<h3 id="org2cba93b">Dummy Variables</h3>
<div class="outline-text-3" id="text-org2cba93b">
<p>Since the <code>rank</code> values are ordinal, not numeric, we need to create some one-hot-encoded columns for it using <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.get_dummies.html">get_dummies</a>.</p>
<p>First I'll get some counts so I can double-check my work. Note to future self: <code>rank</code> is a pandas <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.rank.html">DataFrame method</a>, so naming a column 'rank' is probably not such a great idea.</p>
<div class="highlight">
<pre><span></span><span class="n">rank_counts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">"rank"</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"rank"</span><span class="p">],</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">"rank"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">rank_counts</span><span class="p">[</span><span class="n">rank</span><span class="p">]</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="s2">"rank_{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rank</span><span class="p">)]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">org_table</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">admit</th>
<th class="org-right" scope="col">gre</th>
<th class="org-right" scope="col">gpa</th>
<th class="org-right" scope="col">rank_1</th>
<th class="org-right" scope="col">rank_2</th>
<th class="org-right" scope="col">rank_3</th>
<th class="org-right" scope="col">rank_4</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">380</td>
<td class="org-right">3.61</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">660</td>
<td class="org-right">3.67</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">800</td>
<td class="org-right">4</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">640</td>
<td class="org-right">3.19</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">520</td>
<td class="org-right">2.93</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-3" id="outline-container-orgfac2949">
<h3 id="orgfac2949">Standardization</h3>
<div class="outline-text-3" id="text-orgfac2949">
<p>Now I'll convert the <code>gre</code> and <code>gpa</code> to have a mean of 0 and a variance of 1 using sklearn's <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.scale.html#sklearn.preprocessing.scale">scale</a> function.</p>
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">"gre"</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">gre</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float64"</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s2">"gpa"</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">gpa</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">org_table</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">admit</th>
<th class="org-right" scope="col">gre</th>
<th class="org-right" scope="col">gpa</th>
<th class="org-right" scope="col">rank_1</th>
<th class="org-right" scope="col">rank_2</th>
<th class="org-right" scope="col">rank_3</th>
<th class="org-right" scope="col">rank_4</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">-0.240093</td>
<td class="org-right">-0.394379</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.973373</td>
<td class="org-right">1.60514</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">-0.413445</td>
<td class="org-right">-0.0260464</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.106612</td>
<td class="org-right">-0.631165</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">-0.760149</td>
<td class="org-right">-1.52569</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">gre</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">gre</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">gpa</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">gpa</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">())</span>
</pre></div>
<pre class="example">
-0.0
1.0
0.0
1.0

</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org2a54343">
<h2 id="org2a54343">The Error</h2>
<div class="outline-text-2" id="text-org2a54343">
<p>For this we're going to use the Mean Square Error.</p>
<p>\[ E = \frac{1}{2m}\sum_{\mu} (y^{\mu} - \hat{y}^{\mu})^2 \]</p>
<p>This doesn't actually change our training, it just acts as an estimate of the error as we train so we can see that the model is getting better (hopefully).</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgb7a4a91">
<h2 id="orgb7a4a91">The General Training Algorithm</h2>
<div class="outline-text-2" id="text-orgb7a4a91">
<ul class="org-ul">
<li>Set the weight delta to 0 (\(\Delta w_i = 0\))</li>
<li>For each record in the training data:
<ul class="org-ul">
<li>Make a forward pass to get the output: \(\hat{y} = f\left(\sum_{i} w_i x_i \right)\)</li>
<li>Calculate the error: \(\delta = (y - \hat{y}) f'\left(\sum_i w_i x_i\right)\)</li>
<li>Update the weight delta: \(\Delta w_i = \Delta w_i + \delta x_i\)</li>
</ul>
</li>
<li>Update the weights : \(w_i = w_i + \eta \frac{\Delta w_i}{m}\)</li>
<li>Repeart for \(e\) epochs</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org208294c">
<h2 id="org208294c">The Numpy Implementation</h2>
<div class="outline-text-2" id="text-org208294c">
<p>I'm going to implement the previous algorithm using numpy.</p>
</div>
<div class="outline-3" id="outline-container-orgd8db8d0">
<h3 id="orgd8db8d0">Setting up the Data</h3>
<div class="outline-text-3" id="text-orgd8db8d0">
<p>We need to set up the training and testing data. The lecture uses numpy exclusively, but as with the standardization I'll cheat a little and use <a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html">sklearn</a>. The lecture uses a slightly different naming scheme from the one you normally see in the python machine learning community (e.g. <code>X_train</code>, <code>y_train</code>) which I'll stick with it so that I don't get errors just from using the wrong names. Truthfully, I kind of like these names better, although the use of the suffix <code>_test</code> without the use of the suffix <code>_train</code> seems confusing.</p>
<div class="highlight">
<pre><span></span><span class="n">features_all</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"admit"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
<span class="n">targets_all</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">admit</span>
</pre></div>
<p>The example given uses 10 % of the data for testing and 90% for training.</p>
<div class="highlight">
<pre><span></span><span class="n">features</span><span class="p">,</span> <span class="n">features_test</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">targets_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">features_all</span><span class="p">,</span> <span class="n">targets_all</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">features_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">targets_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
<pre class="example">
(360, 6)
(360,)
(40, 6)
(40,)

</pre></div>
</div>
<div class="outline-3" id="outline-container-org15b2f06">
<h3 id="org15b2f06">The Sigmoid</h3>
<div class="outline-text-3" id="text-org15b2f06">
<p>This is our activation function.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Calculate sigmoid</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">limit</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">limit</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">*</span><span class="n">limit</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"$\sigma(x)$"</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">"bold"</span><span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="sigmoid.png" src="sigmoid.png"></p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgeb6bfac">
<h3 id="orgeb6bfac">Some Setup</h3>
<div class="outline-text-3" id="text-orgeb6bfac">
<p>To make the outcome reproducible I'll set the random seed.</p>
<div class="highlight">
<pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
</pre></div>
<p>Now some variables need to be set up for the print output.</p>
<div class="highlight">
<pre><span></span><span class="n">n_records</span><span class="p">,</span> <span class="n">n_features</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">shape</span>
<span class="n">last_loss</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org8a3d49b">
<h3 id="org8a3d49b">Initialize weights</h3>
<div class="outline-text-3" id="text-org8a3d49b">
<p>We're going to use a normally distributed set of random weights to start with. The <code>scale</code> is the spread of the distribution we're sampling from. A rule-of-thumb for the spread is to use \(\frac{1}{\sqrt{n}}\) where <i>n</i> is the numeber of input units. This keeps the input to the sigmoid low, even as the number of inputs goes up.</p>
<div class="highlight">
<pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">n_features</span><span class="o">**.</span><span class="mi">5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_features</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgd870e60">
<h3 id="orgd870e60">Set Up The Learning</h3>
<div class="outline-text-3" id="text-orgd870e60">
<p>Now some neural network hyperparameters - how long do we train and how fast do we learn at each pass?</p>
<div class="highlight">
<pre><span></span><span class="n">epochs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">learnrate</span> <span class="o">=</span> <span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org418962d">
<h3 id="org418962d">The Training Loop</h3>
<div class="outline-text-3" id="text-org418962d">
<p>This is where we do the actual training (gradient descent).</p>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
    <span class="n">delta_weights</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">weights</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>

        <span class="n">error</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">output</span>

        <span class="n">error_term</span> <span class="o">=</span> <span class="n">error</span> <span class="o">*</span> <span class="p">(</span><span class="n">output</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">output</span><span class="p">))</span>

        <span class="n">delta_weights</span> <span class="o">+=</span> <span class="n">error_term</span> <span class="o">*</span> <span class="n">x</span>

    <span class="n">weights</span> <span class="o">+=</span> <span class="p">(</span><span class="n">learnrate</span> <span class="o">*</span> <span class="n">delta_weights</span><span class="p">)</span><span class="o">/</span><span class="n">n_records</span>

    <span class="c1"># Printing out the mean square error on the training set</span>
    <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="p">(</span><span class="n">epochs</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">weights</span><span class="p">))</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">out</span> <span class="o">-</span> <span class="n">targets</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">last_loss</span> <span class="ow">and</span> <span class="n">last_loss</span> <span class="o">&lt;</span> <span class="n">loss</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"Train loss: "</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="s2">"  WARNING - Loss Increasing"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"Train loss: "</span><span class="p">,</span> <span class="n">loss</span><span class="p">)</span>
        <span class="n">last_loss</span> <span class="o">=</span> <span class="n">loss</span>
</pre></div>
<pre class="example">
Train loss:  0.31403028569037034
Train loss:  0.20839043233748233
Train loss:  0.19937544110681996
Train loss:  0.19697280538767817
Train loss:  0.19607622516320752
Train loss:  0.19567788493090374
Train loss:  0.19548034981121246
Train loss:  0.19537454797678722
Train loss:  0.19531455174429538
Train loss:  0.19527902197312702
</pre></div>
</div>
<div class="outline-3" id="outline-container-org5e54273">
<h3 id="org5e54273">Testing</h3>
<div class="outline-text-3" id="text-org5e54273">
<p>Calculate accuracy on test data</p>
<div class="highlight">
<pre><span></span><span class="n">test_out</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">features_test</span><span class="p">,</span> <span class="n">weights</span><span class="p">))</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">test_out</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predictions</span> <span class="o">==</span> <span class="n">targets_test</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Prediction accuracy: {:.3f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">accuracy</span><span class="p">))</span>
</pre></div>
<pre class="example">
Prediction accuracy: 0.750

</pre>
<p>Not great, but then again, we had a fairly small data set to start with.</p>
</div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../../categories/gradient-descent/" rel="tag">gradient descent</a></li>
<li><a class="tag p-category" href="../../../../categories/lecture/" rel="tag">lecture</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../gradient-descent-again/" rel="prev" title="Gradient Descent (Again)">Previous post</a></li>
<li class="next"><a href="../multi-layer-perceptrons/" rel="next" title="Multi-Layer Perceptrons">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Contents Â© 2019 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script>
</body>
</html>
