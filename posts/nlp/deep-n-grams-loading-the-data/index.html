<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Loading the data and converting it to tensors." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Deep N-Grams: Loading the Data | Neurotic Networking</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/deep-n-grams-loading-the-data/index.html" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../deep-n-grams/index.html" rel="prev" title="Deep N-Grams" type="text/html">
<link href="../deep-n-grams-creating-the-model/index.html" rel="next" title="Deep N-Grams: Creating the Model" type="text/html">
<meta content="Neurotic Networking" property="og:site_name">
<meta content="Deep N-Grams: Loading the Data" property="og:title">
<meta content="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/deep-n-grams-loading-the-data/index.html" property="og:url">
<meta content="Loading the data and converting it to tensors." property="og:description">
<meta content="article" property="og:type">
<meta content="2021-01-05T16:47:30-08:00" property="article:published_time">
<meta content="gru" property="article:tag">
<meta content="n-grams" property="article:tag">
<meta content="nlp" property="article:tag">
<meta content="rnn" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../../"><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../pages/">Pages</a></li>
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Monkey Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">The Cloistered Monkey</a> <a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Bowling-For-Data/">Bowling For Data</a> <a class="dropdown-item" href="https://necromuralist.github.io/Beach-Pig-Thigh/">Beach-Pig Rump & Thigh</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href="#">Deep N-Grams: Loading the Data</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2021-01-05T16:47:30-08:00" itemprop="datePublished" title="2021-01-05 16:47">2021-01-05 16:47</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="index.html#org3a37a4e">Text to Tensor</a>
<ul>
<li><a href="index.html#org53428e7">Imports</a></li>
<li><a href="index.html#org4375192">Set Up</a></li>
</ul>
</li>
<li><a href="index.html#orgdf2c104">Middle</a>
<ul>
<li><a href="index.html#orga856870">Loading the Data</a></li>
<li><a href="index.html#org32c8ec8">To Tensors</a>
<ul>
<li><a href="index.html#org96f5ce1">Test the Output</a></li>
</ul>
</li>
<li><a href="index.html#orgd0657f4">Bundle It Up</a>
<ul>
<li><a href="index.html#org754ccd4">Imports</a></li>
<li><a href="index.html#org48b6aae">The Data Loader</a></li>
<li><a href="index.html#org3892341">The Data Path</a></li>
<li><a href="index.html#orge5231f9">The Lines</a></li>
<li><a href="index.html#org4ae3df5">The Training Set</a></li>
<li><a href="index.html#org75b7e3a">The Validation Set</a></li>
<li><a href="index.html#org04059a5">To Tensor</a></li>
</ul>
</li>
<li><a href="index.html#orgcccdee8">Check the Data Loader</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org3a37a4e">
<h2 id="org3a37a4e">Text to Tensor</h2>
<div class="outline-text-2" id="text-org3a37a4e">
<ul class="org-ul">
<li><a href="../deep-n-grams/index.html">Previous Post</a></li>
<li><a href="../deep-n-grams-batch-generation/index.html">Next Post</a></li>
</ul>
<p>In this section we're going to load the text data and transform it into tensors.</p>
</div>
<div class="outline-3" id="outline-container-org53428e7">
<h3 id="org53428e7">Imports</h3>
<div class="outline-text-3" id="text-org53428e7">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="p">(</span><span class="n">be_true</span><span class="p">,</span>
                     <span class="n">contain_exactly</span><span class="p">,</span>
                     <span class="n">equal</span><span class="p">,</span>
                     <span class="n">expect</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org4375192">
<h3 id="org4375192">Set Up</h3>
<div class="outline-text-3" id="text-org4375192">
<p>The path to the data is kept in a <code>.env</code> file so we'll load it into the environment here.</p>
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">"posts/nlp/.env"</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"SHAKESPEARE"</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">data_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgdf2c104">
<h2 id="orgdf2c104">Middle</h2>
<div class="outline-text-2" id="text-orgdf2c104"></div>
<div class="outline-3" id="outline-container-orga856870">
<h3 id="orga856870">Loading the Data</h3>
<div class="outline-text-3" id="text-orga856870">
<p>We're going to be using the plays of Shakespeare. Unlike previously, this data source has them in separate files so we'll have to load each one separately. We're going to be generating characters, not words, so each character has to be given an integer ID. We'll use the Unicode values given to us by the built-in <a href="https://docs.python.org/3/library/functions.html#ord">ord</a> function.</p>
<div class="highlight">
<pre><span></span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">data_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*.txt"</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">filename</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">play</span><span class="p">:</span>
        <span class="n">cleaned</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">play</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">cleaned</span> <span class="k">if</span> <span class="n">line</span><span class="p">]</span>
</pre></div>
<p>This only cleans out the leading and trailing whitespace, there are other things like tabs still in there.</p>
<div class="highlight">
<pre><span></span><span class="n">line_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of lines: </span><span class="si">{</span><span class="n">line_count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Sample line at position 0: </span><span class="si">{</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Sample line at position 999: </span><span class="si">{</span><span class="n">lines</span><span class="p">[</span><span class="mi">999</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Number of lines: 125,097
Sample line at position 0: king john
Sample line at position 999: as it makes harmful all that speak of it.
</pre>
<p>To make this a little easier, we'll convert all characters to lowercase. This way, for example, the model only needs to predict the likelihood that a letter is 'a' and not decide between uppercase 'A' and lowercase 'a'.</p>
<div class="highlight">
<pre><span></span><span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>

<span class="n">new_line_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">new_line_count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">line_count</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of lines: </span><span class="si">{</span><span class="n">new_line_count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Sample line at position 0: </span><span class="si">{</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Sample line at position 999: </span><span class="si">{</span><span class="n">lines</span><span class="p">[</span><span class="mi">999</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Number of lines: 125,097
Sample line at position 0: king john
Sample line at position 999: as it makes harmful all that speak of it.
</pre>
<p>Once again, we're gong to do a strait split to create the training and validation data instead of using randomization.</p>
<div class="highlight">
<pre><span></span><span class="n">SPLIT</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">validation</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="n">SPLIT</span><span class="p">:]</span>
<span class="n">training</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[:</span><span class="o">-</span><span class="n">SPLIT</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of lines for training: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">training</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of lines for validation: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">validation</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Number of lines for training: 124,097
Number of lines for validation: 1,000
</pre></div>
</div>
<div class="outline-3" id="outline-container-org32c8ec8">
<h3 id="org32c8ec8">To Tensors</h3>
<div class="outline-text-3" id="text-org32c8ec8">
<p>Like I mentioned before, we're going to use python's <code>ord</code> function to convert the letters to integers.</p>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="s2">"abc xyz123"</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">character</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">ord</span><span class="p">(</span><span class="n">character</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
a: 97
b: 98
c: 99
 : 32
x: 120
y: 121
z: 122
1: 49
2: 50
3: 51
</pre>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">line_to_tensor</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">EOS_int</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Turns a line of text into a tensor</span>

<span class="sd">    Args:</span>
<span class="sd">     line: A single line of text.</span>
<span class="sd">     EOS_int: End-of-sentence integer. Defaults to 1.</span>

<span class="sd">    Returns:</span>
<span class="sd">     a list of integers (unicode values) for the characters in the ``line``.</span>
<span class="sd">    """</span>
    <span class="n">tensor</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># for each character:</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>

        <span class="c1"># convert to unicode int</span>
        <span class="n">c_int</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="c1"># append the unicode integer to the tensor list</span>
        <span class="n">tensor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_int</span><span class="p">)</span>

    <span class="c1"># include the end-of-sentence integer</span>
    <span class="n">tensor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EOS_int</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tensor</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org96f5ce1">
<h4 id="org96f5ce1">Test the Output</h4>
<div class="outline-text-4" id="text-org96f5ce1">
<div class="highlight">
<pre><span></span><span class="n">actual</span> <span class="o">=</span> <span class="n">line_to_tensor</span><span class="p">(</span><span class="s1">'abc xyz'</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">97</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgd0657f4">
<h3 id="orgd0657f4">Bundle It Up</h3>
<div class="outline-text-3" id="text-orgd0657f4">
<p>This is going to be needed in future posts so I'm going to put it in a class.</p>
</div>
<div class="outline-4" id="outline-container-org754ccd4">
<h4 id="org754ccd4">Imports</h4>
<div class="outline-text-4" id="text-org754ccd4">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="kn">import</span> <span class="nn">attr</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org48b6aae">
<h4 id="org48b6aae">The Data Loader</h4>
<div class="outline-text-4" id="text-org48b6aae">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DataLoader</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Load the data and convert it to 'tensors'</span>

<span class="sd">    Args:</span>
<span class="sd">     env_path: the path to the env file (as a string)</span>
<span class="sd">     env_key: the environmental variable with the path to the data</span>
<span class="sd">     validation_size: number for the validation set</span>
<span class="sd">     end_of_sentence: integer to use to indicate the end of a sentence</span>
<span class="sd">    """</span>
    <span class="n">env_path</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">"posts/nlp/.env"</span>
    <span class="n">env_key</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">"SHAKESPEARE"</span>
    <span class="n">validation_size</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1000</span>
    <span class="n">end_of_sentence</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">_data_path</span><span class="p">:</span> <span class="n">Path</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_lines</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_training</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_validation</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org3892341">
<h4 id="org3892341">The Data Path</h4>
<div class="outline-text-4" id="text-org3892341">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">data_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Loads the dotenv and converts the path</span>

<span class="sd">    Raises:</span>
<span class="sd">     assertion error if path doesn't exist</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">load_dotenv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env_path</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">env_key</span><span class="p">])</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_path</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orge5231f9">
<h4 id="orge5231f9">The Lines</h4>
<div class="outline-text-4" id="text-orge5231f9">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">lines</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The lines of text-data"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*.txt"</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">filename</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">play</span><span class="p">:</span>
                <span class="n">cleaned</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">play</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span> <span class="o">+=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">cleaned</span> <span class="k">if</span> <span class="n">line</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org4ae3df5">
<h4 id="org4ae3df5">The Training Set</h4>
<div class="outline-text-4" id="text-org4ae3df5">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">training</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Subset of the lines for training"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_training</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_training</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_size</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_training</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org75b7e3a">
<h4 id="org75b7e3a">The Validation Set</h4>
<div class="outline-text-4" id="text-org75b7e3a">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The validation subset of the lines"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_size</span><span class="p">:]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org04059a5">
<h4 id="org04059a5">To Tensor</h4>
<div class="outline-text-4" id="text-org04059a5">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">to_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Converts the line to the unicode value</span>

<span class="sd">    Args:</span>
<span class="sd">     line: the text to convert</span>
<span class="sd">    Returns:</span>
<span class="sd">     line converted to unicode integer encodings</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">character</span><span class="p">)</span> <span class="k">for</span> <span class="n">character</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">end_of_sentence</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgcccdee8">
<h3 id="orgcccdee8">Check the Data Loader</h3>
<div class="outline-text-3" id="text-orgcccdee8">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.deep_rnn.data_loader</span> <span class="kn">import</span> <span class="n">DataLoader</span>

<span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">()</span>

<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">lines</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">line_count</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">validation</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">SPLIT</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">training</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">line_count</span> <span class="o">-</span> <span class="n">SPLIT</span><span class="p">))</span>

<span class="n">actual</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">to_tensor</span><span class="p">(</span><span class="s1">'abc xyz'</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">97</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">loader</span><span class="o">.</span><span class="n">lines</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
<pre class="example">
king john
dramatis personae
king john:
prince henry    son to the king.
arthur  duke of bretagne, nephew to the king.
the earl of
pembroke        (pembroke:)
the earl of essex       (essex:)
the earl of
salisbury       (salisbury:)
</pre></div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/gru/index.html" rel="tag">gru</a></li>
<li><a class="tag p-category" href="../../../categories/n-grams/index.html" rel="tag">n-grams</a></li>
<li><a class="tag p-category" href="../../../categories/nlp/index.html" rel="tag">nlp</a></li>
<li><a class="tag p-category" href="../../../categories/rnn/index.html" rel="tag">rnn</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../deep-n-grams/index.html" rel="prev" title="Deep N-Grams">Previous post</a></li>
<li class="next"><a href="../deep-n-grams-creating-the-model/index.html" rel="next" title="Deep N-Grams: Creating the Model">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Scribbles by <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
<div id="license" xmlns:cc="http://creativecommons.org/ns#">This work is licensed under <a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" rel="license noopener noreferrer" style="display:inline-block;" target="_blank">CC BY 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"></a></div>
</footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
