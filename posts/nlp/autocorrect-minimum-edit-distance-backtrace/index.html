<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Autocorrect: Minimum Edit Distance Backtrace | Neurotic Networking</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/autocorrect-minimum-edit-distance-backtrace/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../autocorrect-minimum-edit-distance/" rel="prev" title="Autocorrect: Minimum Edit Distance" type="text/html">
<meta content="Neurotic Networking" property="og:site_name">
<meta content="Autocorrect: Minimum Edit Distance Backtrace" property="og:title">
<meta content="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/autocorrect-minimum-edit-distance-backtrace/" property="og:url">
<meta content="Table of Contents Beginning Imports Set Up Plotting Tabulate Middle Backtrace Simple Examples Alignment A Little More Interesting Example Examples From Dan Jurasky Nucleotides Intention a" property="og:description">
<meta content="article" property="og:type">
<meta content="2020-11-11T14:47:04-08:00" property="article:published_time">
<meta content="autocorrect" property="article:tag">
<meta content="edit distance" property="article:tag">
<meta content="nlp" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="https://necromuralist.github.io/Neurotic-Networking/"><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Autocorrect: Minimum Edit Distance Backtrace</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2020-11-11T14:47:04-08:00" itemprop="datePublished" title="2020-11-11 14:47">2020-11-11 14:47</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgbef47ce">Beginning</a>
<ul>
<li><a href="#org30a1046">Imports</a></li>
<li><a href="#org2281e32">Set Up</a>
<ul>
<li><a href="#org9c6575a">Plotting</a></li>
<li><a href="#orgd3f3fb8">Tabulate</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orga984c00">Middle</a>
<ul>
<li><a href="#orgab5b815">Backtrace</a></li>
<li><a href="#org112e637">Simple Examples</a>
<ul>
<li><a href="#org30fe9f8">Alignment</a></li>
</ul>
</li>
<li><a href="#orgd61204d">A Little More Interesting Example</a></li>
<li><a href="#orgc326b34">Examples From Dan Jurasky</a>
<ul>
<li><a href="#orgd543a58">Nucleotides</a></li>
<li><a href="#orgb997cef">Intention and Execution</a></li>
</ul>
</li>
<li><a href="#orgf1b2ae8">What About Sentences?</a></li>
</ul>
</li>
<li><a href="#org5a43b7b">End</a>
<ul>
<li><a href="#orge01d0d7">NLTK</a></li>
<li><a href="#org8e47121">Bundling It Up</a>
<ul>
<li><a href="#orgac055b9">Imports</a></li>
<li><a href="#org402e605">The Aligner</a></li>
<li><a href="#org18ed60f">The Editor</a></li>
<li><a href="#org5381227">The Alignment Path</a></li>
<li><a href="#orgc4be0a0">Source Alignment</a></li>
<li><a href="#orged6a148">Target Alignment</a></li>
<li><a href="#org03eaed8">The Table</a></li>
<li><a href="#orgf545f47">The Call</a></li>
<li><a href="#orgf48f6e2">The String Representation</a></li>
</ul>
</li>
<li><a href="#org128920b">Test It</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgbef47ce">
<h2 id="orgbef47ce">Beginning</h2>
<div class="outline-text-2" id="text-orgbef47ce">
<p>This is the last post in a series about Autocorrect that's started in <a href="../autocorrect-the-system/">this post</a>. In the <a href="../autocorrect-minimum-edit-distance/">previous post</a> we implemented some code to find the minimum edit distance between two strings using Dynamic Programming. Now we'll implement the Backtrace Algorithim to find the shortest path through to transform one string to another.</p>
</div>
<div class="outline-3" id="outline-container-org30a1046">
<h3 id="org30a1046">Imports</h3>
<div class="outline-text-3" id="text-org30a1046">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">Namespace</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">ascii_uppercase</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">nltk.metrics.distance</span> <span class="kn">import</span> <span class="n">edit_distance_align</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">holoviews</span>
<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">seaborn</span>

<span class="c1"># this repository</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.autocorrect.distance</span> <span class="kn">import</span> <span class="n">MinimumEdits</span>

<span class="c1"># my other stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org2281e32">
<h3 id="org2281e32">Set Up</h3>
<div class="outline-text-3" id="text-org2281e32"></div>
<div class="outline-4" id="outline-container-org9c6575a">
<h4 id="org9c6575a">Plotting</h4>
<div class="outline-text-4" id="text-org9c6575a">
<p>This sets up some convenience code for plotting.</p>
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"autocorrect-minimum-edit-distance-backtrace"</span>
<span class="n">FOLDER</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"files/posts/nlp/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">/"</span> 
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="n">FOLDER</span><span class="p">)</span>

<span class="n">Plot</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">990</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">780</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">tan</span><span class="o">=</span><span class="s2">"#ddb377"</span><span class="p">,</span>
    <span class="n">blue</span><span class="o">=</span><span class="s2">"#4687b7"</span><span class="p">,</span>
    <span class="n">red</span><span class="o">=</span><span class="s2">"#ce7b6d"</span><span class="p">,</span>
    <span class="n">color_map</span><span class="o">=</span><span class="s2">"Plasma"</span><span class="p">,</span>
    <span class="n">path_color_map</span><span class="o">=</span><span class="s2">"blues"</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">'matplotlib'</span><span class="p">,</span> <span class="s1">'inline'</span><span class="p">)</span>
<span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">'config'</span><span class="p">,</span> <span class="s2">"InlineBackend.figure_format = 'retina'"</span><span class="p">)</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">"whitegrid"</span><span class="p">,</span>
            <span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s2">"axes.grid"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">"font.family"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"sans-serif"</span><span class="p">],</span>
                <span class="s2">"font.sans-serif"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Open Sans"</span><span class="p">,</span> <span class="s2">"Latin Modern Sans"</span><span class="p">,</span> <span class="s2">"Lato"</span><span class="p">],</span>
                <span class="s2">"figure.figsize"</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">)},</span>
            <span class="n">font_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">FIGURE_SIZE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgd3f3fb8">
<h4 id="orgd3f3fb8">Tabulate</h4>
<div class="outline-text-4" id="text-orgd3f3fb8">
<p>This sets up a pretty-printer for path-tables.</p>
<div class="highlight">
<pre><span></span><span class="n">PATH</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s2">"row"</span><span class="p">,</span> <span class="s2">"column"</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orga984c00">
<h2 id="orga984c00">Middle</h2>
<div class="outline-text-2" id="text-orga984c00"></div>
<div class="outline-3" id="outline-container-orgab5b815">
<h3 id="orgab5b815">Backtrace</h3>
<div class="outline-text-3" id="text-orgab5b815">
<p>The <i>backtrace algorithm</i> traces a path through a minimum-edit-distance table to help us to optimally align substrings. How? Let's break that question up. First, how do you do it? We'll just use a greedy search that minimizes the cost. Starting at the last cell in the table (the minimum edit distance cell) we look at the cells directly above, directly to the left, and directly diagonal to the cell and move to the one of those three that has the lowest cost. We keep doing this until we reach the origin (0,0) cell and then we reverse the order of the cells we visited.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">backtrace</span><span class="p">(</span><span class="n">distances</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""finds the path for string alignment using backtrace</span>

<span class="sd">    Args:</span>
<span class="sd">     distances: array of mimimum edit distances</span>
<span class="sd">    """</span>
    <span class="c1"># start at the bottom right cell</span>
    <span class="n">current_row</span><span class="p">,</span> <span class="n">current_column</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">path</span> <span class="o">=</span> <span class="p">[(</span><span class="n">current_row</span><span class="p">,</span> <span class="n">current_column</span><span class="p">)]</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">current_row</span><span class="p">,</span> <span class="n">current_column</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">one_row_back</span> <span class="o">=</span> <span class="n">current_row</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">one_column_up</span> <span class="o">=</span> <span class="n">current_column</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">edits</span> <span class="o">=</span> <span class="p">(</span>
            <span class="c1"># insert</span>
            <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">one_row_back</span><span class="p">,</span> <span class="n">current_column</span><span class="p">],</span> <span class="p">(</span><span class="n">one_row_back</span><span class="p">,</span> <span class="n">current_column</span><span class="p">)),</span>
            <span class="c1"># delete</span>
            <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">current_row</span><span class="p">,</span> <span class="n">one_column_up</span><span class="p">],</span> <span class="p">(</span><span class="n">current_row</span><span class="p">,</span> <span class="n">one_column_up</span><span class="p">)),</span>
            <span class="c1"># substitute</span>
            <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">one_row_back</span><span class="p">,</span> <span class="n">one_column_up</span><span class="p">],</span> <span class="p">(</span><span class="n">one_row_back</span><span class="p">,</span> <span class="n">one_column_up</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">minimum_edit_distance</span><span class="p">,</span> <span class="n">cell_coordinates</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">edits</span><span class="p">)</span>
        <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell_coordinates</span><span class="p">)</span>
        <span class="n">current_row</span><span class="p">,</span> <span class="n">current_column</span> <span class="o">=</span> <span class="n">cell_coordinates</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org112e637">
<h3 id="org112e637">Simple Examples</h3>
<div class="outline-text-3" id="text-org112e637"></div>
<ul class="org-ul">
<li><a id="org01c0da4"></a>One Letter<br>
<div class="outline-text-5" id="text-org01c0da4">
<p>We'll start with the simplest case, two strings with the same letter. Here's the distance table.</p>
<div class="highlight">
<pre><span></span><span class="n">editor</span> <span class="o">=</span> <span class="n">MinimumEdits</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">editor</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">#</th>
<th class="org-right" scope="col">a</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">#</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">a</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>
<p>And here's the path through the table.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">PATH</span><span class="p">(</span><span class="n">backtrace</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">distance_table</span><span class="p">)))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">row</th>
<th class="org-right" scope="col">column</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
<p>So, we start at the top-left and move to the bottom-right. Not too excitingâ€¦</p>
<p>Now let's try adding a second letter to the target word.</p>
<div class="highlight">
<pre><span></span><span class="n">editor</span> <span class="o">=</span> <span class="n">MinimumEdits</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"at"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">editor</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">#</th>
<th class="org-right" scope="col">a</th>
<th class="org-right" scope="col">t</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">#</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">a</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">backtrace</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">distance_table</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">PATH</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">row</th>
<th class="org-right" scope="col">column</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
<p>So we move from the top left then diagonally down and then laterally to the right. This gives us the first example of how the path is telling us to align the strings. Whenever the path moves horizontally (the row doesn't change) then that means you want to skip the character in the source.</p>
</div>
</li>
</ul>
<div class="outline-4" id="outline-container-org30fe9f8">
<h4 id="org30fe9f8">Alignment</h4>
<div class="outline-text-4" id="text-org30fe9f8">
<p>The rules for skipping characters as we move through the cells in the path are:</p>
<ol class="org-ol">
<li>If the current row is the same as the previous one, skip the character in the source, but add the character from the target.</li>
<li>If the current column is the same as the previous one, skip the character in the target but add the character from the source.</li>
</ol>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">alignment</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
              <span class="n">empty_token</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">"*"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Prints the alignment for the path</span>

<span class="sd">    Args:</span>
<span class="sd">     path: list of (row, column) tuples</span>
<span class="sd">     source: the source string</span>
<span class="sd">     target: the target string</span>
<span class="sd">     empty_token: token to insert for skipped characters</span>
<span class="sd">    """</span>
    <span class="n">previous_row</span> <span class="o">=</span> <span class="n">previous_column</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">source_tokens</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">target_tokens</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">empty_token</span> <span class="o">+</span> <span class="n">source</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">empty_token</span> <span class="o">+</span> <span class="n">target</span>
    <span class="k">for</span> <span class="n">current_row</span><span class="p">,</span> <span class="n">current_column</span> <span class="ow">in</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">source_token</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">current_row</span><span class="p">]</span> <span class="k">if</span> <span class="n">current_row</span> <span class="o">!=</span> <span class="n">previous_row</span> <span class="k">else</span> <span class="n">empty_token</span>
        <span class="n">target_token</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="n">current_column</span><span class="p">]</span> <span class="k">if</span> <span class="n">current_column</span> <span class="o">!=</span> <span class="n">previous_column</span> <span class="k">else</span> <span class="n">empty_token</span>

        <span class="n">source_tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">source_token</span><span class="p">)</span>
        <span class="n">target_tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_token</span><span class="p">)</span>

        <span class="n">previous_row</span><span class="p">,</span> <span class="n">previous_column</span> <span class="o">=</span> <span class="n">current_row</span><span class="p">,</span> <span class="n">current_column</span>

    <span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="p">(</span><span class="n">source_tokens</span><span class="p">,</span> <span class="n">target_tokens</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"|</span><span class="si">{</span><span class="s1">'|'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span><span class="si">}</span><span class="s2">|"</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
<p>Our alignment for the previous path looks like this.</p>
<div class="highlight">
<pre><span></span><span class="n">alignment</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">,</span> <span class="s2">"at"</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<tbody>
<tr>
<td class="org-left">a</td>
<td class="org-left">*</td>
</tr>
<tr>
<td class="org-left">a</td>
<td class="org-left">t</td>
</tr>
</tbody>
</table>
<p>Where the <code>*</code> means skip that character. Okay, that might be obvious, but what if we have to skip the first letter?</p>
<div class="highlight">
<pre><span></span><span class="n">editor</span> <span class="o">=</span> <span class="n">MinimumEdits</span><span class="p">(</span><span class="s2">"t"</span><span class="p">,</span> <span class="s2">"at"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">editor</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">#</th>
<th class="org-right" scope="col">a</th>
<th class="org-right" scope="col">t</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">#</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">t</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">backtrace</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">distance_table</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">PATH</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">row</th>
<th class="org-right" scope="col">column</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
<p>So in the first two cells the row doesn't change meaning that we skip the first letter in the source.</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<tbody>
<tr>
<td class="org-left">a</td>
<td class="org-left">t</td>
</tr>
<tr>
<td class="org-left">*</td>
<td class="org-left">t</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgd61204d">
<h3 id="orgd61204d">A Little More Interesting Example</h3>
<div class="outline-text-3" id="text-orgd61204d">
<p>Let's try a slightly more interesting example, aligning "drats" and "maths". First, the distance table.</p>
<div class="highlight">
<pre><span></span><span class="n">SOURCE</span><span class="p">,</span> <span class="n">TARGET</span> <span class="o">=</span> <span class="s2">"drats"</span><span class="p">,</span> <span class="s2">"maths"</span>
<span class="n">editor</span> <span class="o">=</span> <span class="n">MinimumEdits</span><span class="p">(</span><span class="n">SOURCE</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">editor</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">#</th>
<th class="org-right" scope="col">m</th>
<th class="org-right" scope="col">a</th>
<th class="org-right" scope="col">t</th>
<th class="org-right" scope="col">h</th>
<th class="org-right" scope="col">s</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">#</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
</tr>
<tr>
<td class="org-left">d</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-left">r</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">6</td>
<td class="org-right">7</td>
</tr>
<tr>
<td class="org-left">a</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-left">t</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">4</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
</tr>
<tr>
<td class="org-left">s</td>
<td class="org-right">5</td>
<td class="org-right">6</td>
<td class="org-right">5</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<p>Let's plot a heat map for it. If we plot the table as-is it ends up with the rows reversed, so we'll have to reverse the rows before plotting it.</p>
<div class="highlight">
<pre><span></span><span class="n">reversed_table</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">distance_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">plot</span> <span class="o">=</span> <span class="n">reversed_table</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">color_map</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Minimum Edit Distances"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">fontscale</span>
<span class="p">)</span>
<span class="n">plot</span> <span class="o">*=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Labels</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"drats_maths_distance_table"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="drats_maths_distance_table.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Now we can take a look at the path.</p>
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">backtrace</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">distance_table</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">PATH</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">row</th>
<th class="org-right" scope="col">column</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">4</td>
</tr>
<tr>
<td class="org-right">5</td>
<td class="org-right">5</td>
</tr>
</tbody>
</table>
<p>Now it's getting a little harder to see what's going on so let's plot the path along with the heatmap.</p>
<div class="highlight">
<pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">distance_table</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
    <span class="n">table</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">"#drats"</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">"#maths"</span><span class="p">))</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">path_plot</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">path_color_map</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Path For Alignment"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

<span class="n">distance_plot</span> <span class="o">=</span> <span class="n">reversed_table</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">color_map</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Minimum Edit Distances"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span>
<span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="p">(</span><span class="n">path_plot</span> <span class="o">+</span> <span class="n">distance_plot</span><span class="p">)</span><span class="o">.</span><span class="n">cols</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"drats_maths_alignment"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="drats_maths_alignment.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>In the top plot the dark-blue rectangles are the ones chosen by the backtrace and the lower plot is a heatmap of the distances for each cell in the distance-table. You can sort of see that the path matches the cooler (smaller distance) cells in the distance heat map as you work from the top-left cell to the bottom-right cell (the minimum edit distance).</p>
<p>To interpret the path: where the column repeats you skip a character in the target and where the row repeats you skip a character in the source so our alignment looks like this.</p>
<div class="highlight">
<pre><span></span><span class="n">alignment</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">SOURCE</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<tbody>
<tr>
<td class="org-left">d</td>
<td class="org-left">r</td>
<td class="org-left">a</td>
<td class="org-left">t</td>
<td class="org-left">*</td>
<td class="org-left">s</td>
</tr>
<tr>
<td class="org-left">*</td>
<td class="org-left">m</td>
<td class="org-left">a</td>
<td class="org-left">t</td>
<td class="org-left">h</td>
<td class="org-left">s</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-3" id="outline-container-orgc326b34">
<h3 id="orgc326b34">Examples From Dan Jurasky</h3>
<div class="outline-text-3" id="text-orgc326b34">
<p>These are examples from Dan Jurasky's <a href="https://web.stanford.edu/class/cs124/lec/med.pdf">CS 124 lecture slides</a>.</p>
</div>
<div class="outline-4" id="outline-container-orgd543a58">
<h4 id="orgd543a58">Nucleotides</h4>
<div class="outline-text-4" id="text-orgd543a58">
<p>Using the bokeh backend for heatmaps doesn't let you use column and index names that repeat, and I haven't figured out how to set x-ticks and y-ticks explicitly so I'll do it in matplotlib instead.</p>
<div class="highlight">
<pre><span></span><span class="n">HEIGHT</span><span class="p">,</span> <span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">1000</span>

<span class="n">SOURCE</span><span class="p">,</span> <span class="n">TARGET</span> <span class="o">=</span> <span class="s2">"AGGCTATCACCTGACCTCCAGGCCGATGCCC"</span><span class="p">,</span> <span class="s2">"TAGCTATCACGACCGCGGTCGATTTGCCCGAC"</span>
<span class="n">editor</span> <span class="o">=</span> <span class="n">MinimumEdits</span><span class="p">(</span><span class="n">SOURCE</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">backtrace</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">distance_table</span><span class="p">)</span>
</pre></div>
<p>The plotting didn't work for this set so I'm not showing it (it scrambled the order and reduced the number of characters).</p>
<div class="highlight">
<pre><span></span><span class="n">alignment</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">SOURCE</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<tbody>
<tr>
<td class="org-left">*</td>
<td class="org-left">A</td>
<td class="org-left">G</td>
<td class="org-left">G</td>
<td class="org-left">C</td>
<td class="org-left">T</td>
<td class="org-left">A</td>
<td class="org-left">T</td>
<td class="org-left">C</td>
<td class="org-left">A</td>
<td class="org-left">C</td>
<td class="org-left">C</td>
<td class="org-left">T</td>
<td class="org-left">G</td>
<td class="org-left">A</td>
<td class="org-left">C</td>
<td class="org-left">C</td>
<td class="org-left">T</td>
<td class="org-left">C</td>
<td class="org-left">C</td>
<td class="org-left">A</td>
<td class="org-left">G</td>
<td class="org-left">G</td>
<td class="org-left">*</td>
<td class="org-left">C</td>
<td class="org-left">C</td>
<td class="org-left">G</td>
<td class="org-left">A</td>
<td class="org-left">T</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">G</td>
<td class="org-left">C</td>
<td class="org-left">C</td>
<td class="org-left">C</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
</tr>
<tr>
<td class="org-left">T</td>
<td class="org-left">A</td>
<td class="org-left">G</td>
<td class="org-left">*</td>
<td class="org-left">C</td>
<td class="org-left">T</td>
<td class="org-left">A</td>
<td class="org-left">T</td>
<td class="org-left">C</td>
<td class="org-left">A</td>
<td class="org-left">C</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">G</td>
<td class="org-left">A</td>
<td class="org-left">C</td>
<td class="org-left">C</td>
<td class="org-left">G</td>
<td class="org-left">C</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">G</td>
<td class="org-left">G</td>
<td class="org-left">T</td>
<td class="org-left">C</td>
<td class="org-left">*</td>
<td class="org-left">G</td>
<td class="org-left">A</td>
<td class="org-left">T</td>
<td class="org-left">T</td>
<td class="org-left">T</td>
<td class="org-left">G</td>
<td class="org-left">C</td>
<td class="org-left">C</td>
<td class="org-left">C</td>
<td class="org-left">G</td>
<td class="org-left">A</td>
<td class="org-left">C</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-orgb997cef">
<h4 id="orgb997cef">Intention and Execution</h4>
<div class="outline-text-4" id="text-orgb997cef">
<div class="highlight">
<pre><span></span><span class="n">SOURCE</span><span class="p">,</span> <span class="n">TARGET</span> <span class="o">=</span> <span class="s2">"INTENTION"</span><span class="p">,</span> <span class="s2">"EXECUTION"</span>
<span class="n">editor</span> <span class="o">=</span> <span class="n">MinimumEdits</span><span class="p">(</span><span class="n">SOURCE</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">backtrace</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">distance_table</span><span class="p">)</span>
<span class="n">alignment</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">SOURCE</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<tbody>
<tr>
<td class="org-left">I</td>
<td class="org-left">N</td>
<td class="org-left">T</td>
<td class="org-left">E</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">N</td>
<td class="org-left">T</td>
<td class="org-left">I</td>
<td class="org-left">O</td>
<td class="org-left">N</td>
</tr>
<tr>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">E</td>
<td class="org-left">X</td>
<td class="org-left">E</td>
<td class="org-left">C</td>
<td class="org-left">U</td>
<td class="org-left">T</td>
<td class="org-left">I</td>
<td class="org-left">O</td>
<td class="org-left">N</td>
</tr>
</tbody>
</table>
<p>The output given by the presentation is</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<tbody>
<tr>
<td class="org-left">I</td>
<td class="org-left">N</td>
<td class="org-left">T</td>
<td class="org-left">E</td>
<td class="org-left">*</td>
<td class="org-left">N</td>
<td class="org-left">T</td>
<td class="org-left">I</td>
<td class="org-left">O</td>
<td class="org-left">N</td>
</tr>
<tr>
<td class="org-left">*</td>
<td class="org-left">E</td>
<td class="org-left">X</td>
<td class="org-left">E</td>
<td class="org-left">C</td>
<td class="org-left">U</td>
<td class="org-left">T</td>
<td class="org-left">I</td>
<td class="org-left">O</td>
<td class="org-left">N</td>
</tr>
</tbody>
</table>
<p>But I can't find anyplace where he documents how he derives these alignments so I don't know how to get this form.</p>
<div class="highlight">
<pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">distance_frame</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
<span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">FOLDER</span> <span class="o">+</span> <span class="s2">"intention.png"</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="intention.png" src="intention.png"></p>
</div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgf1b2ae8">
<h3 id="orgf1b2ae8">What About Sentences?</h3>
<div class="outline-text-3" id="text-orgf1b2ae8">
<div class="highlight">
<pre><span></span><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">"he was big and bold and tall but old"</span>
<span class="n">TARGET</span> <span class="o">=</span> <span class="s2">"he is big i'm told but old"</span>
<span class="n">editor</span> <span class="o">=</span> <span class="n">MinimumEdits</span><span class="p">(</span><span class="n">SOURCE</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">backtrace</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">distance_table</span><span class="p">)</span>
<span class="n">alignment</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">SOURCE</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<tbody>
<tr>
<td class="org-left">h</td>
<td class="org-left">e</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">w</td>
<td class="org-left">a</td>
<td class="org-left">s</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">b</td>
<td class="org-left">i</td>
<td class="org-left">g</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">a</td>
<td class="org-left">n</td>
<td class="org-left">d</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">b</td>
<td class="org-left">o</td>
<td class="org-left">l</td>
<td class="org-left">d</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">a</td>
<td class="org-left">n</td>
<td class="org-left">d</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">t</td>
<td class="org-left">a</td>
<td class="org-left">l</td>
<td class="org-left">l</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">b</td>
<td class="org-left">u</td>
<td class="org-left">t</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">o</td>
<td class="org-left">l</td>
<td class="org-left">d</td>
</tr>
<tr>
<td class="org-left">h</td>
<td class="org-left">e</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">*</td>
<td class="org-left">i</td>
<td class="org-left">s</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">b</td>
<td class="org-left">i</td>
<td class="org-left">g</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">i</td>
<td class="org-left">'</td>
<td class="org-left">m</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">t</td>
<td class="org-left">o</td>
<td class="org-left">l</td>
<td class="org-left">d</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">*</td>
<td class="org-left">b</td>
<td class="org-left">u</td>
<td class="org-left">t</td>
<td class="org-left">&nbsp;</td>
<td class="org-left">o</td>
<td class="org-left">l</td>
<td class="org-left">d</td>
</tr>
</tbody>
</table>
<p>Sort of, but I'm sure that's not the right way to do it.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org5a43b7b">
<h2 id="org5a43b7b">End</h2>
<div class="outline-text-2" id="text-org5a43b7b"></div>
<div class="outline-3" id="outline-container-orge01d0d7">
<h3 id="orge01d0d7">NLTK</h3>
<div class="outline-text-3" id="text-orge01d0d7">
<p>The NLTK has a function that will get the path for us. It sort of hides the table from us (there's a private(ish) function that you can call to make the path if you have the table, otherwise they build the table and return the path). I couldn't find a direct link to it, but the it's in the <a href="https://www.nltk.org/api/nltk.metrics.html">metrics.distance</a> module and is called <code>edit_distance_align</code>.</p>
<p>Let's see what it does with our last example.</p>
<div class="highlight">
<pre><span></span><span class="n">nltk_path</span> <span class="o">=</span> <span class="n">edit_distance_align</span><span class="p">(</span><span class="s2">"drats"</span><span class="p">,</span> <span class="s2">"maths"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"|Ours| NLTK's|"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"|-+-|"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">theirs</span><span class="p">,</span> <span class="n">ours</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">nltk_path</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"|</span><span class="si">{</span><span class="n">ours</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">theirs</span><span class="si">}</span><span class="s2">|"</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Ours</th>
<th class="org-left" scope="col">NLTK's</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">(0, 0)</td>
<td class="org-left">(0, 0)</td>
</tr>
<tr>
<td class="org-left">(1, 1)</td>
<td class="org-left">(1, 0)</td>
</tr>
<tr>
<td class="org-left">(2, 2)</td>
<td class="org-left">(2, 1)</td>
</tr>
<tr>
<td class="org-left">(3, 2)</td>
<td class="org-left">(3, 2)</td>
</tr>
<tr>
<td class="org-left">(4, 3)</td>
<td class="org-left">(4, 3)</td>
</tr>
<tr>
<td class="org-left">(5, 4)</td>
<td class="org-left">(4, 4)</td>
</tr>
<tr>
<td class="org-left">(5, 5)</td>
<td class="org-left">(5, 5)</td>
</tr>
</tbody>
</table>
<p>So, you can see that ours doesn't really agree with theirs - which one of us is wrong?</p>
<div class="highlight">
<pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">edit_distance_align</span><span class="p">)</span>
</pre></div>
<pre class="example">
Help on function edit_distance_align in module nltk.metrics.distance:

edit_distance_align(s1, s2, substitution_cost=1)
    Calculate the minimum Levenshtein edit-distance based alignment
    mapping between two strings. The alignment finds the mapping
    from string s1 to s2 that minimizes the edit distance cost.
    For example, mapping "rain" to "shine" would involve 2
    substitutions, 2 matches and an insertion resulting in
    the following mapping:
    [(0, 0), (1, 1), (2, 2), (3, 3), (4, 4), (4, 5)]
    NB: (0, 0) is the start state without any letters associated
    See more: https://web.stanford.edu/class/cs124/lec/med.pdf
    
    In case of multiple valid minimum-distance alignments, the
    backtrace has the following operation precedence:
    1. Skip s1 character
    2. Skip s2 character
    3. Substitute s1 and s2 characters
    The backtrace is carried out in reverse string order.
    
    This function does not support transposition.
    
    :param s1, s2: The strings to be aligned
    :type s1: str
    :type s2: str
    :type substitution_cost: int
    :rtype List[Tuple(int, int)]
</pre>
<p>Well, it looks like their substitution cost is 1 by default, not 2 like we're using. Take two.</p>
<div class="highlight">
<pre><span></span><span class="n">nltk_align</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">edit_distance_align</span><span class="p">,</span> <span class="n">substitution_cost</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">nltk_path</span> <span class="o">=</span> <span class="n">nltk_align</span><span class="p">(</span><span class="s2">"drats"</span><span class="p">,</span> <span class="s2">"maths"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"|Ours| NLTK's|"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"|-+-|"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ours</span><span class="p">,</span> <span class="n">theirs</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">nltk_path</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"|</span><span class="si">{</span><span class="n">ours</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">theirs</span><span class="si">}</span><span class="s2">|"</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">ours</span> <span class="o">==</span> <span class="n">theirs</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Ours</th>
<th class="org-left" scope="col">NLTK's</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">(0, 0)</td>
<td class="org-left">(0, 0)</td>
</tr>
<tr>
<td class="org-left">(1, 0)</td>
<td class="org-left">(1, 0)</td>
</tr>
<tr>
<td class="org-left">(2, 1)</td>
<td class="org-left">(2, 1)</td>
</tr>
<tr>
<td class="org-left">(3, 2)</td>
<td class="org-left">(3, 2)</td>
</tr>
<tr>
<td class="org-left">(4, 3)</td>
<td class="org-left">(4, 3)</td>
</tr>
<tr>
<td class="org-left">(4, 4)</td>
<td class="org-left">(4, 4)</td>
</tr>
<tr>
<td class="org-left">(5, 5)</td>
<td class="org-left">(5, 5)</td>
</tr>
</tbody>
</table>
<p>So, if we're wrong, we're at least as wrong as NLTK is. Maybe.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org8e47121">
<h3 id="org8e47121">Bundling It Up</h3>
<div class="outline-text-3" id="text-org8e47121"></div>
<div class="outline-4" id="outline-container-orgac055b9">
<h4 id="orgac055b9">Imports</h4>
<div class="outline-text-4" id="text-orgac055b9">
<div class="highlight">
<pre><span></span><span class="c1"># from pypi</span>
<span class="kn">import</span> <span class="nn">attr</span>

<span class="c1"># this repo</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.autocorrect.distance</span> <span class="kn">import</span> <span class="n">MinimumEdits</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org402e605">
<h4 id="org402e605">The Aligner</h4>
<div class="outline-text-4" id="text-org402e605">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Aligner</span><span class="p">:</span>
    <span class="sd">"""Create the alignment path</span>

<span class="sd">    Args: </span>
<span class="sd">     source: the source string to align</span>
<span class="sd">     target: the target string to align</span>
<span class="sd">     empty_token: character to use to fill in alignments</span>
<span class="sd">    """</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">target</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">empty_token</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">"*"</span>
    <span class="n">_source_alignment</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_target_alignment</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_table</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_editor</span><span class="p">:</span> <span class="n">MinimumEdits</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_path</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org18ed60f">
<h4 id="org18ed60f">The Editor</h4>
<div class="outline-text-4" id="text-org18ed60f">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">editor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MinimumEdits</span><span class="p">:</span>
    <span class="sd">"""object to figure out the minimum edit distance"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_editor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_editor</span> <span class="o">=</span> <span class="n">MinimumEdits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_editor</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org5381227">
<h4 id="org5381227">The Alignment Path</h4>
<div class="outline-text-4" id="text-org5381227">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""An optimal path through the distance table"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">distance_table</span>
        <span class="c1"># start at the bottom right cell</span>
        <span class="n">current_row</span><span class="p">,</span> <span class="n">current_column</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                       <span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[(</span><span class="n">current_row</span><span class="p">,</span> <span class="n">current_column</span><span class="p">)]</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">current_row</span><span class="p">,</span> <span class="n">current_column</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">one_row_back</span> <span class="o">=</span> <span class="n">current_row</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">one_column_up</span> <span class="o">=</span> <span class="n">current_column</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">edits</span> <span class="o">=</span> <span class="p">(</span>
                <span class="c1"># insert</span>
                <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">one_row_back</span><span class="p">,</span> <span class="n">current_column</span><span class="p">],</span> <span class="p">(</span><span class="n">one_row_back</span><span class="p">,</span> <span class="n">current_column</span><span class="p">)),</span>
                <span class="c1"># delete</span>
                <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">current_row</span><span class="p">,</span> <span class="n">one_column_up</span><span class="p">],</span> <span class="p">(</span><span class="n">current_row</span><span class="p">,</span> <span class="n">one_column_up</span><span class="p">)),</span>
                <span class="c1"># substitute</span>
                <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">one_row_back</span><span class="p">,</span> <span class="n">one_column_up</span><span class="p">],</span> <span class="p">(</span><span class="n">one_row_back</span><span class="p">,</span> <span class="n">one_column_up</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">minimum_edit_distance</span><span class="p">,</span> <span class="n">cell_coordinates</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">edits</span><span class="p">)</span>
            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell_coordinates</span><span class="p">)</span>
            <span class="n">current_row</span><span class="p">,</span> <span class="n">current_column</span> <span class="o">=</span> <span class="n">cell_coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgc4be0a0">
<h4 id="orgc4be0a0">Source Alignment</h4>
<div class="outline-text-4" id="text-orgc4be0a0">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">source_alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""the aligned source tokens</span>

<span class="sd">    Warning:</span>
<span class="sd">     this doesn't create them, call the object to do that</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_alignment</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orged6a148">
<h4 id="orged6a148">Target Alignment</h4>
<div class="outline-text-4" id="text-orged6a148">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">target_alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""The aligned target tokens</span>

<span class="sd">    Warning:</span>
<span class="sd">     this doesn't create them, the __call__ does</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_alignment</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org03eaed8">
<h4 id="org03eaed8">The Table</h4>
<div class="outline-text-4" id="text-org03eaed8">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">"""The alignments as an orgtable"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_alignment</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_alignment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">"|</span><span class="si">{</span><span class="s1">'|'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_alignment</span><span class="p">)</span><span class="si">}</span><span class="s2">|</span><span class="se">\n</span><span class="s2">"</span>
                       <span class="sa">f</span><span class="s2">"|</span><span class="si">{</span><span class="s1">'|'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_alignment</span><span class="p">)</span><span class="si">}</span><span class="s2">|"</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgf545f47">
<h4 id="orgf545f47">The Call</h4>
<div class="outline-text-4" id="text-orgf545f47">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">"""Sets the source and target token alignments</span>

<span class="sd">    Note:</span>
<span class="sd">     as a side-effect also sets source_alignment and target_alignment</span>

<span class="sd">    Returns:</span>
<span class="sd">     tuple of source and target tokens after alignment</span>
<span class="sd">    """</span>
    <span class="n">previous_row</span> <span class="o">=</span> <span class="n">previous_column</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">source_tokens</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">target_tokens</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_token</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
    <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_token</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
    <span class="k">for</span> <span class="n">current_row</span><span class="p">,</span> <span class="n">current_column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">source_token</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">source</span><span class="p">[</span><span class="n">current_row</span><span class="p">]</span> <span class="k">if</span> <span class="n">current_row</span> <span class="o">!=</span> <span class="n">previous_row</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_token</span><span class="p">)</span>
        <span class="n">target_token</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">target</span><span class="p">[</span><span class="n">current_column</span><span class="p">]</span> <span class="k">if</span> <span class="n">current_column</span> <span class="o">!=</span> <span class="n">previous_column</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_token</span><span class="p">)</span>

        <span class="n">source_tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">source_token</span><span class="p">)</span>
        <span class="n">target_tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_token</span><span class="p">)</span>

        <span class="n">previous_row</span><span class="p">,</span> <span class="n">previous_column</span> <span class="o">=</span> <span class="n">current_row</span><span class="p">,</span> <span class="n">current_column</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_source_alignment</span> <span class="o">=</span> <span class="n">source_tokens</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_target_alignment</span> <span class="o">=</span> <span class="n">target_tokens</span>
    <span class="k">return</span> <span class="n">source_tokens</span><span class="p">,</span> <span class="n">target_tokens</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgf48f6e2">
<h4 id="orgf48f6e2">The String Representation</h4>
<div class="outline-text-4" id="text-orgf48f6e2">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">"""pass-through for the table"""</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org128920b">
<h3 id="org128920b">Test It</h3>
<div class="outline-text-3" id="text-org128920b">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.autocorrect.alignment</span> <span class="kn">import</span> <span class="n">Aligner</span>

<span class="n">align</span> <span class="o">=</span> <span class="n">Aligner</span><span class="p">(</span><span class="s2">"source"</span><span class="p">,</span> <span class="s2">"target"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">align</span><span class="o">.</span><span class="n">editor</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">#</th>
<th class="org-right" scope="col">t</th>
<th class="org-right" scope="col">a</th>
<th class="org-right" scope="col">r</th>
<th class="org-right" scope="col">g</th>
<th class="org-right" scope="col">e</th>
<th class="org-right" scope="col">t</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">#</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-left">s</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">6</td>
<td class="org-right">7</td>
</tr>
<tr>
<td class="org-left">o</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">6</td>
<td class="org-right">7</td>
<td class="org-right">8</td>
</tr>
<tr>
<td class="org-left">u</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">6</td>
<td class="org-right">7</td>
<td class="org-right">8</td>
<td class="org-right">9</td>
</tr>
<tr>
<td class="org-left">r</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">6</td>
<td class="org-right">5</td>
<td class="org-right">6</td>
<td class="org-right">7</td>
<td class="org-right">8</td>
</tr>
<tr>
<td class="org-left">c</td>
<td class="org-right">5</td>
<td class="org-right">6</td>
<td class="org-right">7</td>
<td class="org-right">6</td>
<td class="org-right">7</td>
<td class="org-right">8</td>
<td class="org-right">9</td>
</tr>
<tr>
<td class="org-left">e</td>
<td class="org-right">6</td>
<td class="org-right">7</td>
<td class="org-right">8</td>
<td class="org-right">7</td>
<td class="org-right">8</td>
<td class="org-right">7</td>
<td class="org-right">8</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">PATH</span><span class="p">(</span><span class="n">align</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">row</th>
<th class="org-right" scope="col">column</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-right">5</td>
<td class="org-right">4</td>
</tr>
<tr>
<td class="org-right">6</td>
<td class="org-right">5</td>
</tr>
<tr>
<td class="org-right">6</td>
<td class="org-right">6</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">align</span><span class="p">())</span>
</pre></div>
<pre class="example">
(['s', 'o', 'u', 'r', 'c', 'e', '*'], ['*', 't', 'a', 'r', 'g', 'e', 't'])
</pre>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">align</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<tbody>
<tr>
<td class="org-left">s</td>
<td class="org-left">o</td>
<td class="org-left">u</td>
<td class="org-left">r</td>
<td class="org-left">c</td>
<td class="org-left">e</td>
<td class="org-left">*</td>
</tr>
<tr>
<td class="org-left">*</td>
<td class="org-left">t</td>
<td class="org-left">a</td>
<td class="org-left">r</td>
<td class="org-left">g</td>
<td class="org-left">e</td>
<td class="org-left">t</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">align</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<tbody>
<tr>
<td class="org-left">s</td>
<td class="org-left">o</td>
<td class="org-left">u</td>
<td class="org-left">r</td>
<td class="org-left">c</td>
<td class="org-left">e</td>
<td class="org-left">*</td>
</tr>
<tr>
<td class="org-left">*</td>
<td class="org-left">t</td>
<td class="org-left">a</td>
<td class="org-left">r</td>
<td class="org-left">g</td>
<td class="org-left">e</td>
<td class="org-left">t</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">align</span> <span class="o">=</span> <span class="n">Aligner</span><span class="p">(</span><span class="s2">"drafts"</span><span class="p">,</span> <span class="s2">"maths"</span><span class="p">)</span>
<span class="n">nltk_path</span> <span class="o">=</span> <span class="n">nltk_align</span><span class="p">(</span><span class="s2">"drafts"</span><span class="p">,</span> <span class="s2">"maths"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ours</span><span class="p">,</span> <span class="n">theirs</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">align</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">nltk_path</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">ours</span> <span class="o">==</span> <span class="n">theirs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">theirs</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">ours</span><span class="si">}</span><span class="s2">"</span>

<span class="nb">print</span><span class="p">(</span><span class="n">align</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<tbody>
<tr>
<td class="org-left">d</td>
<td class="org-left">r</td>
<td class="org-left">a</td>
<td class="org-left">f</td>
<td class="org-left">t</td>
<td class="org-left">*</td>
<td class="org-left">s</td>
</tr>
<tr>
<td class="org-left">*</td>
<td class="org-left">m</td>
<td class="org-left">a</td>
<td class="org-left">*</td>
<td class="org-left">t</td>
<td class="org-left">h</td>
<td class="org-left">s</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/autocorrect/" rel="tag">autocorrect</a></li>
<li><a class="tag p-category" href="../../../categories/edit-distance/" rel="tag">edit distance</a></li>
<li><a class="tag p-category" href="../../../categories/nlp/" rel="tag">nlp</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../autocorrect-minimum-edit-distance/" rel="prev" title="Autocorrect: Minimum Edit Distance">Previous post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer"><a href="http://creativecommons.org/licenses/by/4.0/" rel="license"><img alt="Creative Commons License" id="license-image" src="https://i.creativecommons.org/l/by/4.0/80x15.png" style="border-width:0"></a>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>. <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script>
</body>
</html>
