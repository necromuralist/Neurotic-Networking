<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Loading the Wall Street Journal POS data." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Parts-of-Speech Tagging: The Data | Neurotic Networking</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/parts-of-speech-tagging-the-data/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../parts-of-speech-tagging/" rel="prev" title="Parts-of-Speech Tagging" type="text/html">
<link href="../parts-of-speech-tagging-training/" rel="next" title="Parts-of-Speech Tagging: Training" type="text/html">
<meta content="Neurotic Networking" property="og:site_name">
<meta content="Parts-of-Speech Tagging: The Data" property="og:title">
<meta content="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/parts-of-speech-tagging-the-data/" property="og:url">
<meta content="Loading the Wall Street Journal POS data." property="og:description">
<meta content="article" property="og:type">
<meta content="2020-11-15T16:18:03-08:00" property="article:published_time">
<meta content="nlp" property="article:tag">
<meta content="pos tagging" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../../"><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Parts-of-Speech Tagging: The Data</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2020-11-15T16:18:03-08:00" itemprop="datePublished" title="2020-11-15 16:18">2020-11-15 16:18</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org86fb8f5">Beginning</a>
<ul>
<li><a href="#org12a55ff">Imports</a></li>
<li><a href="#org3eead24">Set Up</a>
<ul>
<li><a href="#org1020988">The Environment</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgdfdad78">Middle</a>
<ul>
<li><a href="#org839ed72">The Training Corpus</a></li>
<li><a href="#orgd47d1a5">The Vocabulary</a></li>
<li><a href="#orgb65d553">The Test Corpus</a></li>
<li><a href="#org7b143dd">The Test Vocabulary</a>
<ul>
<li><a href="#org97466b4">Handle Empty</a></li>
<li><a href="#org88b6b98">Labeling Unknowns</a></li>
<li><a href="#org2598ea6">The Pre-Processor</a></li>
<li><a href="#orgfae9c48">Load the Test Words</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgf49fca4">End</a>
<ul>
<li><a href="#org5cc8b72">The Code</a>
<ul>
<li><a href="#org531068b">Imports</a></li>
<li><a href="#org6b748a6">The Environment</a></li>
<li><a href="#orgfe3a933">The Suffixes</a></li>
<li><a href="#orga0822eb">The Label</a></li>
<li><a href="#orgb6bf624">Theirs To Ours</a></li>
<li><a href="#orgae671ba">The Unknown</a></li>
<li><a href="#orgc18304c">The Empty</a></li>
<li><a href="#orga20012d">The Corpus Pre-Processor</a></li>
<li><a href="#orgec3f229">The Data Pre-Processor</a></li>
<li><a href="#org2a89e22">The Data Loader</a></li>
<li><a href="#org5e5fb56">The Preprocessor</a></li>
<li><a href="#org2a9b9c8">The Vocabulary Words</a></li>
<li><a href="#org175195b">The Vocabulary</a></li>
<li><a href="#orgea27656">The Training Corpus</a></li>
<li><a href="#org0bfe4a9">The Training Data</a></li>
<li><a href="#org22687c5">Processed Training</a></li>
<li><a href="#org5f3597b">The Raw Test Corpus</a></li>
<li><a href="#orgc9d2a91">The Raw Test Tuples</a></li>
<li><a href="#orge26bbad">Test Words</a></li>
<li><a href="#org394a04c">Load Method</a></li>
</ul>
</li>
<li><a href="#org430331b">Test it Out</a></li>
<li><a href="#org7e33f76">Re-Test</a>
<ul>
<li><a href="#org771f66d">The Vocabulary</a></li>
<li><a href="#org5035ced">Vocabulary Word</a></li>
<li><a href="#org1de2cfa">The Preprocessed Test Words</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org86fb8f5">
<h2 id="org86fb8f5">Beginning</h2>
<div class="outline-text-2" id="text-org86fb8f5"></div>
<div class="outline-3" id="outline-container-org12a55ff">
<h3 id="org12a55ff">Imports</h3>
<div class="outline-text-3" id="text-org12a55ff">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">Namespace</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">string</span>

<span class="c1"># from pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org3eead24">
<h3 id="org3eead24">Set Up</h3>
<div class="outline-text-3" id="text-org3eead24"></div>
<div class="outline-4" id="outline-container-org1020988">
<h4 id="org1020988">The Environment</h4>
<div class="outline-text-4" id="text-org1020988">
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">"posts/nlp/.env"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">Environment</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">training_corpus</span><span class="o">=</span><span class="s2">"WALL_STREET_JOURNAL_POS"</span><span class="p">,</span>
    <span class="n">vocabulary</span><span class="o">=</span><span class="s2">"WALL_STREET_JOURNAL_VOCABULARY"</span><span class="p">,</span>
    <span class="n">test_corpus</span><span class="o">=</span> <span class="s2">"WALL_STREET_JOURNAL_TEST_POS"</span><span class="p">,</span>
    <span class="n">test_words</span><span class="o">=</span><span class="s2">"WALL_STREET_JOURNAL_TEST_WORDS"</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgdfdad78">
<h2 id="orgdfdad78">Middle</h2>
<div class="outline-text-2" id="text-orgdfdad78"></div>
<div class="outline-3" id="outline-container-org839ed72">
<h3 id="org839ed72">The Training Corpus</h3>
<div class="outline-text-3" id="text-org839ed72">
<p>The training corpus is made up of words and parts-of-speech tags from the Wall Street Journal (previously looked at in <a href="../parts-of-speech-tagging-creating-a-vocabulary/">this post</a>).</p>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">Environment</span><span class="o">.</span><span class="n">training_corpus</span><span class="p">])</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">training_corpus</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">training_corpus</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">" - </span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
- In    IN
- an    DT
- Oct.  NNP
- 19    CD
- review        NN
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgd47d1a5">
<h3 id="orgd47d1a5">The Vocabulary</h3>
<div class="outline-text-3" id="text-orgd47d1a5">
<p>There is also a pre-processed version of that same file that has only the words without the parts-of-speech tags that we can load. It has been altered slightly as well:</p>
<ul class="org-ul">
<li>Words that appear only once have been removed</li>
<li>Words that don't exist in the original have been added so that there are some unknown words to handle.</li>
</ul>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">Environment</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">])</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">vocabulary_words</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">vocabulary_words</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">" - </span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
- !
- #
- $
- %
- &
</pre>
<p>Odd.</p>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">vocabulary_words</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">" - </span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
- cabinet
- Byrd
- done
- Fueling
- investments
</pre>
<p>Our actual vocabulary is going to be a dictionary mapping each word to its index in the list we just loaded.</p>
<div class="highlight">
<pre><span></span><span class="n">vocabulary_words</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">vocabulary_words</span><span class="p">)</span>
<span class="n">vocabulary</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vocabulary_words</span><span class="p">)}</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocabulary_words</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">training_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">training_corpus</span><span class="p">])</span>
<span class="n">filtered</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">training_counter</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">extra</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span> <span class="o">-</span> <span class="n">filtered</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">extra</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">extra</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">" - </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
9
 - --unk_adj--
 - --n--
 - --unk--
 - --unk_noun--
 - --unk_adv--
</pre>
<p>So, it looks like the "unknowns" are pre-process tags.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgb65d553">
<h3 id="orgb65d553">The Test Corpus</h3>
<div class="outline-text-3" id="text-orgb65d553">
<p>This is another list of words taken from the Wall Street Journal with parts-of-speech tags added that we'll use as the test-set.</p>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">Environment</span><span class="o">.</span><span class="n">test_corpus</span><span class="p">])</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">test_corpus</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org7b143dd">
<h3 id="org7b143dd">The Test Vocabulary</h3>
<div class="outline-text-3" id="text-org7b143dd">
<p>There is also a set of words that we're going to try and tag. These need to be pre-processed.</p>
</div>
<div class="outline-4" id="outline-container-org97466b4">
<h4 id="org97466b4">Handle Empty</h4>
<div class="outline-text-4" id="text-org97466b4">
<p>We are going to replace empty lines with a special token.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">handle_empty</span><span class="p">(</span><span class="n">words</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">empty_token</span><span class="o">=</span><span class="s2">"--n--"</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""replace empty strings withh empty_token</span>

<span class="sd">    Args:</span>
<span class="sd">     words: list to process</span>
<span class="sd">     empty_token: what to replace empty strings with</span>

<span class="sd">    Yields:</span>
<span class="sd">     processed words</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">empty_token</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">word</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org88b6b98">
<h4 id="org88b6b98">Labeling Unknowns</h4>
<div class="outline-text-4" id="text-org88b6b98"></div>
<ul class="org-ul">
<li><a id="org8e91313"></a>Suffixes<br>
<div class="outline-text-5" id="text-org8e91313">
<div class="highlight">
<pre><span></span><span class="n">Suffixes</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">noun</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"action"</span><span class="p">,</span> <span class="s2">"age"</span><span class="p">,</span> <span class="s2">"ance"</span><span class="p">,</span> <span class="s2">"cy"</span><span class="p">,</span> <span class="s2">"dom"</span><span class="p">,</span> <span class="s2">"ee"</span><span class="p">,</span> <span class="s2">"ence"</span><span class="p">,</span> <span class="s2">"er"</span><span class="p">,</span> <span class="s2">"hood"</span><span class="p">,</span>
            <span class="s2">"ion"</span><span class="p">,</span> <span class="s2">"ism"</span><span class="p">,</span> <span class="s2">"ist"</span><span class="p">,</span> <span class="s2">"ity"</span><span class="p">,</span> <span class="s2">"ling"</span><span class="p">,</span> <span class="s2">"ment"</span><span class="p">,</span> <span class="s2">"ness"</span><span class="p">,</span> <span class="s2">"or"</span><span class="p">,</span> <span class="s2">"ry"</span><span class="p">,</span>
            <span class="s2">"scape"</span><span class="p">,</span> <span class="s2">"ship"</span><span class="p">,</span> <span class="s2">"ty"</span><span class="p">],</span>
    <span class="n">verb</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"ate"</span><span class="p">,</span> <span class="s2">"ify"</span><span class="p">,</span> <span class="s2">"ise"</span><span class="p">,</span> <span class="s2">"ize"</span><span class="p">],</span>
    <span class="n">adjective</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"able"</span><span class="p">,</span> <span class="s2">"ese"</span><span class="p">,</span> <span class="s2">"ful"</span><span class="p">,</span> <span class="s2">"i"</span><span class="p">,</span> <span class="s2">"ian"</span><span class="p">,</span> <span class="s2">"ible"</span><span class="p">,</span> <span class="s2">"ic"</span><span class="p">,</span> <span class="s2">"ish"</span><span class="p">,</span> <span class="s2">"ive"</span><span class="p">,</span>
                 <span class="s2">"less"</span><span class="p">,</span> <span class="s2">"ly"</span><span class="p">,</span> <span class="s2">"ous"</span><span class="p">],</span>
    <span class="n">adverb</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"ward"</span><span class="p">,</span> <span class="s2">"wards"</span><span class="p">,</span> <span class="s2">"wise"</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><a id="org2a2f084"></a>Labels for the Unknowns<br>
<div class="outline-text-5" id="text-org2a2f084">
<div class="highlight">
<pre><span></span><span class="n">UNKNOWN</span> <span class="o">=</span> <span class="s2">"--unknown-</span><span class="si">{}</span><span class="s2">--"</span>
<span class="n">Label</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">digit</span><span class="o">=</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"digit"</span><span class="p">),</span>
    <span class="n">punctuation</span><span class="o">=</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"punctuation"</span><span class="p">),</span>
    <span class="n">uppercase</span><span class="o">=</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"uppercase"</span><span class="p">),</span>
    <span class="n">noun</span><span class="o">=</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"noun"</span><span class="p">),</span>    
    <span class="n">verb</span><span class="o">=</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"verb"</span><span class="p">),</span>
    <span class="n">adjective</span><span class="o">=</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"adjective"</span><span class="p">),</span>
    <span class="n">adverb</span><span class="o">=</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"adverb"</span><span class="p">),</span>
    <span class="n">unknown</span><span class="o">=</span><span class="s2">"--unknown--"</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><a id="orgf1cad49"></a>Bundle Them Up<br>
<div class="outline-text-5" id="text-orgf1cad49">
<div class="highlight">
<pre><span></span><span class="n">Unknown</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">punctuation</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">),</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="n">Suffixes</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="n">Label</span><span class="p">,</span>
    <span class="n">has_digit</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\d"</span><span class="p">),</span>
    <span class="n">has_uppercase</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">"[A-Z]"</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">label_unknowns</span><span class="p">(</span><span class="n">words</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">:</span> <span class="nb">set</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Assign tokens to unknown words</span>

<span class="sd">    Args:</span>
<span class="sd">     word: word not in our vocabulary</span>
<span class="sd">     vocabulary: something to check if it is a known word</span>

<span class="sd">    Yields:</span>
<span class="sd">     word or label for the word if unknown</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">vocabulary</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">word</span>

        <span class="k">elif</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">has_digit</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">digit</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">punctuation</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">word</span><span class="p">)):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">punctuation</span>

        <span class="k">elif</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">has_uppercase</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">uppercase</span>

        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">noun</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">noun</span>

        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">verb</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">verb</span>

        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">adjective</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">adjective</span>

        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">adverb</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">adverb</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">unknown</span>
    <span class="k">return</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org2598ea6">
<h4 id="org2598ea6">The Pre-Processor</h4>
<div class="outline-text-4" id="text-org2598ea6">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">words</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">:</span> <span class="nb">set</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Preprocess words</span>

<span class="sd">    Args:</span>
<span class="sd">     words: words to pre-process</span>

<span class="sd">    Returns:</span>
<span class="sd">     words with empty lines and unknown words labeled</span>
<span class="sd">    """</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">)</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="n">handle_empty</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">label_unknowns</span><span class="p">(</span><span class="n">processed</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">processed</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgfae9c48">
<h4 id="orgfae9c48">Load the Test Words</h4>
<div class="outline-text-4" id="text-orgfae9c48">
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">Environment</span><span class="o">.</span><span class="n">test_words</span><span class="p">])</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">test_words</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="n">before</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_words</span><span class="p">)</span>
<span class="n">test_words</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><span class="n">test_words</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_words</span><span class="p">)</span> <span class="o">==</span> <span class="n">before</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">test_words</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">test_words</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">" - </span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
180,264
 - --unknown--
 - --n--
 - e
 - r
 - --unknown--
</pre>
<p>Weird that the letters "e" and "r" are known words…</p>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgf49fca4">
<h2 id="orgf49fca4">End</h2>
<div class="outline-text-2" id="text-orgf49fca4">
<p>So, that's our data. To make it replicable for the next section I'm going to tangle it out.</p>
</div>
<div class="outline-3" id="outline-container-org5cc8b72">
<h3 id="org5cc8b72">The Code</h3>
<div class="outline-text-3" id="text-org5cc8b72"></div>
<div class="outline-4" id="outline-container-org531068b">
<h4 id="org531068b">Imports</h4>
<div class="outline-text-4" id="text-org531068b">
<div class="highlight">
<pre><span></span><span class="c1"># from python</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">Namespace</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">string</span>

<span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">attr</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org6b748a6">
<h4 id="org6b748a6">The Environment</h4>
<div class="outline-text-4" id="text-org6b748a6">
<p>I don't really know that I should save these keys, but I don't really want to cut and paste all the time…</p>
<div class="highlight">
<pre><span></span><span class="n">Environment</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">training_corpus</span><span class="o">=</span><span class="s2">"WALL_STREET_JOURNAL_POS"</span><span class="p">,</span>
    <span class="n">vocabulary</span><span class="o">=</span><span class="s2">"WALL_STREET_JOURNAL_VOCABULARY"</span><span class="p">,</span>
    <span class="n">test_corpus</span><span class="o">=</span> <span class="s2">"WALL_STREET_JOURNAL_TEST_POS"</span><span class="p">,</span>
    <span class="n">test_words</span><span class="o">=</span><span class="s2">"WALL_STREET_JOURNAL_TEST_WORDS"</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgfe3a933">
<h4 id="orgfe3a933">The Suffixes</h4>
<div class="outline-text-4" id="text-orgfe3a933">
<div class="highlight">
<pre><span></span><span class="n">Suffixes</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">noun</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"action"</span><span class="p">,</span> <span class="s2">"age"</span><span class="p">,</span> <span class="s2">"ance"</span><span class="p">,</span> <span class="s2">"cy"</span><span class="p">,</span> <span class="s2">"dom"</span><span class="p">,</span> <span class="s2">"ee"</span><span class="p">,</span> <span class="s2">"ence"</span><span class="p">,</span> <span class="s2">"er"</span><span class="p">,</span> <span class="s2">"hood"</span><span class="p">,</span>
            <span class="s2">"ion"</span><span class="p">,</span> <span class="s2">"ism"</span><span class="p">,</span> <span class="s2">"ist"</span><span class="p">,</span> <span class="s2">"ity"</span><span class="p">,</span> <span class="s2">"ling"</span><span class="p">,</span> <span class="s2">"ment"</span><span class="p">,</span> <span class="s2">"ness"</span><span class="p">,</span> <span class="s2">"or"</span><span class="p">,</span> <span class="s2">"ry"</span><span class="p">,</span>
            <span class="s2">"scape"</span><span class="p">,</span> <span class="s2">"ship"</span><span class="p">,</span> <span class="s2">"ty"</span><span class="p">],</span>
    <span class="n">verb</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"ate"</span><span class="p">,</span> <span class="s2">"ify"</span><span class="p">,</span> <span class="s2">"ise"</span><span class="p">,</span> <span class="s2">"ize"</span><span class="p">],</span>
    <span class="n">adjective</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"able"</span><span class="p">,</span> <span class="s2">"ese"</span><span class="p">,</span> <span class="s2">"ful"</span><span class="p">,</span> <span class="s2">"i"</span><span class="p">,</span> <span class="s2">"ian"</span><span class="p">,</span> <span class="s2">"ible"</span><span class="p">,</span> <span class="s2">"ic"</span><span class="p">,</span> <span class="s2">"ish"</span><span class="p">,</span> <span class="s2">"ive"</span><span class="p">,</span>
                 <span class="s2">"less"</span><span class="p">,</span> <span class="s2">"ly"</span><span class="p">,</span> <span class="s2">"ous"</span><span class="p">],</span>
    <span class="n">adverb</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"ward"</span><span class="p">,</span> <span class="s2">"wards"</span><span class="p">,</span> <span class="s2">"wise"</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orga0822eb">
<h4 id="orga0822eb">The Label</h4>
<div class="outline-text-4" id="text-orga0822eb">
<div class="highlight">
<pre><span></span><span class="n">UNKNOWN</span> <span class="o">=</span> <span class="s2">"--unknown-</span><span class="si">{}</span><span class="s2">--"</span>
<span class="n">Label</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">digit</span><span class="o">=</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"digit"</span><span class="p">),</span>
    <span class="n">punctuation</span><span class="o">=</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"punctuation"</span><span class="p">),</span>
    <span class="n">uppercase</span><span class="o">=</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"uppercase"</span><span class="p">),</span>
    <span class="n">noun</span><span class="o">=</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"noun"</span><span class="p">),</span>    
    <span class="n">verb</span><span class="o">=</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"verb"</span><span class="p">),</span>
    <span class="n">adjective</span><span class="o">=</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"adjective"</span><span class="p">),</span>
    <span class="n">adverb</span><span class="o">=</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"adverb"</span><span class="p">),</span>
    <span class="n">unknown</span><span class="o">=</span><span class="s2">"--unknown--"</span><span class="p">,</span>
 <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgb6bf624">
<h4 id="orgb6bf624">Theirs To Ours</h4>
<div class="outline-text-4" id="text-orgb6bf624">
<p>The vocabulary file has their unknown tags alreads inserted which don't matnch mine so, rather than redoing everything I'm going to translate theirs to match mine.</p>
<div class="highlight">
<pre><span></span><span class="n">THEIR_UNKNOWN</span> <span class="o">=</span> <span class="s2">"--unk_</span><span class="si">{}</span><span class="s2">--"</span>

<span class="n">THEIRS_TO_MINE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"--unk--"</span><span class="p">:</span> <span class="s2">"--unknown--"</span><span class="p">,</span>
    <span class="n">THEIR_UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"digit"</span><span class="p">):</span> <span class="n">Label</span><span class="o">.</span><span class="n">digit</span><span class="p">,</span>
    <span class="n">THEIR_UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"punct"</span><span class="p">):</span> <span class="n">Label</span><span class="o">.</span><span class="n">punctuation</span><span class="p">,</span>
    <span class="n">THEIR_UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"upper"</span><span class="p">):</span> <span class="n">Label</span><span class="o">.</span><span class="n">uppercase</span><span class="p">,</span>
    <span class="n">THEIR_UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"noun"</span><span class="p">):</span> <span class="n">Label</span><span class="o">.</span><span class="n">noun</span><span class="p">,</span>
    <span class="n">THEIR_UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"verb"</span><span class="p">):</span> <span class="n">Label</span><span class="o">.</span><span class="n">verb</span><span class="p">,</span>
    <span class="n">THEIR_UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"adj"</span><span class="p">):</span> <span class="n">Label</span><span class="o">.</span><span class="n">adjective</span><span class="p">,</span>
    <span class="n">THEIR_UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"adv"</span><span class="p">):</span> <span class="n">Label</span><span class="o">.</span><span class="n">adverb</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgae671ba">
<h4 id="orgae671ba">The Unknown</h4>
<div class="outline-text-4" id="text-orgae671ba">
<div class="highlight">
<pre><span></span><span class="n">Unknown</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">punctuation</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">),</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="n">Suffixes</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="n">Label</span><span class="p">,</span>
    <span class="n">has_digit</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\d"</span><span class="p">),</span>
    <span class="n">has_uppercase</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">"[A-Z]"</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgc18304c">
<h4 id="orgc18304c">The Empty</h4>
<div class="outline-text-4" id="text-orgc18304c">
<div class="highlight">
<pre><span></span><span class="n">Empty</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">word</span><span class="o">=</span><span class="s2">"--n--"</span><span class="p">,</span>
    <span class="n">tag</span><span class="o">=</span><span class="s2">"--s--"</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orga20012d">
<h4 id="orga20012d">The Corpus Pre-Processor</h4>
<div class="outline-text-4" id="text-orga20012d">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CorpusProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Pre-processes the corpus</span>

<span class="sd">    Args:</span>
<span class="sd">     vocabulary: holder of our known words</span>
<span class="sd">    """</span>
    <span class="n">vocabulary</span><span class="p">:</span> <span class="nb">dict</span>
</pre></div>
</div>
<ul class="org-ul">
<li><a id="org0893765"></a>Split Tuples<br>
<div class="outline-text-5" id="text-org0893765">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">split_tuples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Generates tuples</span>

<span class="sd">    Args:</span>
<span class="sd">     lines: iterable of lines from the corpus</span>

<span class="sd">    Yields:</span>
<span class="sd">     whitespace split of line</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
</li>
<li><a id="orgd0297ea"></a>Handle Empty Lines<br>
<div class="outline-text-5" id="text-orgd0297ea">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">handle_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tuples</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""checks for empty strings</span>

<span class="sd">    Args:</span>
<span class="sd">     tuples: tuples of corpus lines</span>

<span class="sd">    Yields:</span>
<span class="sd">     line with empty string marked</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">tuples</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">Empty</span><span class="o">.</span><span class="n">word</span><span class="p">,</span> <span class="n">Empty</span><span class="o">.</span><span class="n">tag</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">line</span>
    <span class="k">return</span>
</pre></div>
</div>
</li>
<li><a id="org2accacc"></a>Handle Unknowns<br>
<div class="outline-text-5" id="text-org2accacc">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">label_unknowns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tuples</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Assign tokens to unknown words</span>

<span class="sd">    Args:</span>
<span class="sd">     tuples: word, tag tuples</span>

<span class="sd">    Yields:</span>
<span class="sd">     (word (or label for the word if unknown), tag) tuple</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tuples</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">word</span><span class="p">,</span> <span class="n">tag</span>

        <span class="k">elif</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">has_digit</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">digit</span><span class="p">,</span> <span class="n">tag</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">punctuation</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">word</span><span class="p">)):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">punctuation</span><span class="p">,</span> <span class="n">tag</span>

        <span class="k">elif</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">has_uppercase</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">uppercase</span><span class="p">,</span> <span class="n">tag</span>

        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">noun</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">noun</span><span class="p">,</span> <span class="n">tag</span>

        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">verb</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">verb</span><span class="p">,</span> <span class="n">tag</span>

        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">adjective</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">adjective</span><span class="p">,</span> <span class="n">tag</span>

        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">adverb</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">adverb</span><span class="p">,</span> <span class="n">tag</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">unknown</span><span class="p">,</span> <span class="n">tag</span>
    <span class="k">return</span>
</pre></div>
</div>
</li>
<li><a id="orgba54101"></a>The Call<br>
<div class="outline-text-5" id="text-orgba54101">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tuples</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""preprocesses the words and tags</span>

<span class="sd">    Args:</span>
<span class="sd">     tuples: list of words and tags to process</span>

<span class="sd">    Returns:</span>
<span class="sd">     preprocessed version of words, tags</span>
<span class="sd">    """</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_tuples</span><span class="p">(</span><span class="n">tuples</span><span class="p">)</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_empty</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="p">[(</span><span class="n">word</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_unknowns</span><span class="p">(</span><span class="n">processed</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">processed</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-orgec3f229">
<h4 id="orgec3f229">The Data Pre-Processor</h4>
<div class="outline-text-4" id="text-orgec3f229">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DataPreprocessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A pre-processor for the data</span>

<span class="sd">    Args:</span>
<span class="sd">     vocabulary: holder of our known words</span>
<span class="sd">     empty_token: what to use if a line is an empty string</span>
<span class="sd">    """</span>
    <span class="n">vocabulary</span><span class="p">:</span> <span class="nb">dict</span>
</pre></div>
</div>
<ul class="org-ul">
<li><a id="orgb1573a1"></a>Handle Empty Lines<br>
<div class="outline-text-5" id="text-orgb1573a1">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">handle_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""replace empty strings withh empty_token</span>

<span class="sd">    Args:</span>
<span class="sd">     words: list to process</span>
<span class="sd">     empty_token: what to replace empty strings with</span>

<span class="sd">    Yields:</span>
<span class="sd">     processed words</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">Empty</span><span class="o">.</span><span class="n">word</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">word</span>
    <span class="k">return</span>
</pre></div>
</div>
</li>
<li><a id="org70933c1"></a>Label Unknowns<br>
<div class="outline-text-5" id="text-org70933c1">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">label_unknowns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Assign tokens to unknown words</span>

<span class="sd">    Args:</span>
<span class="sd">     words: iterable of words to check</span>

<span class="sd">    Yields:</span>
<span class="sd">     word or label for the word if unknown</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">word</span>

        <span class="k">elif</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">has_digit</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">digit</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">punctuation</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">word</span><span class="p">)):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">punctuation</span>

        <span class="k">elif</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">has_uppercase</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">uppercase</span>

        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">noun</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">noun</span>

        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">verb</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">verb</span>

        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">adjective</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">adjective</span>

        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">adverb</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">adverb</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">Unknown</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">unknown</span>
    <span class="k">return</span>
</pre></div>
</div>
</li>
<li><a id="org3404c00"></a>The Call<br>
<div class="outline-text-5" id="text-org3404c00">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""preprocesses the words</span>

<span class="sd">    Args:</span>
<span class="sd">     words: list of words to process</span>

<span class="sd">    Returns:</span>
<span class="sd">     preprocessed version of words</span>
<span class="sd">    """</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">)</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_empty</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>
    <span class="n">processed</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_unknowns</span><span class="p">(</span><span class="n">processed</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">processed</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org2a89e22">
<h4 id="org2a89e22">The Data Loader</h4>
<div class="outline-text-4" id="text-org2a89e22">
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DataLoader</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Loads the training and test data</span>

<span class="sd">    Args:</span>
<span class="sd">     environment: namespace with keys for the environment to load paths</span>
<span class="sd">    """</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">Namespace</span><span class="o">=</span><span class="n">Environment</span>
    <span class="n">_preprocess</span><span class="p">:</span> <span class="n">DataPreprocessor</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_vocabulary_words</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_vocabulary</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_training_corpus</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_training_data</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_processed_training</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_test_data_raw</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_test_data_tuples</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_test_data</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_test_words</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org5e5fb56">
<h4 id="org5e5fb56">The Preprocessor</h4>
<div class="outline-text-4" id="text-org5e5fb56">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataPreprocessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The Preprocessor for the data"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span> <span class="o">=</span> <span class="n">DataPreprocessor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org2a9b9c8">
<h4 id="org2a9b9c8">The Vocabulary Words</h4>
<div class="outline-text-4" id="text-org2a9b9c8">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">vocabulary_words</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The list of vocabulary words for training</span>

<span class="sd">    Note:</span>
<span class="sd">     This is ``hmm_vocab.txt``</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary_words</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary_words</span> <span class="o">=</span> <span class="p">[</span><span class="n">THEIRS_TO_MINE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary_words</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org175195b">
<h4 id="org175195b">The Vocabulary</h4>
<div class="outline-text-4" id="text-org175195b">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">vocabulary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Converts the vocabulary list of words to a dict</span>

<span class="sd">    Returns:</span>
<span class="sd">     word : index of word in vocabulary words&gt; dictionary</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">word</span><span class="p">:</span> <span class="n">index</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocabulary_words</span><span class="p">))}</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vocabulary</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgea27656">
<h4 id="orgea27656">The Training Corpus</h4>
<div class="outline-text-4" id="text-orgea27656">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">training_corpus</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The corpus for training</span>

<span class="sd">    Note:</span>
<span class="sd">     ``WSJ_02_20.pos`` lines (&lt;word&gt;&lt;tab&gt;&lt;pos&gt; all as one string)</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_training_corpus</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_training_corpus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">training_corpus</span><span class="p">])</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_training_corpus</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org0bfe4a9">
<h4 id="org0bfe4a9">The Training Data</h4>
<div class="outline-text-4" id="text-org0bfe4a9">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The word-tag training data</span>

<span class="sd">    Note:</span>
<span class="sd">     this is the ``training_corpus`` converted to a &lt;word&gt;:&lt;pos&gt; dictionary</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_training_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">words_tags</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_corpus</span><span class="p">)</span>
        <span class="n">words_tags</span> <span class="o">=</span> <span class="p">(</span><span class="n">tokens</span> <span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">words_tags</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">_training_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">word</span><span class="p">:</span> <span class="n">tag</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">words_tags</span><span class="p">}</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_training_data</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org22687c5">
<h4 id="org22687c5">Processed Training</h4>
<div class="outline-text-4" id="text-org22687c5">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">processed_training</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Pre-processes the training corpus</span>

<span class="sd">    Note:</span>
<span class="sd">     ``training_corpus`` converted to (word, tag) tuples with unknown tags added</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processed_training</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">processor</span> <span class="o">=</span> <span class="n">CorpusProcessor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processed_training</span> <span class="o">=</span> <span class="n">processor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">training_corpus</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processed_training</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org5f3597b">
<h4 id="org5f3597b">The Raw Test Corpus</h4>
<div class="outline-text-4" id="text-org5f3597b">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">test_data_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The lines for testing</span>

<span class="sd">    Note:</span>
<span class="sd">     The assignment expects the lines to be un-processed so this is just the</span>
<span class="sd">    raw lines from ``WSJ_24.pos``</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_data_raw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_data_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">test_corpus</span><span class="p">])</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_data_raw</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgc9d2a91">
<h4 id="orgc9d2a91">The Raw Test Tuples</h4>
<div class="outline-text-4" id="text-orgc9d2a91">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">test_data_tuples</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The test data lines split into tuples</span>

<span class="sd">    Note:</span>
<span class="sd">     this is the test_data_raw with the lines split</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_data_tuples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_data_tuples</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_data_raw</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_data_tuples</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orge26bbad">
<h4 id="orge26bbad">Test Words</h4>
<div class="outline-text-4" id="text-orge26bbad">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">test_words</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The pre-processed test words</span>

<span class="sd">    Note:</span>
<span class="sd">     ``test.words`` with some pre-processing done</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_words</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">test_words</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_words</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_words</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org394a04c">
<h4 id="org394a04c">Load Method</h4>
<div class="outline-text-4" id="text-org394a04c">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">keep_empty</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Loads the strings from the file</span>

<span class="sd">    Args:</span>
<span class="sd">     path: path to the text file</span>
<span class="sd">     keep_empty: keep empty lines if true</span>

<span class="sd">    Returns:</span>
<span class="sd">     list of lines from the file</span>
<span class="sd">    """</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span> <span class="k">if</span> <span class="n">keep_empty</span> <span class="ow">or</span> <span class="n">line</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">lines</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org430331b">
<h3 id="org430331b">Test it Out</h3>
<div class="outline-text-3" id="text-org430331b">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.parts_of_speech.preprocessing</span> <span class="kn">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">DataLoader</span>

<span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">theirs</span><span class="p">,</span> <span class="n">mine</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vocabulary_words</span><span class="p">,</span> <span class="n">loader</span><span class="o">.</span><span class="n">vocabulary_words</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">theirs</span> <span class="o">==</span> <span class="n">mine</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">theirs</span><span class="p">,</span> <span class="n">mine</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">,</span> <span class="n">loader</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">vocabulary</span><span class="p">[</span><span class="n">theirs</span><span class="p">]</span> <span class="o">==</span> <span class="n">loader</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">[</span><span class="n">mine</span><span class="p">]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">Environment</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">vocabulary_words</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">vocabulary_words</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">vocabulary_words</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocabulary_words</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">training_corpus</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">training_corpus</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">training_corpus</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">training_corpus</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">test_corpus</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">test_corpus</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_corpus</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">test_corpus</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>


<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">test_words</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">test_words</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
<pre class="example" id="orgcdae705">
23,777
['Island', 'Gibbons']

989,861
['nine\tCD', 'in\tIN']

23,777

34,200
['at\tIN', 'to\tTO']

34,200
['the', ';']
</pre></div>
</div>
<div class="outline-3" id="outline-container-org7e33f76">
<h3 id="org7e33f76">Re-Test</h3>
<div class="outline-text-3" id="text-org7e33f76">
<p>I'm trying to troubleshoot differences between my output and the original notebook.</p>
<div class="highlight">
<pre><span></span><span class="n">punct</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">)</span>

<span class="n">noun_suffix</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"action"</span><span class="p">,</span> <span class="s2">"age"</span><span class="p">,</span> <span class="s2">"ance"</span><span class="p">,</span> <span class="s2">"cy"</span><span class="p">,</span> <span class="s2">"dom"</span><span class="p">,</span> <span class="s2">"ee"</span><span class="p">,</span> <span class="s2">"ence"</span><span class="p">,</span> <span class="s2">"er"</span><span class="p">,</span> <span class="s2">"hood"</span><span class="p">,</span> <span class="s2">"ion"</span><span class="p">,</span> <span class="s2">"ism"</span><span class="p">,</span> <span class="s2">"ist"</span><span class="p">,</span> <span class="s2">"ity"</span><span class="p">,</span> <span class="s2">"ling"</span><span class="p">,</span> <span class="s2">"ment"</span><span class="p">,</span> <span class="s2">"ness"</span><span class="p">,</span> <span class="s2">"or"</span><span class="p">,</span> <span class="s2">"ry"</span><span class="p">,</span> <span class="s2">"scape"</span><span class="p">,</span> <span class="s2">"ship"</span><span class="p">,</span> <span class="s2">"ty"</span><span class="p">]</span>
<span class="n">verb_suffix</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"ate"</span><span class="p">,</span> <span class="s2">"ify"</span><span class="p">,</span> <span class="s2">"ise"</span><span class="p">,</span> <span class="s2">"ize"</span><span class="p">]</span>
<span class="n">adj_suffix</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"able"</span><span class="p">,</span> <span class="s2">"ese"</span><span class="p">,</span> <span class="s2">"ful"</span><span class="p">,</span> <span class="s2">"i"</span><span class="p">,</span> <span class="s2">"ian"</span><span class="p">,</span> <span class="s2">"ible"</span><span class="p">,</span> <span class="s2">"ic"</span><span class="p">,</span> <span class="s2">"ish"</span><span class="p">,</span> <span class="s2">"ive"</span><span class="p">,</span> <span class="s2">"less"</span><span class="p">,</span> <span class="s2">"ly"</span><span class="p">,</span> <span class="s2">"ous"</span><span class="p">]</span>
<span class="n">adv_suffix</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"ward"</span><span class="p">,</span> <span class="s2">"wards"</span><span class="p">,</span> <span class="s2">"wise"</span><span class="p">]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">vocab</span><span class="p">,</span> <span class="n">data_fp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Preprocess data</span>
<span class="sd">    """</span>
    <span class="n">orig</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">prep</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Read data</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_fp</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">data_file</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_file</span><span class="p">):</span>

            <span class="c1"># End of sentence</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">word</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                <span class="n">orig</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">word</span> <span class="o">=</span> <span class="s2">"--n--"</span>
                <span class="n">prep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Handle unknown words</span>
            <span class="k">elif</span> <span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vocab</span><span class="p">:</span>
                <span class="n">orig</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="c1"># this seems like a bug</span>
                <span class="n">word</span> <span class="o">=</span> <span class="n">assign_unk</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>

                <span class="c1"># this makes it work better, but isn't in their code</span>
                <span class="c1"># word = assign_unk(word.strip())</span>
                <span class="n">prep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">orig</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">prep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">orig</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">data_fp</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()))</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prep</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">data_fp</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()))</span>

    <span class="k">return</span> <span class="n">orig</span><span class="p">,</span> <span class="n">prep</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">assign_unk</span><span class="p">(</span><span class="n">tok</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Assign unknown word tokens</span>
<span class="sd">    """</span>
    <span class="c1"># Digits</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">char</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">tok</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"--unk_digit--"</span>

    <span class="c1"># Punctuation</span>
    <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">char</span> <span class="ow">in</span> <span class="n">punct</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">tok</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"--unk_punct--"</span>

    <span class="c1"># Upper-case</span>
    <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">char</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">tok</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"--unk_upper--"</span>

    <span class="c1"># Nouns</span>
    <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">noun_suffix</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"--unk_noun--"</span>

    <span class="c1"># Verbs</span>
    <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">verb_suffix</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"--unk_verb--"</span>

    <span class="c1"># Adjectives</span>
    <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">adj_suffix</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"--unk_adj--"</span>

    <span class="c1"># Adverbs</span>
    <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">tok</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">adv_suffix</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"--unk_adv--"</span>

    <span class="k">return</span> <span class="s2">"--unk--"</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">Environment</span><span class="p">)</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org771f66d">
<h4 id="org771f66d">The Vocabulary</h4>
<div class="outline-text-4" id="text-org771f66d">
<div class="highlight">
<pre><span></span><span class="n">UNKNOWN</span> <span class="o">=</span> <span class="s2">"--unknown-</span><span class="si">{}</span><span class="s2">--"</span>
<span class="n">THEIR_UNKNOWN</span> <span class="o">=</span> <span class="s2">"--unk_</span><span class="si">{}</span><span class="s2">--"</span>

<span class="n">THEIRS_TO_MINE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"--unk--"</span><span class="p">:</span> <span class="s2">"--unknown--"</span><span class="p">,</span>
    <span class="n">THEIR_UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"digit"</span><span class="p">):</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"digit"</span><span class="p">),</span>
    <span class="n">THEIR_UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"punct"</span><span class="p">):</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"punctuation"</span><span class="p">),</span>
    <span class="n">THEIR_UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"upper"</span><span class="p">):</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"uppercase"</span><span class="p">),</span>
    <span class="n">THEIR_UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"noun"</span><span class="p">):</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"noun"</span><span class="p">),</span>    
    <span class="n">THEIR_UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"verb"</span><span class="p">):</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"verb"</span><span class="p">),</span>
    <span class="n">THEIR_UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"adj"</span><span class="p">):</span> <span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"adjective"</span><span class="p">),</span>
    <span class="n">THEIR_UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"adv"</span><span class="p">):</span><span class="n">UNKNOWN</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"adverb"</span><span class="p">),</span>    
<span class="p">}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">Environment</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">])</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">voc_l</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">theirs</span><span class="p">,</span> <span class="n">mine</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">voc_l</span><span class="p">,</span> <span class="n">loader</span><span class="o">.</span><span class="n">vocabulary_words</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">THEIRS_TO_MINE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">theirs</span><span class="p">,</span> <span class="n">theirs</span><span class="p">)</span><span class="o">==</span><span class="n">mine</span><span class="p">,</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">theirs</span><span class="p">,</span> <span class="n">mine</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org5035ced">
<h4 id="org5035ced">Vocabulary Word</h4>
<div class="outline-text-4" id="text-org5035ced">
<p>They include empty strings so the dictionaries won't match exactly.</p>
<div class="highlight">
<pre><span></span><span class="n">vocab</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">voc_l</span><span class="p">)):</span>
    <span class="n">vocab</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>

<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">vocab</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">THEIRS_TO_MINE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span> <span class="ow">in</span> <span class="n">loader</span><span class="o">.</span><span class="n">vocabulary</span><span class="p">,</span> <span class="p">(</span><span class="n">word</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org1de2cfa">
<h4 id="org1de2cfa">The Preprocessed Test Words</h4>
<div class="outline-text-4" id="text-org1de2cfa">
<div class="highlight">
<pre><span></span><span class="n">original</span><span class="p">,</span> <span class="n">prep</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><span class="n">vocab</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">Environment</span><span class="o">.</span><span class="n">test_words</span><span class="p">])</span>

<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">theirs</span><span class="p">,</span> <span class="n">mine</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">prep</span><span class="p">,</span> <span class="n">loader</span><span class="o">.</span><span class="n">test_words</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">THEIRS_TO_MINE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">theirs</span><span class="p">,</span> <span class="n">theirs</span><span class="p">)</span> <span class="o">!=</span> <span class="n">mine</span><span class="p">:</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">original</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">theirs</span><span class="p">,</span> <span class="n">mine</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">assign_unk</span><span class="p">(</span><span class="n">token</span><span class="p">))</span>
    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
<pre class="example" id="orgfc59bba">
9 --unk-- --unknown-noun-- vantage --unk_noun--
228 --unk-- --unknown-verb-- exacerbate --unk_verb--
845 --unk-- --unknown-adjective-- relentless --unk_adj--
896 --unk-- --unknown-adjective-- slickly --unk_adj--
906 --unk-- --unknown-adjective-- cognoscenti --unk_adj--
919 --unk-- --unknown-noun-- depiction --unk_noun--
1076 --unk-- --unknown-adjective-- perfidious --unk_adj--
1160 --unk-- --unknown-adjective-- innocently --unk_adj--
1196 --unk-- --unknown-adjective-- loutish --unk_adj--
1244 --unk-- --unknown-verb-- premise --unk_verb--
1268 --unk-- --unknown-adjective-- conspicuously --unk_adj--
1331 --unk-- --unknown-noun-- ignition --unk_noun--
1347 --unk-- --unknown-noun-- obligatory --unk_noun--
1448 --unk-- --unknown-adjective-- lavishly --unk_adj--
1468 --unk-- --unknown-adjective-- palatable --unk_adj--
1564 --unk-- --unknown-adjective-- inconsiderable --unk_adj--
1678 --unk-- --unknown-adjective-- discreetly --unk_adj--
1774 --unk-- --unknown-adjective-- marvelously --unk_adj--
1855 --unk-- --unknown-adjective-- passable --unk_adj--
1970 --unk-- --unknown-noun-- diaper --unk_noun--
3248 --unk-- --unknown-adjective-- comparably --unk_adj--
3672 --unk-- --unknown-noun-- imperialism --unk_noun--
3791 --unk-- --unknown-noun-- livelier --unk_noun--
3793 --unk-- --unknown-noun-- bolder --unk_noun--
4132 --unk-- --unknown-noun-- intimidation --unk_noun--
4648 --unk-- --unknown-adjective-- politic --unk_adj--
4661 --unk-- --unknown-verb-- mutate --unk_verb--
4682 --unk-- --unknown-noun-- aspersion --unk_noun--
4777 --unk-- --unknown-adjective-- utopian --unk_adj--
4802 --unk-- --unknown-adjective-- psychic --unk_adj--
4892 --unk-- --unknown-noun-- coercion --unk_noun--
5043 --unk-- --unknown-noun-- centrist --unk_noun--
5090 --unk-- --unknown-noun-- schooling --unk_noun--
5131 --unk-- --unknown-noun-- voucher --unk_noun--
5270 --unk-- --unknown-noun-- recruitment --unk_noun--
5316 --unk-- --unknown-noun-- expansionism --unk_noun--
5429 --unk-- --unknown-verb-- palate --unk_verb--
5440 --unk-- --unknown-noun-- engorgement --unk_noun--
5557 --unk-- --unknown-noun-- patronage --unk_noun--
5912 --unk-- --unknown-noun-- volunteerism --unk_noun--
5990 --unk-- --unknown-adjective-- utopian --unk_adj--
6709 --unk-- --unknown-noun-- citizenship --unk_noun--
6738 --unk-- --unknown-noun-- abomination --unk_noun--
6793 --unk-- --unknown-adjective-- reflexively --unk_adj--
6809 --unk-- --unknown-noun-- regimentation --unk_noun--
6876 --unk-- --unknown-noun-- compulsory --unk_noun--
7150 --unk-- --unknown-adjective-- arguably --unk_adj--
7192 --unk-- --unknown-noun-- compulsion --unk_noun--
7208 --unk-- --unknown-adjective-- unenforceable --unk_adj--
7374 --unk-- --unknown-noun-- recruitment --unk_noun--
7468 --unk-- --unknown-adjective-- challengeable --unk_adj--
7591 --unk-- --unknown-adjective-- unprecedentedly --unk_adj--
7657 --unk-- --unknown-adjective-- cooperatively --unk_adj--
8182 --unk-- --unknown-noun-- reticence --unk_noun--
8772 --unk-- --unknown-noun-- render --unk_noun--
11071 --unk-- --unknown-noun-- breather --unk_noun--
11942 --unk-- --unknown-verb-- unify --unk_verb--
12859 --unk-- --unknown-verb-- frigate --unk_verb--
12907 --unk-- --unknown-noun-- disarmament --unk_noun--
12936 --unk-- --unknown-noun-- affinity --unk_noun--
13240 --unk-- --unknown-verb-- patriarchate --unk_verb--
13438 --unk-- --unknown-noun-- underselling --unk_noun--
13650 --unk-- --unknown-adjective-- wrathful --unk_adj--
13725 --unk-- --unknown-noun-- gist --unk_noun--
14081 --unk-- --unknown-noun-- segmentation --unk_noun--
14110 --unk-- --unknown-adjective-- brightly --unk_adj--
15331 --unk-- --unknown-noun-- connector --unk_noun--
17846 --unk-- --unknown-noun-- readjustment --unk_noun--
18397 --unk-- --unknown-noun-- observation --unk_noun--
18410 --unk-- --unknown-noun-- ticker --unk_noun--
18566 --unk-- --unknown-noun-- trickery --unk_noun--
18750 --unk-- --unknown-adjective-- supersonic --unk_adj--
18854 --unk-- --unknown-noun-- existance --unk_noun--
18885 --unk-- --unknown-adjective-- thankfully --unk_adj--
19011 --unk-- --unknown-noun-- coherence --unk_noun--
19304 --unk-- --unknown-adjective-- autocratic --unk_adj--
19305 --unk-- --unknown-noun-- pseudosocialism --unk_noun--
19326 --unk-- --unknown-noun-- encircling --unk_noun--
19389 --unk-- --unknown-noun-- miscegenation --unk_noun--
19470 --unk-- --unknown-adjective-- ostensible --unk_adj--
19479 --unk-- --unknown-adjective-- purportedly --unk_adj--
19554 --unk-- --unknown-noun-- accuser --unk_noun--
19568 --unk-- --unknown-noun-- embezzler --unk_noun--
19961 --unk-- --unknown-adjective-- unwittingly --unk_adj--
19970 --unk-- --unknown-noun-- platter --unk_noun--
20129 --unk-- --unknown-noun-- centrist --unk_noun--
20384 --unk-- --unknown-adjective-- improbable --unk_adj--
20472 --unk-- --unknown-adjective-- glaringly --unk_adj--
20493 --unk-- --unknown-noun-- clarity --unk_noun--
20496 --unk-- --unknown-noun-- rectification --unk_noun--
20539 --unk-- --unknown-noun-- wiser --unk_noun--
21215 --unk-- --unknown-adjective-- concurrently --unk_adj--
21310 --unk-- --unknown-verb-- revolutionize --unk_verb--
22257 --unk-- --unknown-noun-- compensatory --unk_noun--
22270 --unk-- --unknown-noun-- respiratory --unk_noun--
23603 --unk-- --unknown-noun-- milion --unk_noun--
23928 --unk-- --unknown-noun-- poultry --unk_noun--
23947 --unk-- --unknown-noun-- cessation --unk_noun--
24005 --unk-- --unknown-noun-- mothballing --unk_noun--
24168 --unk-- --unknown-noun-- synthesizer --unk_noun--
24195 --unk-- --unknown-adjective-- distinctly --unk_adj--
24280 --unk-- --unknown-noun-- synthesizer --unk_noun--
24293 --unk-- --unknown-adjective-- robotic --unk_adj--
24294 --unk-- --unknown-noun-- flatness --unk_noun--
24861 --unk-- --unknown-noun-- carnage --unk_noun--
25248 --unk-- --unknown-adjective-- frantic --unk_adj--
25252 --unk-- --unknown-noun-- hammer --unk_noun--
26001 --unk-- --unknown-noun-- whisper --unk_noun--
27468 --unk-- --unknown-noun-- prophecy --unk_noun--
27538 --unk-- --unknown-noun-- encircling --unk_noun--
27716 --unk-- --unknown-verb-- realestate --unk_verb--
27994 --unk-- --unknown-noun-- insolvency --unk_noun--
28110 --unk-- --unknown-adjective-- forceful --unk_adj--
28195 --unk-- --unknown-adjective-- zealous --unk_adj--
28485 --unk-- --unknown-adjective-- belatedly --unk_adj--
29370 --unk-- --unknown-verb-- duplicate --unk_verb--
29902 --unk-- --unknown-adjective-- reptilian --unk_adj--
30078 --unk-- --unknown-noun-- industrialization --unk_noun--
31292 --unk-- --unknown-adjective-- vociferous --unk_adj--
31303 --unk-- --unknown-adjective-- powerless --unk_adj--
31549 --unk-- --unknown-noun-- provocation --unk_noun--
31648 --unk-- --unknown-adjective-- archaic --unk_adj--
31700 --unk-- --unknown-noun-- lament --unk_noun--
32149 --unk-- --unknown-adjective-- tantalizingly --unk_adj--
32393 --unk-- --unknown-noun-- hammer --unk_noun--
33208 --unk-- --unknown-adjective-- defiantly --unk_adj--
33238 --unk-- --unknown-noun-- rickety --unk_noun--
33280 --unk-- --unknown-noun-- unionist --unk_noun--
33336 --unk-- --unknown-noun-- dapper --unk_noun--
33721 --unk-- --unknown-adjective-- repressive --unk_adj--
33832 --unk-- --unknown-noun-- disillusionment --unk_noun--
33861 --unk-- --unknown-noun-- agitation --unk_noun--
</pre>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">(</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">loader</span><span class="o">.</span><span class="n">vocabulary_words</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"--u"</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</pre></div>
<pre class="example">
--unknown--
--unknown-adjective--
--unknown-adverb--
--unknown-digit--
--unknown-noun--
--unknown-punctuation--
--unknown-uppercase--
--unknown-verb--
</pre></div>
</div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/nlp/" rel="tag">nlp</a></li>
<li><a class="tag p-category" href="../../../categories/pos-tagging/" rel="tag">pos tagging</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../parts-of-speech-tagging/" rel="prev" title="Parts-of-Speech Tagging">Previous post</a></li>
<li class="next"><a href="../parts-of-speech-tagging-training/" rel="next" title="Parts-of-Speech Tagging: Training">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Scribbles by <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
<div id="license" xmlns:cc="http://creativecommons.org/ns#">This work is licensed under <a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" rel="license noopener noreferrer" style="display:inline-block;" target="_blank">CC BY 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"></a></div>
</footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
