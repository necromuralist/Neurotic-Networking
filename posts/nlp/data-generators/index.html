<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Data Generators in python." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Data Generators | Neurotic Networking</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/data-generators/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../introducing-trax/" rel="prev" title="Introducing Trax" type="text/html">
<link href="../sentiment-analysis-deep-learning-model/" rel="next" title="Sentiment Analysis: Deep Learning Model" type="text/html">
<meta content="Neurotic Networking" property="og:site_name">
<meta content="Data Generators" property="og:title">
<meta content="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/data-generators/" property="og:url">
<meta content="Data Generators in python." property="og:description">
<meta content="article" property="og:type">
<meta content="2020-12-23T12:50:22-08:00" property="article:published_time">
<meta content="data" property="article:tag">
<meta content="nlp" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../../"><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Data Generators</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2020-12-23T12:50:22-08:00" itemprop="datePublished" title="2020-12-23 12:50">2020-12-23 12:50</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgdc7f4e1">Data generators</a>
<ul>
<li><a href="#orgd121ec1">Imports</a></li>
</ul>
</li>
<li><a href="#org8519113">Examples</a>
<ul>
<li><a href="#org91205ec">An Example of a Circular List</a></li>
<li><a href="#orgc59df12">Shuffling the data order</a></li>
<li><a href="#org1938eb9">Data Generator Function</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgdc7f4e1">
<h2 id="orgdc7f4e1">Data generators</h2>
<div class="outline-text-2" id="text-orgdc7f4e1">
<p>In Python, a <a href="https://wiki.python.org/moin/Generators">generator</a> is a function that behaves like an iterator. It will return the next item. In many AI applications, it is advantageous to have a data generator to handle loading and transforming data for different applications.</p>
<p>In the following example, we use a set of samples <code>a</code>, to derive a new set of samples, with more elements than the original set.</p>
<p><b>Note:</b> Pay attention to the use of list <code>lines_index</code> and variable <code>index</code> to traverse the original list.</p>
</div>
<div class="outline-3" id="outline-container-orgd121ec1">
<h3 id="orgd121ec1">Imports</h3>
<div class="outline-text-3" id="text-orgd121ec1">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">cycle</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be_true</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">import</span> <span class="nn">numpy</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org8519113">
<h2 id="org8519113">Examples</h2>
<div class="outline-text-2" id="text-org8519113"></div>
<div class="outline-3" id="outline-container-org91205ec">
<h3 id="org91205ec">An Example of a Circular List</h3>
<div class="outline-text-3" id="text-org91205ec">
<p>This is sort of a fake generator that uses indices to make it look like it's infinite.</p>
<div class="highlight">
<pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">a_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>                      <span class="c1"># similar to index in data_generator below</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>        <span class="c1"># `b` is longer than `a` forcing a wrap   </span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">a_size</span>    
</pre></div>
<pre class="example">
1,2,3,4,1,2,3,4,1,2,
</pre>
<p>There's a python built-in that's equivalent to this called <a href="https://docs.python.org/3/library/itertools.html#itertools.cycle">cycle</a>.</p>
<div class="highlight">
<pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>    
</pre></div>
<pre class="example">
1,2,3,4,1,2,3,4,1,2,
</pre>
<p>And if you wanted to make your own generator version you could use the yield keyword.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">infinite</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Generates elements infinitely</span>

<span class="sd">    Args:</span>
<span class="sd">     a: list</span>

<span class="sd">    Yields:</span>
<span class="sd">     elements of a</span>
<span class="sd">    """</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">end</span>
    <span class="k">return</span>

<span class="n">a_infinite</span> <span class="o">=</span> <span class="n">infinite</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a_infinite</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span>
</pre></div>
<pre class="example">
1,2,3,4,1,2,3,4,1,2,
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgc59df12">
<h3 id="orgc59df12">Shuffling the data order</h3>
<div class="outline-text-3" id="text-orgc59df12">
<p>In the next example, we will do the same as before, but shuffling the order of the elements in the output list. Note that here, our strategy of traversing using <code>lines_index</code> and <code>index</code> becomes very important, because we can simulate a shuffle in the input data, without doing that in reality.</p>
<div class="highlight">
<pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">a_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">data_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">a_size</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Original order of indices: </span><span class="si">{</span><span class="n">data_indices</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Original order of indices: [0, 1, 2, 3]
</pre>
<p>If we shuffle the index_list we can change the order of our circular list without modifying the order or our original data.</p>
<div class="highlight">
<pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">data_indices</span><span class="p">)</span> <span class="c1"># Shuffle the order</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Shuffled order of indices: </span><span class="si">{</span><span class="n">data_indices</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Shuffled order of indices: [3, 0, 1, 2]
</pre>
<p>Now we create a list of random values from a that is larger than a.</p>
<div class="highlight">
<pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">data_indices</span><span class="p">]</span>
<span class="n">b_size</span> <span class="o">=</span> <span class="mi">10</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"New value order for first batch: </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">batch_counter</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">data_index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">b_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">b_size</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">data_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">batch_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Shuffled Indexes for Batch No. </span><span class="si">{</span><span class="n">batch_counter</span><span class="si">}</span><span class="s2"> :</span><span class="si">{</span><span class="n">data_indices</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Values for Batch No.</span><span class="si">{</span><span class="n">batch_counter</span><span class="si">}</span><span class="s2"> :</span><span class="si">{</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">data_indices</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">data_indices</span><span class="p">[</span><span class="n">data_index</span><span class="p">]])</span>
    <span class="n">data_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">a_size</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Final value of b: </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="si">}</span><span class="s2"> items"</span><span class="p">)</span>
</pre></div>
<pre class="example">
New value order for first batch: [1, 3, 4, 2]

Shuffled Indexes for Batch No. 2 :[1, 3, 2, 0]
Values for Batch No.2 :[2, 4, 3, 1]

Shuffled Indexes for Batch No. 3 :[0, 3, 2, 1]
Values for Batch No.3 :[1, 4, 3, 2]

Final value of b: [1, 3, 4, 2, 2, 4, 3, 1, 1, 4] with 10 items
</pre>
<p><b>Note:</b> We call an epoch each time that an algorithm passes over all the training examples. Shuffling the examples for each epoch is known to reduce variance, making the models more general and overfit less.</p>
<p>Using sample. instead.</p>
<div class="highlight">
<pre><span></span><span class="n">data_indices</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">a_size</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">a_size</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">data_indices</span><span class="p">]</span>
<span class="n">b_size</span> <span class="o">=</span> <span class="mi">10</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"New value order for first batch: </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">batch_counter</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">data_index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">b_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">b_size</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">data_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">batch_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">data_indices</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">data_indices</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">a_size</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Shuffled Indexes for Batch No. </span><span class="si">{</span><span class="n">batch_counter</span><span class="si">}</span><span class="s2"> :</span><span class="si">{</span><span class="n">data_indices</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Values for Batch No.</span><span class="si">{</span><span class="n">batch_counter</span><span class="si">}</span><span class="s2"> :</span><span class="si">{</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">data_indices</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">data_indices</span><span class="p">[</span><span class="n">data_index</span><span class="p">]])</span>
    <span class="n">data_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">a_size</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Final value of b: </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="si">}</span><span class="s2"> items"</span><span class="p">)</span>
</pre></div>
<pre class="example">
New value order for first batch: [1, 4, 3, 2]

Shuffled Indexes for Batch No. 2 :[3, 0, 1, 2]
Values for Batch No.2 :[4, 1, 2, 3]

Shuffled Indexes for Batch No. 3 :[2, 0, 1, 3]
Values for Batch No.3 :[3, 1, 2, 4]

Final value of b: [1, 4, 3, 2, 4, 1, 2, 3, 3, 1] with 10 items
</pre></div>
</div>
<div class="outline-3" id="outline-container-org1938eb9">
<h3 id="org1938eb9">Data Generator Function</h3>
<div class="outline-text-3" id="text-org1938eb9">
<p>This will be a data generator function that takes in <code>batch_size, x, y shuffle</code> where x could be a large list of samples, and y is a list of the tags associated with those samples. Return a subset of those inputs in a tuple of two arrays <code>(X,Y)</code>. Each is an array of dimension (<code>batch_size</code>). If <code>shuffle=True</code>, the data will be traversed in a random form.</p>
<p>Which runs continuously in the fashion of generators, pausing when yielding the next values. We will generate a <code>batch_size</code> output on each pass of this loop.</p>
<p>It has an inner loop that stores the data samples in temporary lists <code>(X, Y)</code> which will be included in the next batch.</p>
<p>There are three slightly out-of-the-ordinary features to this function.</p>
<ol class="org-ol">
<li>The first is the use of a list of a predefined size to store the data for each batch. Using a predefined size list reduces the computation time if the elements in the array are of a fixed size, like numbers. If the elements are of different sizes, it is better to use an empty array and append one element at a time during the loop.</li>
<li>The second is tracking the current location in the incoming lists of samples. Generators variables hold their values between invocations, so we create an <code>index</code> variable, initialize to zero, and increment by one for each sample included in a batch. However, we do not use the <code>index</code> to access the positions of the list of sentences directly. Instead, we use it to select one index from a list of indexes. In this way, we can change the order in which we traverse our original list, keeping untouched our original list.</li>
<li>The third also relates to wrapping. Because <code>batch_size</code> and the length of the input lists are not aligned, gathering a <code>batch_size</code> group of inputs may involve wrapping back to the beginning of the input loop. In our approach, it is just enough to reset the <code>index</code> to 0. We can re-shuffle the list of indexes to produce different batches each time.</li>
</ol>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">data_generator</span><span class="p">(</span><span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">data_x</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">data_y</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Infinite batch generator</span>

<span class="sd">      Args: </span>
<span class="sd">       batch_size: the size to make batches</span>
<span class="sd">       data_x: list containing samples</span>
<span class="sd">       data_y: list containing labels</span>
<span class="sd">       shuffle: Shuffle the data order</span>

<span class="sd">      Yields:</span>
<span class="sd">       a tuple containing 2 elements:</span>
<span class="sd">       X - list of dim (batch_size) of samples</span>
<span class="sd">       Y - list of dim (batch_size) of labels</span>
<span class="sd">    """</span>
    <span class="n">amount_of_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_x</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">amount_of_data</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">re_shuffle</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>

    <span class="n">shuffler</span> <span class="o">=</span> <span class="n">re_shuffle</span> <span class="k">if</span> <span class="n">shuffle</span> <span class="k">else</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="n">source_indices</span> <span class="o">=</span> <span class="n">shuffler</span><span class="p">(</span><span class="n">data_x</span><span class="p">)</span>

    <span class="n">source_location</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">batch_size</span><span class="p">))</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">batch_size</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">batch_location</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">batch_size</span><span class="p">):</span>                            
            <span class="n">X</span><span class="p">[</span><span class="n">batch_location</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_x</span><span class="p">[</span><span class="n">source_indices</span><span class="p">[</span><span class="n">source_location</span><span class="p">]]</span>
            <span class="n">Y</span><span class="p">[</span><span class="n">batch_location</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_y</span><span class="p">[</span><span class="n">source_indices</span><span class="p">[</span><span class="n">source_location</span><span class="p">]]</span>
            <span class="n">source_location</span> <span class="o">=</span> <span class="p">(</span><span class="n">source_location</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">amount_of_data</span>
            <span class="n">source_indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">shuffler</span><span class="p">(</span><span class="n">data_x</span><span class="p">)</span> <span class="k">if</span> <span class="n">source_location</span> <span class="o">==</span> <span class="mi">0</span>
                              <span class="k">else</span> <span class="n">source_indices</span><span class="p">)</span>            
        <span class="k">yield</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">test_data_generator</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Tests the un-shuffled version of the generator</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError: some value didn't match.</span>
<span class="sd">    """</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>

    <span class="n">generator</span> <span class="o">=</span> <span class="n">data_generator</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">expected</span> <span class="ow">in</span> <span class="p">(([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">]),</span>
                     <span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span>
                     <span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
                     <span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">])):</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">generator</span><span class="p">),</span> <span class="n">expected</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
    <span class="k">return</span>
<span class="n">test_data_generator</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/data/" rel="tag">data</a></li>
<li><a class="tag p-category" href="../../../categories/nlp/" rel="tag">nlp</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../introducing-trax/" rel="prev" title="Introducing Trax">Previous post</a></li>
<li class="next"><a href="../sentiment-analysis-deep-learning-model/" rel="next" title="Sentiment Analysis: Deep Learning Model">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer"><a href="https://creativecommons.org/licenses/by/4.0/" rel="license"><img alt="Creative Commons License" id="license-image" src="https://licensebuttons.net/l/by/4.0/80x15.png" style="border-width:0"></a>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>. <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
