<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Using hash tables to map word vectors." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Hash Tables | Neurotic Networking</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/hash-tables/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../more-matrix-math-in-python/" rel="prev" title="More Matrix Math in Python" type="text/html">
<link href="../machine-translation-with-approximate-knn/" rel="next" title="Approximate kNN for Machine Translation" type="text/html">
<meta content="Neurotic Networking" property="og:site_name">
<meta content="Hash Tables" property="og:title">
<meta content="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/hash-tables/" property="og:url">
<meta content="Using hash tables to map word vectors." property="og:description">
<meta content="article" property="og:type">
<meta content="2020-10-07T19:37:18-07:00" property="article:published_time">
<meta content="hash tables" property="article:tag">
<meta content="nlp" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../../"><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Hash Tables</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2020-10-07T19:37:18-07:00" itemprop="datePublished" title="2020-10-07 19:37">2020-10-07 19:37</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org2060e97">Beginning</a>
<ul>
<li><a href="#org9083af7">Imports</a></li>
<li><a href="#org351b38b">Set Up</a></li>
</ul>
</li>
<li><a href="#org8a49226">Middle</a>
<ul>
<li><a href="#org9fa26db">A Basic Hash Table</a></li>
<li><a href="#orga55c0e2">Multiplane Hash Functions</a></li>
<li><a href="#org6bad7f9">Multiple PLanes</a></li>
<li><a href="#org8f48834">Random Planes</a></li>
<li><a href="#orge9f38ff">Document Vectors</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org2060e97">
<h2 id="org2060e97">Beginning</h2>
<div class="outline-text-2" id="text-org2060e97"></div>
<div class="outline-3" id="outline-container-org9083af7">
<h3 id="org9083af7">Imports</h3>
<div class="outline-text-3" id="text-org9083af7">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">Namespace</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">pprint</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>

<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org351b38b">
<h3 id="org351b38b">Set Up</h3>
<div class="outline-text-3" id="text-org351b38b"></div>
<div class="outline-4" id="outline-container-org41c3b66">
<h4 id="org41c3b66">Plotting</h4>
<div class="outline-text-4" id="text-org41c3b66">
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"hash-tables"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">"files/posts/nlp/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">Plot</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">990</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">780</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">tan</span><span class="o">=</span><span class="s2">"#ddb377"</span><span class="p">,</span>
    <span class="n">blue</span><span class="o">=</span><span class="s2">"#4687b7"</span><span class="p">,</span>
    <span class="n">red</span><span class="o">=</span><span class="s2">"#ce7b6d"</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgf1e5fa2">
<h4 id="orgf1e5fa2">Random Number Generator</h4>
<div class="outline-text-4" id="text-orgf1e5fa2">
<div class="highlight">
<pre><span></span><span class="n">numpy_random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgcc798b6">
<h4 id="orgcc798b6">Pretty Printer</h4>
<div class="outline-text-4" id="text-orgcc798b6">
<div class="highlight">
<pre><span></span><span class="n">pretty</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">PrettyPrinter</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org8a49226">
<h2 id="org8a49226">Middle</h2>
<div class="outline-text-2" id="text-org8a49226"></div>
<div class="outline-3" id="outline-container-org9fa26db">
<h3 id="org9fa26db">A Basic Hash Table</h3>
<div class="outline-text-3" id="text-org9fa26db">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">basic_hash_table</span><span class="p">(</span><span class="n">things_to_hash</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">buckets</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">"""Create a basic hash table</span>

<span class="sd">    Args :</span>
<span class="sd">     things_to_hash: list of integers to hash</span>
<span class="sd">     buckets: number of buckets in the table</span>

<span class="sd">    Returns:</span>
<span class="sd">     hash_table: the things to hash sorted into their buckets</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">hash_function</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">buckets</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""Maps the value to an integer</span>

<span class="sd">       Args:</span>
<span class="sd">        value: what to hash</span>
<span class="sd">        n_buckets: number of buckets in the hash table</span>

<span class="sd">       Returns:</span>
<span class="sd">        remainder of value//n_buckets</span>
<span class="sd">       """</span>        
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">%</span> <span class="n">buckets</span>

     <span class="c1"># Initialize all the buckets in the hash table as empty lists</span>
    <span class="n">hash_table</span> <span class="o">=</span> <span class="p">{</span><span class="n">bucket</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">buckets</span><span class="p">)}</span>

    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">things_to_hash</span><span class="p">:</span>
         <span class="c1"># Get the hash key for the given value</span>
        <span class="n">hash_value</span> <span class="o">=</span> <span class="n">hash_function</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">buckets</span><span class="p">)</span>

         <span class="c1"># Add the element to the corresponding bucket</span>
        <span class="n">hash_table</span><span class="p">[</span><span class="n">hash_value</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hash_table</span>
</pre></div>
<p>The <code>basic_hash_table</code> maps values that can be cast to integers to a dictionary of lists. Let's see what it does.</p>
<div class="highlight">
<pre><span></span><span class="n">examples</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">97</span><span class="p">]</span>
<span class="n">hash_table_example</span> <span class="o">=</span> <span class="n">basic_hash_table</span><span class="p">(</span><span class="n">examples</span><span class="p">,</span> <span class="n">buckets</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">pretty</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">hash_table_example</span><span class="p">)</span>
</pre></div>
<pre class="example">
{0: [100, 10],
 1: [],
 2: [],
 3: [],
 4: [14],
 5: [],
 6: [],
 7: [17, 97],
 8: [],
 9: []}
</pre>
<p>This Basic Hash Table maps the values based on their remainder after dividing the value by the number of buckets. In this case there are ten buckets so the value gets mapped to the value in its ones column.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orga55c0e2">
<h3 id="orga55c0e2">Multiplane Hash Functions</h3>
<div class="outline-text-3" id="text-orga55c0e2">
<p>To visualize it we'll start with a single plane and color some points based on which side of the plane they fall.</p>
<p>I'll start by defining the vector that we'll use to decide which side of the plane a vector is on (by taking the dot product and checking the sign of the result).</p>
<div class="highlight">
<pre><span></span><span class="n">decider</span>  <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
</pre></div>
<p>This isn't the separating plane but rather a vector perpendicular to the separating plane. You don't need the separating plane to make the categorizations of the vectors, but for the sake of visualization it might be useful to see it. We can create it by creating a rotation matrix that rotates our originar vector 90 degrees.</p>
<div class="highlight">
<pre><span></span><span class="n">theta_1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>

<span class="n">rotation</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_1</span><span class="p">),</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_1</span><span class="p">)],</span>
                        <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_1</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_1</span><span class="p">)]])</span>

<span class="n">plane</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotation</span><span class="p">,</span> <span class="n">decider</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
<p>Now we can plot them along with some categorized points.</p>
<p>First plot the vector we use to decide what side of the plane the points are.</p>
<div class="highlight">
<pre><span></span><span class="c1"># so to plot it I'll add a starting point</span>
<span class="n">COLUMNS</span> <span class="o">=</span> <span class="s2">"X Y"</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="n">decider_plotter</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">start</span><span class="p">,</span> <span class="n">plane</span><span class="p">])</span>
<span class="n">decider_plotter</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">COLUMNS</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">decider_plotter</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"X"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Y"</span><span class="p">)</span>
</pre></div>
<p>Now plot the plane that separates the categories. I'll scale it a little to move the plot back a little. Also the rotation gives us only the line segment rotated by 90 degrees so I'm going to negate it to get the -90 segment as well to complete the rendering of the plane.</p>
<div class="highlight">
<pre><span></span><span class="n">SCALE</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">plane_plotter</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plane</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">*</span> <span class="n">SCALE</span>
<span class="n">plane_plotter</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">COLUMNS</span>
<span class="n">plot</span> <span class="o">*=</span> <span class="n">plane_plotter</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"X"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Y"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">tan</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">)</span>

<span class="n">plane_plotter</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">plot</span> <span class="o">*=</span> <span class="n">plane_plotter</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"X"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Y"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">tan</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">)</span>
</pre></div>
<p>Now we get to the points. The main lines to pay attention to are the calculation of the <code>side_of_plane</code> value and the conditional. The <code>side_of_plane</code> is an array but you can do boolean equality checks with integers as shown.</p>
<div class="highlight">
<pre><span></span><span class="c1">## Get a pair of random numbers between -4 and 4 </span>
<span class="n">POINTS</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">LIMIT</span> <span class="o">=</span> <span class="mi">4</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">POINTS</span><span class="p">):</span>
    <span class="n">vector</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">numpy_random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">LIMIT</span><span class="p">,</span> <span class="n">LIMIT</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span> 
                              <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">])</span>
    <span class="n">side_of_plane</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">plane</span><span class="p">,</span> <span class="n">vector</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> 

    <span class="k">if</span> <span class="n">side_of_plane</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">plot</span> <span class="o">*=</span> <span class="n">vector</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"x"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"y"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">blue</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plot</span> <span class="o">*=</span> <span class="n">vector</span><span class="o">.</span><span class="n">hvplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"x"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"y"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>

<span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Plane Hash Table"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="n">Plot</span><span class="o">.</span><span class="n">fontscale</span><span class="p">,</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">LIMIT</span><span class="p">,</span> <span class="n">LIMIT</span><span class="p">),</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">LIMIT</span><span class="p">,</span> <span class="n">LIMIT</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"multiplane_hash"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="multiplane_hash.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>So the dashed tan line is our separation plane and the blue line segment is the vector we use to decide which side of the plane the dots are on. The blue dots have a positive dot product with the blue vector and the red dots have a negative dot product with the blue vector.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org6bad7f9">
<h3 id="org6bad7f9">Multiple PLanes</h3>
<div class="outline-text-3" id="text-org6bad7f9">
<div class="highlight">
<pre><span></span><span class="n">plane_1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">plane_2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">plane_3</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">multi_plane</span> <span class="o">=</span> <span class="p">[</span><span class="n">plane_1</span><span class="p">,</span> <span class="n">plane_2</span><span class="p">,</span> <span class="n">plane_3</span><span class="p">]</span>

<span class="n">search_vector</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">side_of_plane</span><span class="p">(</span><span class="n">plane</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">vector</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Finds the side of the plane that the vector is</span>

<span class="sd">    Args:</span>
<span class="sd">     plane: separating plane</span>
<span class="sd">     vector: location to check </span>

<span class="sd">    Returns:</span>
<span class="sd">     sign of the dot product between the plane and the vector</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">plane</span><span class="p">,</span> <span class="n">vector</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">hash_multi_plane</span><span class="p">(</span><span class="n">planes</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">vector</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Creates hash value for set of planes</span>

<span class="sd">    Args:</span>
<span class="sd">     planes: list of arrays to hash</span>
<span class="sd">     vector: array to determine which side of the planes are positive</span>

<span class="sd">    Returns:</span>
<span class="sd">     hash_value: the hash for plane matching the vector</span>
<span class="sd">    """</span>
    <span class="n">hash_value</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">plane</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">planes</span><span class="p">):</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="n">side_of_plane</span><span class="p">(</span><span class="n">plane</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span>

        <span class="c1"># increment the hash if the sign is non-negative</span>
        <span class="n">hash_i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">sign</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">hash_value</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">**</span><span class="n">index</span> <span class="o">*</span> <span class="n">hash_i</span>
    <span class="k">return</span> <span class="n">hash_value</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">hash_multi_plane</span><span class="p">(</span><span class="n">multi_plane</span><span class="p">,</span> <span class="n">search_vector</span><span class="p">))</span>
</pre></div>
<pre class="example">
3
</pre></div>
</div>
<div class="outline-3" id="outline-container-org8f48834">
<h3 id="org8f48834">Random Planes</h3>
<div class="outline-text-3" id="text-org8f48834">
<div class="highlight">
<pre><span></span><span class="n">numpy_random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">num_dimensions</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">num_planes</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">random_planes_matrix</span> <span class="o">=</span> <span class="n">numpy_random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
                       <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">num_planes</span><span class="p">,</span>
                             <span class="n">num_dimensions</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">random_planes_matrix</span><span class="p">)</span>
</pre></div>
<pre class="example">
[[ 0.12573022 -0.13210486]
 [ 0.64042265  0.10490012]
 [-0.53566937  0.36159505]]
</pre>
<div class="highlight">
<pre><span></span><span class="n">search_vector</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">side_of_plane_matrix</span><span class="p">(</span><span class="n">planes</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">vector</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""Decides which side of planes vector is on</span>

<span class="sd">    Returns:</span>
<span class="sd">     side-of-plane value for vector with respect to each plane</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">planes</span><span class="p">,</span> <span class="n">vector</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">side_of_plane_matrix</span><span class="p">(</span><span class="n">random_planes_matrix</span><span class="p">,</span> <span class="n">search_vector</span><span class="p">))</span>
</pre></div>
<pre class="example">
[[-1.]
 [ 1.]
 [-1.]]
</pre>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">hash_multi_plane_matrix</span><span class="p">(</span><span class="n">planes</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                            <span class="n">vector</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                            <span class="n">num_planes</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">"""calculates hash for vector with respect to planes"""</span>
    <span class="n">sides_matrix</span> <span class="o">=</span> <span class="n">side_of_plane_matrix</span><span class="p">(</span><span class="n">planes</span><span class="p">,</span> <span class="n">vector</span><span class="p">)</span>
    <span class="n">hash_value</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_planes</span><span class="p">):</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="n">sides_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="c1"># Get the value inside the matrix cell</span>
        <span class="n">hash_i</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">sign</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">hash_value</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span> <span class="o">*</span> <span class="n">hash_i</span> <span class="c1"># sum 2^i * hash_i</span>
    <span class="k">return</span> <span class="n">hash_value</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">sm</span> <span class="o">=</span> <span class="n">side_of_plane_matrix</span><span class="p">(</span><span class="n">random_planes_matrix</span><span class="p">,</span> <span class="n">search_vector</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">hash_multi_plane_matrix</span><span class="p">(</span><span class="n">random_planes_matrix</span><span class="p">,</span> <span class="n">search_vector</span><span class="p">,</span> <span class="n">num_planes</span><span class="p">))</span>
</pre></div>
<pre class="example">
2
</pre></div>
</div>
<div class="outline-3" id="outline-container-orge9f38ff">
<h3 id="orge9f38ff">Document Vectors</h3>
<div class="outline-text-3" id="text-orge9f38ff">
<p>This is how you would convert a document to an embedding using word vectors (just add up all the vectors for the words in the document).</p>
<div class="highlight">
<pre><span></span><span class="n">word_embedding</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"I"</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span>
                  <span class="s2">"love"</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span>
                  <span class="s2">"learning"</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
                  <span class="p">}</span>
<span class="n">document</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'I'</span><span class="p">,</span> <span class="s1">'love'</span><span class="p">,</span> <span class="s1">'learning'</span><span class="p">,</span> <span class="s1">'not_a_word'</span><span class="p">]</span>
<span class="n">document_embedding</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">document</span><span class="p">:</span>
    <span class="n">document_embedding</span> <span class="o">+=</span> <span class="n">word_embedding</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">document_embedding</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1 0 3]
</pre></div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/hash-tables/" rel="tag">hash tables</a></li>
<li><a class="tag p-category" href="../../../categories/nlp/" rel="tag">nlp</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../more-matrix-math-in-python/" rel="prev" title="More Matrix Math in Python">Previous post</a></li>
<li class="next"><a href="../machine-translation-with-approximate-knn/" rel="next" title="Approximate kNN for Machine Translation">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer"><a href="https://creativecommons.org/licenses/by/4.0/" rel="license"><img alt="Creative Commons License" id="license-image" src="https://licensebuttons.net/l/by/4.0/80x15.png" style="border-width:0"></a>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>. <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
