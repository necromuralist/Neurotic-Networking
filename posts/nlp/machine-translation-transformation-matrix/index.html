<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Building the Transformation Matrix for English to French translation." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Training the Machine Translation Transformation Matrix | Neurotic Networking</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/machine-translation-transformation-matrix/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../machine-translation/" rel="prev" title="Machine Translation" type="text/html">
<link href="../machine-translation-k-nearest-neighbors/" rel="next" title="Implementing k-Nearest Neighbors for Machine Translation" type="text/html">
<meta content="Neurotic Networking" property="og:site_name">
<meta content="Training the Machine Translation Transformation Matrix" property="og:title">
<meta content="https://necromuralist.github.io/Neurotic-Networking/posts/nlp/machine-translation-transformation-matrix/" property="og:url">
<meta content="Building the Transformation Matrix for English to French translation." property="og:description">
<meta content="article" property="og:type">
<meta content="2020-10-22T17:34:49-07:00" property="article:published_time">
<meta content="machine translation" property="article:tag">
<meta content="nlp" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../../"><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Training the Machine Translation Transformation Matrix</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2020-10-22T17:34:49-07:00" itemprop="datePublished" title="2020-10-22 17:34">2020-10-22 17:34</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgc984c80">Beginning</a>
<ul>
<li><a href="#org3647cb7">Imports</a></li>
<li><a href="#orgc603702">Set Up</a></li>
</ul>
</li>
<li><a href="#org8ce9fc9">Middle</a>
<ul>
<li><a href="#org0c163eb">Translation As Linear Transformation of Embeddings</a></li>
<li><a href="#orga9a309f">Saving It For Later</a></li>
<li><a href="#orgfeb73d7">Check the Tester</a></li>
</ul>
</li>
<li><a href="#orgc7f63b7">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgc984c80">
<h2 id="orgc984c80">Beginning</h2>
<div class="outline-text-2" id="text-orgc984c80">
<p>In a prior post we <a href="../building-the-machine-translation-data-set/">built the translation training set</a>. In this post we'll find the <a href="https://en.wikipedia.org/wiki/Transformation_matrix">Transformation Matrix</a> that maps our English Embeddings to the French ones.</p>
</div>
<div class="outline-3" id="outline-container-org3647cb7">
<h3 id="org3647cb7">Imports</h3>
<div class="outline-text-3" id="text-org3647cb7">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># My Stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
<span class="kn">from</span> <span class="nn">neurotic.nlp.word_embeddings.english_french</span> <span class="kn">import</span> <span class="n">TrainingData</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgc603702">
<h3 id="orgc603702">Set Up</h3>
<div class="outline-text-3" id="text-orgc603702">
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="s2">"posts/nlp/.env"</span><span class="p">)</span>
<span class="n">slug</span> <span class="o">=</span> <span class="s2">"machine-translation-transformation-matrix"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span>
                <span class="n">folder_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">"files/posts/nlp/</span><span class="si">{</span><span class="n">slug</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org8ce9fc9">
<h2 id="org8ce9fc9">Middle</h2>
<div class="outline-text-2" id="text-org8ce9fc9"></div>
<div class="outline-3" id="outline-container-org0c163eb">
<h3 id="org0c163eb">Translation As Linear Transformation of Embeddings</h3>
<div class="outline-text-3" id="text-org0c163eb">
<p>The problem we're working on is creating a translator that converts an English word to a French one. To do this we're using Word Embeddings which allows us to re-state the problem form being about translation to one of finding the transformation matrix that will give us a new embedding that close enough to the French translation that we can use some kind of algorithm to find the French embedding that is closest to it.</p>
<ul class="org-ul">
<li>Given dictionaries of English and French word embeddings we'll create a transformation matrix <i>R</i>.</li>
<li>Given an English word embedding, \(\mathbf{e}\), we can multiply \(\mathbf{eR}\) to get a new word embedding \(\mathbf{f}\).</li>
<li>Both \(\mathbf{e}\) and \(\mathbf{f}\) are <a href="https://en.wikipedia.org/wiki/Row_and_column_vectors">row vectors</a>.</li>
<li>We can then compute the nearest neighbors to \(\mathbf{f}\) in the French embeddings and recommend the word that is most similar to the transformed word embedding.</li>
</ul>
<p><b>Note:</b> <i>e</i> was called <code>X_train</code> in the original assigment and corresponds to the <code>TrainData.x_train</code> property that we built in <a href="../building-the-machine-translation-data-set/">the previous post</a>.</p>
</div>
<div class="outline-4" id="outline-container-org551b784">
<h4 id="org551b784">Rethinking Translation as the Minimization Problem</h4>
<div class="outline-text-4" id="text-org551b784">
<p>Find a matrix <i>R</i> that minimizes the following equation.</p>
<p>\[ \arg \min _{\mathbf{R}}\| \mathbf{X R} - \mathbf{Y}\|_{F} \]</p>
<p>So we're trying to find the transformation matrix that minimizes the distance between an English embedding and its corresponding French embedding. The subscript for the norm (<i>F</i>) means that we're using the <a href="https://en.wikipedia.org/wiki/Matrix_norm#Frobenius_norm">Frobenius norm</a>.</p>
</div>
</div>
<div class="outline-4" id="outline-container-org3a48aec">
<h4 id="org3a48aec">Frobenius norm</h4>
<div class="outline-text-4" id="text-org3a48aec">
<p>The Frobenius Norm of a matrix <i>A</i> (assuming it is of dimension <i>m, n</i>) is defined as the square root of the sum of the absolute squares of its elements:</p>
<p>\[ \|\mathbf{A}\|_{F} \equiv \sqrt{\sum_{i=1}^{m} \sum_{j=1}^{n}\left|a_{i j}\right|^{2}} \]</p>
</div>
</div>
<div class="outline-4" id="outline-container-orgb2b9053">
<h4 id="orgb2b9053">Actual loss function</h4>
<div class="outline-text-4" id="text-orgb2b9053">
<p>In the real world applications, the Frobenius norm loss:</p>
<p>\[ \| \mathbf{XR} - \mathbf{Y}\|_{F} \]</p>
<p>is often replaced by it's squared value divided by <i>m</i>:</p>
<p>\[ \frac{1}{m} \| \mathbf{X R} - \mathbf{Y} \|_{F}^{2} \]</p>
<p>where <i>m</i> is the number of examples (rows in \(\mathbf{X}\)).</p>
<ul class="org-ul">
<li>The same <i>R</i> is found when using this loss function versus the original Frobenius norm.</li>
<li>The reason for taking the square is that it's easier to compute the gradient of the squared Frobenius.</li>
<li>The reason for dividing by <i>m</i> is that we're more interested in the average loss per embedding than the loss for the entire training set.</li>
<li>The loss for all training sets increases with more words (training examples), so taking the average helps us to track the average loss regardless of the size of the training set.</li>
</ul>
</div>
</div>
<div class="outline-4" id="outline-container-org91b949c">
<h4 id="org91b949c">Implementing the Translation Mechanism Described</h4>
<div class="outline-text-4" id="text-org91b949c"></div>
<ul class="org-ul">
<li><a id="org9f8580c"></a>Step 1: Computing the loss<br>
<div class="outline-text-5" id="text-org9f8580c">
<ul class="org-ul">
<li>The loss function will be the squared Frobenoius norm of the difference between the matrix and its approximation, divided by the number of training examples <i>m</i>.</li>
<li>Its formula is:</li>
</ul>
<p>\[ L(X, Y, R)=\frac{1}{m}\sum_{i=1}^{m} \sum_{j=1}^{n}\left( a_{i j} \right)^{2} \]</p>
<p>where \(a_{i j}\) is value in the \(i^{th}\) row and /j/th column of the matrix \(\mathbf{XR}-\mathbf{Y}\).</p>
<p><b>Instructions</b>: complete the <code>compute_loss()</code> function.</p>
<ul class="org-ul">
<li>Compute the approximation of <i>Y</i> by matrix multiplying <i>X</i> and <i>R</i></li>
<li>Compute the difference <i>XR - Y</i></li>
<li>Compute the squared Frobenius norm of the difference and divide it by <i>m</i>.</li>
</ul>
<p>Use matrix operations instead of the <code>numpy.norm</code> function.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">compute_loss</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
<span class="w">    </span><span class="sd">'''</span>
<span class="sd">    Inputs: </span>
<span class="sd">       X: a matrix of dimension (m,n) where the columns are the English embeddings.</span>
<span class="sd">       Y: a matrix of dimension (m,n) where the columns correspong to the French embeddings.</span>
<span class="sd">       R: a matrix of dimension (n,n) - transformation matrix from English to French vector space embeddings.</span>
<span class="sd">    Outputs:</span>
<span class="sd">       L: a matrix of dimension (m,n) - the value of the loss function for given X, Y and R.</span>
<span class="sd">    '''</span>
    <span class="c1">### START CODE HERE (REPLACE INSTANCES OF 'None' with your code) ###</span>
    <span class="c1"># m is the number of rows in X</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># diff is XR - Y</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span> <span class="o">-</span> <span class="n">Y</span>

    <span class="c1"># diff_squared is the element-wise square of the difference</span>
    <span class="n">diff_squared</span> <span class="o">=</span> <span class="n">diff</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># sum_diff_squared is the sum of the squared elements</span>
    <span class="n">sum_diff_squared</span> <span class="o">=</span> <span class="n">diff_squared</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># loss is the sum_diff_squared divided by the number of examples (m)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">sum_diff_squared</span><span class="o">/</span><span class="n">m</span>
    <span class="c1">### END CODE HERE ###</span>
    <span class="k">return</span> <span class="n">loss</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-orgf7d4b4d">
<h4 id="orgf7d4b4d">Step 2: Computing the gradient of loss in respect to transform matrix R</h4>
<div class="outline-text-4" id="text-orgf7d4b4d">
<ul class="org-ul">
<li>Calculate the gradient of the loss with respect to transform matrix <i>R</i>.</li>
<li>The gradient is a matrix that encodes how much a small change in <i>R</i> affects the change in the loss function.</li>
<li>The gradient gives us the direction in which we should decrease <i>R</i> to minimize the loss.</li>
<li>\(m\) is the number of training examples (number of rows in <i>X</i>).</li>
<li>The formula for the gradient of the loss function <i>ùêø(ùëã,ùëå,ùëÖ)</i> is:</li>
</ul>
<p>\[ \frac{d}{dR}ùêø(ùëã,ùëå,ùëÖ)=\frac{d}{dR}\Big(\frac{1}{m}\| X R -Y\|_{F}^{2}\Big) = \frac{2}{m}X^{T} (X R - Y) \]</p>
</div>
<ul class="org-ul">
<li><a id="orgdcb31ab"></a><b>Instructions</b>: Complete the `compute_gradient` function below.<br>
<ul class="org-ul">
<li><a id="org376fb3c"></a>Hints<br>
<div class="outline-text-6" id="text-org376fb3c">
<ul class="org-ul">
<li><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.matrix.T.html">Transposing in numpy</a></li>
<li><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.shape.html">Finding out the dimensions of matrices in numpy</a></li>
<li>Remember to use numpy.dot for matrix multiplication</li>
</ul>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">compute_gradient</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
<span class="w">    </span><span class="sd">'''</span>
<span class="sd">    Inputs: </span>
<span class="sd">       X: a matrix of dimension (m,n) where the columns are the English embeddings.</span>
<span class="sd">       Y: a matrix of dimension (m,n) where the columns correspond to the French embeddings.</span>
<span class="sd">       R: a matrix of dimension (n,n) - transformation matrix from English to French vector space embeddings.</span>
<span class="sd">    Outputs:</span>
<span class="sd">       g: a matrix of dimension (n,n) - gradient of the loss function L for given X, Y and R.</span>
<span class="sd">    '''</span>
    <span class="c1">### START CODE HERE (REPLACE INSTANCES OF 'None' with your code) ###</span>
    <span class="c1"># m is the number of rows in X</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># gradient is X^T(XR - Y) * 2/m</span>
    <span class="n">gradient</span> <span class="o">=</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span> <span class="o">-</span> <span class="n">Y</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">rows</span>
    <span class="k">assert</span> <span class="n">gradient</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
    <span class="c1">### END CODE HERE ###</span>
    <span class="k">return</span> <span class="n">gradient</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org8cdcb8f">
<h4 id="org8cdcb8f">Step 3: Finding the optimal R with gradient descent algorithm</h4>
<div class="outline-text-4" id="text-org8cdcb8f"></div>
<ul class="org-ul">
<li><a id="orgf616f98"></a>Gradient descent<br>
<div class="outline-text-5" id="text-orgf616f98">
<p><a href="https://ml-cheatsheet.readthedocs.io/en/latest/gradient_descent.html">Gradient descent</a> is an iterative algorithm which is used in searching for the optimum of the function.</p>
<ul class="org-ul">
<li>Earlier, we mentioned that the gradient of the loss with respect to the matrix encodes how much a tiny change in some coordinate of that matrix affect the change of loss function.</li>
<li>Gradient descent uses that information to iteratively change matrix <i>R</i> until we reach a point where the loss is minimized.</li>
</ul>
</div>
<ul class="org-ul">
<li><a id="orgbbdecb2"></a>Training with a fixed number of iterations<br>
<div class="outline-text-6" id="text-orgbbdecb2">
<p>Most of the time we iterate for a fixed number of training steps rather than iterating until the loss falls below a threshold.</p>
<p>Pseudocode:</p>
<ol class="org-ol">
<li>Calculate gradient <i>g</i> of the loss with respect to the matrix <i>R</i>.</li>
<li>Update <i>R</i> with the formula:</li>
</ol>
<p>\[ R_{\text{new}}= R_{\text{old}}-\alpha g \]</p>
<p>Where \(\alpha\) is the learning rate, which is a scalar.</p>
</div>
</li>
<li><a id="orgf002137"></a>Learning rate<br>
<div class="outline-text-6" id="text-orgf002137">
<ul class="org-ul">
<li>The learning rate or "step size" \(\alpha\) is a coefficient which decides how much we want to change <i>R</i> in each step.</li>
<li>If we change <i>R</i> too much, we could skip the optimum by taking too large of a step.</li>
<li>If we make only small changes to <i>R</i>, we will need many steps to reach the optimum.</li>
<li>Learning rate \(\alpha\) is used to control those changes.</li>
<li>Values of \(\alpha\) are chosen depending on the problem, and we'll use <code>learning_rate</code> <i>=0.0003</i> as the default value for our algorithm.</li>
</ul>
</div>
</li>
<li><a id="org8b381cb"></a>Exercise 04<br>
<div class="outline-text-6" id="text-org8b381cb">
<p>Instructions: Implement <code>align_embeddings()</code></p>
<div class="highlight">
<pre><span></span> <span class="k">def</span> <span class="nf">align_embeddings</span><span class="p">(</span><span class="n">X</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Y</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                      <span class="n">train_steps</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                      <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.0003</span><span class="p">,</span>
                      <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">129</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">     </span><span class="sd">'''</span>
<span class="sd">     Inputs:</span>
<span class="sd">        X: a matrix of dimension (m,n) where the columns are the English embeddings.</span>
<span class="sd">        Y: a matrix of dimension (m,n) where the columns correspong to the French embeddings.</span>
<span class="sd">        train_steps: positive int - describes how many steps will gradient descent algorithm do.</span>
<span class="sd">        learning_rate: positive float - describes how big steps will  gradient descent algorithm do.</span>
<span class="sd">     Outputs:</span>
<span class="sd">        R: a matrix of dimension (n,n) - the projection matrix that minimizes the F norm ||X R -Y||^2</span>
<span class="sd">     '''</span>
     <span class="c1"># the number of columns in X is the number of dimensions for a word vector (e.g. 300)</span>
     <span class="c1"># R is a square matrix with length equal to the number of dimensions in th  word embedding</span>
     <span class="n">R</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">train_steps</span><span class="p">):</span>
         <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">25</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"loss at iteration </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> is: </span><span class="si">{</span><span class="n">compute_loss</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
         <span class="c1">### START CODE HERE (REPLACE INSTANCES OF 'None' with your code) ###</span>
         <span class="c1"># use the function that you defined to compute the gradient</span>
         <span class="n">gradient</span> <span class="o">=</span> <span class="n">compute_gradient</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>

         <span class="c1"># update R by subtracting the learning rate times gradient</span>
         <span class="n">R</span> <span class="o">-=</span> <span class="n">learning_rate</span> <span class="o">*</span> <span class="n">gradient</span>
         <span class="c1">### END CODE HERE ###</span>
     <span class="k">return</span> <span class="n">R</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><a id="orga92981c"></a>Testing Your Implementation.<br>
<div class="outline-text-5" id="text-orga92981c">
<div class="highlight">
<pre><span></span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">129</span><span class="p">)</span>
 <span class="n">m</span> <span class="o">=</span> <span class="mi">10</span>
 <span class="n">n</span> <span class="o">=</span> <span class="mi">5</span>
 <span class="n">X</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
 <span class="n">Y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="mf">.1</span>
 <span class="n">R</span> <span class="o">=</span> <span class="n">align_embeddings</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>
<pre class="example">
loss at iteration 0 is: 3.4697
loss at iteration 25 is: 3.3795
loss at iteration 50 is: 3.2918
loss at iteration 75 is: 3.2064
</pre>
<p><b>Expected Output:</b></p>
<p>loss at iteration 0 is: 3.7242 loss at iteration 25 is: 3.6283 loss at iteration 50 is: 3.5350 loss at iteration 75 is: 3.4442</p>
</div>
</li>
<li><a id="org9065c42"></a>Calculate transformation matrix<br>
<div class="outline-text-5" id="text-org9065c42">
<p>Using those the training set, find the transformation matrix \(\mathbf{R}\) by calling the function <code>align_embeddings()</code>.</p>
<p><b>NOTE:</b> The code cell below will take a few minutes to fully execute (~3 mins)</p>
<div class="highlight">
<pre><span></span> <span class="n">data</span> <span class="o">=</span> <span class="n">TrainingData</span><span class="p">()</span>
 <span class="n">R_train</span> <span class="o">=</span> <span class="n">align_embeddings</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">y_train</span><span class="p">,</span> <span class="n">train_steps</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</pre></div>
<pre class="example" id="org23f8185">
loss at iteration 0 is: 968.1416
loss at iteration 25 is: 97.6094
loss at iteration 50 is: 26.7949
loss at iteration 75 is: 9.7902
loss at iteration 100 is: 4.3831
loss at iteration 125 is: 2.3324
loss at iteration 150 is: 1.4509
loss at iteration 175 is: 1.0356
loss at iteration 200 is: 0.8263
loss at iteration 225 is: 0.7152
loss at iteration 250 is: 0.6539
loss at iteration 275 is: 0.6188
loss at iteration 300 is: 0.5983
loss at iteration 325 is: 0.5859
loss at iteration 350 is: 0.5783
loss at iteration 375 is: 0.5736
</pre>
<p>Expected Output</p>
<p>#+RESULTS loss at iteration 0 is: 963.0146 loss at iteration 25 is: 97.8292 loss at iteration 50 is: 26.8329 loss at iteration 75 is: 9.7893 loss at iteration 100 is: 4.3776 loss at iteration 125 is: 2.3281 loss at iteration 150 is: 1.4480 loss at iteration 175 is: 1.0338 loss at iteration 200 is: 0.8251 loss at iteration 225 is: 0.7145 loss at iteration 250 is: 0.6534 loss at iteration 275 is: 0.6185 loss at iteration 300 is: 0.5981 loss at iteration 325 is: 0.5858 loss at iteration 350 is: 0.5782 loss at iteration 375 is: 0.5735</p>
</div>
</li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-orga9a309f">
<h3 id="orga9a309f">Saving It For Later</h3>
<div class="outline-text-3" id="text-orga9a309f">
<div class="highlight">
<pre><span></span><span class="o">&lt;&lt;</span><span class="n">trainer</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">the</span><span class="o">-</span><span class="n">trainer</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">trainer</span><span class="o">-</span><span class="n">timer</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">trainer</span><span class="o">-</span><span class="n">loss</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">trainer</span><span class="o">-</span><span class="n">gradient</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">trainer</span><span class="o">-</span><span class="n">align</span><span class="o">-</span><span class="n">embeddings</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org598c5b5">
<h4 id="org598c5b5">Imports</h4>
<div class="outline-text-4" id="text-org598c5b5">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">attr</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orge085713">
<h4 id="orge085713">The Trainer Class</h4>
<div class="outline-text-4" id="text-orge085713">
<p>We could keep it as just functions like it is here, but, nah.</p>
<div class="highlight">
<pre><span></span><span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">auto_attribs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TheTrainer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Trains the word-embeddings data</span>

<span class="sd">    Args:</span>
<span class="sd">     x_train: the training input</span>
<span class="sd">     y_train: the training labels</span>
<span class="sd">     training_steps: number of times to run the training loop</span>
<span class="sd">     learning_rate: multiplier for the gradient (alpha)</span>
<span class="sd">     seed: random-seed for numpy</span>
<span class="sd">     loss_every: if verbose, how often to show loss during fitting</span>
<span class="sd">     verbose: whether to emit messages</span>
<span class="sd">    """</span>
    <span class="n">x_train</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">y_train</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">_timer</span><span class="p">:</span> <span class="n">Timer</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">training_steps</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">400</span>
    <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.8</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">129</span>
    <span class="n">loss_every</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">25</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org8f9421f">
<h4 id="org8f9421f">A Timer</h4>
<div class="outline-text-4" id="text-org8f9421f">
<p>Just something to keep track of how long things take.</p>
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">timer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A timer"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="n">emit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org148ee52">
<h4 id="org148ee52">The Loss Method</h4>
<div class="outline-text-4" id="text-org148ee52">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transformation</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Calculates the loss between XR and Y as the average sum of difference squared</span>

<span class="sd">    Args: </span>
<span class="sd">       transformation: a matrix of dimension (n,n) - transformation matrix.</span>

<span class="sd">    Returns:</span>
<span class="sd">       loss: value of loss function for X, Y and R</span>
<span class="sd">    """</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">difference</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">transformation</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span>
    <span class="n">difference_squared</span> <span class="o">=</span> <span class="n">difference</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">sum_of_difference_squared</span> <span class="o">=</span> <span class="n">difference_squared</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">sum_of_difference_squared</span><span class="o">/</span><span class="n">rows</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgdb907b6">
<h4 id="orgdb907b6">The Gradient</h4>
<div class="outline-text-4" id="text-orgdb907b6">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transformation</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""computes the gradient (slope) of the loss</span>

<span class="sd">    Args: </span>
<span class="sd">       transformation: transformation matrix of dimension (n,n)</span>

<span class="sd">    Returns:</span>
<span class="sd">       gradient: a matrix of dimension (n,n)</span>
<span class="sd">    """</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">gradient</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                  <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">transformation</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="p">)</span><span class="o">/</span><span class="n">rows</span>
    <span class="k">assert</span> <span class="n">gradient</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gradient</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org411476c">
<h4 id="org411476c">The Embeddings Aligner</h4>
<div class="outline-text-4" id="text-org411476c">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Fits the transformation matrix to the data</span>

<span class="sd">    Side Effect:</span>
<span class="sd">     sets self.transformation  and self.losses</span>

<span class="sd">    Returns:</span>
<span class="sd">     the projection matrix that minimizes the F norm ||X R -Y||^2</span>
<span class="sd">    """</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transformation</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Step</span><span class="se">\t</span><span class="s2">Loss"</span><span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">training_steps</span><span class="p">):</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformation</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">step</span> <span class="o">%</span> <span class="mi">25</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transformation</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transformation</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformation</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgfeb73d7">
<h3 id="orgfeb73d7">Check the Tester</h3>
<div class="outline-text-3" id="text-orgfeb73d7"></div>
<div class="outline-4" id="outline-container-org6ed8720">
<h4 id="org6ed8720">Sanity Check</h4>
<div class="outline-text-4" id="text-org6ed8720">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.nlp.word_embeddings.training</span> <span class="kn">import</span> <span class="n">TheTrainer</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">129</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="mf">.1</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">TheTrainer</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">training_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.003</span><span class="p">)</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
<pre class="example">
2020-10-23 18:27:50,195 graeae.timers.timer start: Started: 2020-10-23 18:27:50.195052
2020-10-23 18:27:50,201 graeae.timers.timer end: Ended: 2020-10-23 18:27:50.201767
2020-10-23 18:27:50,203 graeae.timers.timer end: Elapsed: 0:00:00.006715
The loss at step 0 is: 3.7242
The loss at step 25 is: 2.8709
The loss at step 50 is: 2.2201
The loss at step 75 is: 1.7235
</pre></div>
</div>
<div class="outline-4" id="outline-container-org7dde5c9">
<h4 id="org7dde5c9">The Real Data</h4>
<div class="outline-text-4" id="text-org7dde5c9">
<div class="highlight">
<pre><span></span><span class="n">trainer</span> <span class="o">=</span> <span class="n">TheTrainer</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">x_train</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
<pre class="example" id="orgbb8e28a">
2020-10-23 18:30:45,558 graeae.timers.timer start: Started: 2020-10-23 18:30:45.558693
Step    Loss
0       963.0146
25      97.8292
50      26.8329
75      9.7893
100     4.3776
125     2.3281
150     1.4480
175     1.0338
200     0.8251
225     0.7145
250     0.6534
275     0.6185
300     0.5981
325     0.5858
350     0.5782
375     0.5735
2020-10-23 18:31:16,471 graeae.timers.timer end: Ended: 2020-10-23 18:31:16.471708
2020-10-23 18:31:16,473 graeae.timers.timer end: Elapsed: 0:00:30.913015
</pre></div>
</div>
<div class="outline-4" id="outline-container-org1ff3e7e">
<h4 id="org1ff3e7e">Plotting the Losses</h4>
<div class="outline-text-4" id="text-org1ff3e7e">
<div class="highlight">
<pre><span></span><span class="n">losses</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">Step</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trainer</span><span class="o">.</span><span class="n">losses</span><span class="p">))),</span>
                               <span class="n">Loss</span><span class="o">=</span><span class="n">trainer</span><span class="o">.</span><span class="n">losses</span><span class="p">))</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Step"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Loss"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Training Losses"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">990</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">780</span><span class="p">,</span>
    <span class="n">fontscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"#4687b7"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"train_loss"</span><span class="p">)()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</pre></div>
<object data="train_loss.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Although the losses continue to go down, it looks like most of the gains come in the first 100 rounds of training.</p>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgc7f63b7">
<h2 id="orgc7f63b7">End</h2>
<div class="outline-text-2" id="text-orgc7f63b7">
<ul class="org-ul">
<li>The master post with links to all the posts in this series is <a href="../machine-translation/">Machine Translation</a>.</li>
<li>The next post in this series is <a href="../machine-translation-k-nearest-neighbors/">Implementing k-Nearest Neighbors for Machine Translation</a>.</li>
<li>This is part of an Assignment for Coursera's Natural Language Processing Specialization, Course 1, Week 4.</li>
</ul>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/machine-translation/" rel="tag">machine translation</a></li>
<li><a class="tag p-category" href="../../../categories/nlp/" rel="tag">nlp</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../machine-translation/" rel="prev" title="Machine Translation">Previous post</a></li>
<li class="next"><a href="../machine-translation-k-nearest-neighbors/" rel="next" title="Implementing k-Nearest Neighbors for Machine Translation">Next post</a></li>
</ul>
</nav>
</aside>
<script async id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>
<script type="text/x-mathjax-config">

        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']],},

        });
</script>
<link href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script>
<script>

    MathJax = {
        tex: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            processEnvironments: true,
        }
    }
</script>
<link href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script></article>
<!--End of body content-->
<footer id="footer">Scribbles by <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
<div id="license" xmlns:cc="http://creativecommons.org/ns#">This work is licensed under <a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" rel="license noopener noreferrer" style="display:inline-block;" target="_blank">CC BY 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"></a></div>
</footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
