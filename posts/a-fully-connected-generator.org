#+BEGIN_COMMENT
.. title: A Fully Connected Generator
.. slug: a-fully-connected-generator
.. date: 2023-07-01 15:51:10 UTC-07:00
.. tags: gans
.. category: GANs
.. link: 
.. description: A fully connected Generator for GANs.
.. type: text

#+END_COMMENT
#+OPTIONS: ^:{}
#+TOC: headlines 3
#+PROPERTY: header-args :session ~/.local/share/jupyter/runtime/kernel-b3255614-aee3-4f3c-9253-066c01cbf18d.json
#+BEGIN_SRC python :results none :exports none
%load_ext autoreload
%autoreload 2
#+END_SRC

* The Fully Connected Generator Factory

The ~GeneratorFactory~ builds the fully-connected Generator.

#+begin_src plantuml :file ../files/posts/a-fully-connected-generator/fully-connected-factory.png :exports none
!theme mars

class GeneratorFactory {
  input_size: Integer
  output_size: Integer
  hidden_layer_size: Integer
  block_count: Integer
  size_multiplier: Integer
  generator : nn.Sequential

  block(input_size: Integer, output_size: Integer) : nn.Sequential
}
#+end_src

#+RESULTS:
[[file:../files/posts/a-fully-connected-generator/fully-connected-factory.png]]

** Testing the Factory
#+begin_src gherkin :tangle ../tests/features/fully_connected/generator_factory.feature
Feature: A Fully Connected Generator factory
  A builder of fully-connected multi-layer perceptrons to generate images.

Scenario: The default fully-connected generator factory
  Given a default fully-connected-generator-factory
  When the input_size is checked
  And the hidden_size is checked
  Then the input_size is the default
  And the hidden_size is the default
#+end_src

#+begin_src python :tangle ../tests/functional/fully_connected/test_generator_factory.py
"""Fully Connected Generator factory feature tests."""
# from pypi

<<pypi-imports>>

# the software under test
<<factory-import>>

<<scenarios>>

#* Scenario: The default fully-connected generator factory *#

<<given-default-factory>>

<<check-input-size>>

<<check-hidden-size>>

<<default-input-size>>

<<default-hidden-size>>
#+end_src
** The imports
#+begin_src python :noweb-ref pypi-imports
from expects import (
    equal,
    expect   
)
from pytest_bdd import (
    given,
    scenarios,
    then,
    when,
)

and_when = when
#+end_src

*** The Factory Import

#+begin_src python :noweb-ref factory-import
from neurotic.gans.fully_connected import (GeneratorDefault,
                                           GeneratorFactory)
#+end_src
*** Set the Feature File
#+begin_src python :noweb-ref scenarios
scenarios("fully_connected/generator_factory.feature")
#+end_src

*** The Default Factor Scenario

**** The Default Fully Connected Generator Factory

#+begin_src python :noweb-ref given-default-factory
@given("a default fully-connected-generator-factory", target_fixture="factory")
def _():
    return GeneratorFactory()
#+end_src

*** Check the Input Size
#+begin_src python :noweb-ref check-input-size
@when("the input_size is checked", target_fixture="input_size")
def _(factory):
    return factory.input_size
#+end_src

*** Default Input Size

#+begin_src python :noweb-ref default-input-size
@then('the input_size is the default')
def _(input_size):
    expect(input_size).to(equal(GeneratorDefault.input_size))
    return
#+end_src

*** Check Hidden Layer Size

#+begin_src python :noweb-ref check-hidden-size
@and_when("the hidden_size is checked", target_fixture="hidden_size")
def _(factory):
    return factory.hidden_layer_size
#+end_src
*** Default Hidden Layer Size

#+begin_src python :noweb-ref default-hidden-size
@then("the hidden_size is the default")
def _(hidden_size):
    expect(hidden_size).to(equal(GeneratorDefault.hidden_layer_size))
#+end_src
** The Factory

#+begin_src python :tangle ../neurotic/gans/fully_connected.py :exports none
# python
<<python-imports>>


<<generator-defaults>>


<<generator-factory>>
#+end_src

*** Python Imports

#+begin_src python :noweb-ref python-imports
from dataclasses import dataclass
#+end_src

| Item        | Documentation |
|-------------+---------------|
| ~dataclass~ | [[https://docs.python.org/3/library/dataclasses.html][dataclasses]]   |

*** Generator Defaults
The GeneratorDefault class is a [[https://docs.python.org/3/library/dataclasses.html][python dataclass]] to hold the default values for the generator.

#+begin_src python :noweb-ref generator-defaults
@dataclass
class GeneratorDefault:
    """Default values for the generator"""
    input_size: int=10
    hidden_layer_size: int=128
#+end_src

| Attribute         | Description                                                   |
|-------------------+---------------------------------------------------------------|
| input_size        | length of input to the network (presumed 10 is for 10 digits) |
| hidden_layer_size | length of output for first layer                              |

*** The Generator Factory Definition

#+begin_src python :noweb-ref generator-factory
class GeneratorFactory:
    """Builder of fully-connected generators

    Args:

     input_size: length for the input noise-vector
     hidden_layer_size: length of output for first layer
    """
    def __init__(self, input_size=GeneratorDefault.input_size,
                 hidden_layer_size=GeneratorDefault.hidden_layer_size):
        self.input_size = input_size
        self.hidden_layer_size = hidden_layer_size
        return
#+end_src
* The Fully Connected Generator
 #+begin_src plantuml :file ../files/posts/a-fully-connected-generator/fully-connected.png :exports none
!theme mars

class FullyConnected {
 input_dimension: Integer
 image_dimension: Integer
 hidden_dimension: Integer
 generator: Sequential
 forward(noise: torch.Tensor) : torch.Tensor
 make_block(input_features: Integer, output_features: Integer)
}

nn.Sequential <|- FullyConnected
 #+end_src

 #+RESULTS:
 [[file:../files/posts/a-fully-connected-generator/fully-connected.png]]

 [[img-url: fully-connected.png]]
