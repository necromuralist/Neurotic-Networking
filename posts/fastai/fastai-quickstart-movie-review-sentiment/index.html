<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>FastAI Quickstart: Movie Review Sentiment | Neurotic Networking</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-quickstart-movie-review-sentiment/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../fastai-quickstart-segmentation/" rel="prev" title="FastAI Quickstart: Segmentation" type="text/html">
<link href="../fastai-quickstart/" rel="next" title="FastAI QuickStart" type="text/html">
<meta content="Neurotic Networking" property="og:site_name">
<meta content="FastAI Quickstart: Movie Review Sentiment" property="og:title">
<meta content="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-quickstart-movie-review-sentiment/" property="og:url">
<meta content="Table of Contents The Beginning Imports The Model Training the RNN Testing it Out End The Beginning The top post for the quickstart posts is this one and the previous post was on image" property="og:description">
<meta content="article" property="og:type">
<meta content="2022-11-02T19:49:43-07:00" property="article:published_time">
<meta content="fastai" property="article:tag">
<meta content="nlp" property="article:tag">
<meta content="sentiment" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../../"><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">FastAI Quickstart: Movie Review Sentiment</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2022-11-02T19:49:43-07:00" itemprop="datePublished" title="2022-11-02 19:49">2022-11-02 19:49</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orge696dfb">The Beginning</a>
<ul>
<li><a href="#org2b51846">Imports</a></li>
</ul>
</li>
<li><a href="#org43e035b">The Model</a>
<ul>
<li><a href="#orgc4a30b2">Training the RNN</a></li>
<li><a href="#org3144fd8">Testing it Out</a></li>
</ul>
</li>
<li><a href="#orgedca465">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orge696dfb">
<h2 id="orge696dfb">The Beginning</h2>
<div class="outline-text-2" id="text-orge696dfb">
<p>The top post for the quickstart posts is <a href="../fastai-quickstart/">this one</a> and the previous post was on <a href="../fastai-quickstart-segmentation/">image segmentation</a>.</p>
</div>
<div class="outline-3" id="outline-container-org2b51846">
<h3 id="org2b51846">Imports</h3>
<div class="outline-text-3" id="text-org2b51846">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># fastai</span>
<span class="kn">from</span> <span class="nn">fastai.text.all</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">accuracy</span><span class="p">,</span>
    <span class="n">AWD_LSTM</span><span class="p">,</span>
    <span class="n">TextDataLoaders</span><span class="p">,</span>
    <span class="n">text_classifier_learner</span><span class="p">,</span>
    <span class="n">untar_data</span><span class="p">,</span>
    <span class="n">URLs</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># monkey stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>

<span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org43e035b">
<h2 id="org43e035b">The Model</h2>
<div class="outline-text-2" id="text-org43e035b"></div>
<div class="outline-3" id="outline-container-orgc4a30b2">
<h3 id="orgc4a30b2">Training the RNN</h3>
<div class="outline-text-3" id="text-orgc4a30b2">
<p><b>Note:</b> Using <code>untar_data</code> for this dataset seems to fail with a <code>FileNotFoundError</code>. It's looking for a file <code>~/.fastai/data/imdb_tok/counter.pkl</code> that isn't there. It seems to be something that other people have encountered as well (<a href="https://forums.fast.ai/t/filenotfounderror-errno-2/81563">on the fastai forums</a>, <a href="https://github.com/fastai/fastai/issues/2787">on github</a>). This might need to be downloaded the old-fashioned way instead.</p>
<p><b>Update:</b> <code>untar_data</code> seems to successfully download the <code>imdb</code> data but then something goes wrong with the <code>imdb_tok</code> folder. If you just delete it and pass in the path to the <code>imdb</code> folder (e.g. <code>~/.fastai/data/imdb/</code>) to the data loader it seems to work.</p>
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">IMDB</span><span class="p">)</span>
</pre></div>
<p>So here's the bit where we have to work around the <code>untar_data</code> error and pass in the path to the downloaded folder to the <code>TextDataLoaders</code> (why is this plural?).</p>
<p><b>Note:</b> On the machine that I'm using the defaults for the transfer learning causes a CUDA Out of Memory Error. Following the advice in <a href="https://github.com/fastai/fastai/issues/1752">this github ticket</a> I reduced the batch size to get it to work (the default is 64, 32 still crashed so I went for 16) so it takes a fairly long time to finish.</p>
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"~/.fastai/data/imdb/"</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">16</span>

<span class="n">loader</span> <span class="o">=</span> <span class="n">TextDataLoaders</span><span class="o">.</span><span class="n">from_folder</span><span class="p">(</span><span class="n">path</span> <span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="s1">'test'</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<span class="n">learner</span> <span class="o">=</span> <span class="n">text_classifier_learner</span><span class="p">(</span><span class="n">loader</span><span class="p">,</span> <span class="n">AWD_LSTM</span><span class="p">,</span> <span class="n">drop_mult</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">learner</span><span class="o">.</span><span class="n">no_bar</span><span class="p">()</span> <span class="k">as</span> <span class="n">no_bar</span><span class="p">,</span> <span class="n">TIMER</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">learner</span><span class="o">.</span><span class="n">fine_tune</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-11-03 18:19:52.039717
[0, 0.5076004862785339, 0.4184568226337433, 0.8115599751472473, '09:36']
[0, 0.2924654185771942, 0.21511425077915192, 0.9154800176620483, '14:35']
[1, 0.22890949249267578, 0.19540540874004364, 0.9239199757575989, '14:35']
Ended: 2022-11-03 18:58:39.453115
Elapsed: 0:38:47.413398
</pre></div>
</div>
<div class="outline-3" id="outline-container-org3144fd8">
<h3 id="org3144fd8">Testing it Out</h3>
<div class="outline-text-3" id="text-org3144fd8">
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">learner</span><span class="o">.</span><span class="n">no_bar</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"I really like this movie."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"I like this movie."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"I didn't like this movie."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"I hated this movie."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"I really hated this movie."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
<pre class="example">
tensor(0.4845)
tensor(0.8964)
tensor(0.5823)
tensor(0.0839)
tensor(0.1197)
</pre>
<p>It appears to not think "really hated" is more positive than "hated", but more or less follows what you'd expect. But is this a general sentiment analyzer or only a movie sentiment analyzer?</p>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">learner</span><span class="o">.</span><span class="n">no_bar</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"I really like this book."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"I like this car."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"I didn't like this lettuce."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"I hated this weather."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"I really hated this meeting."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
<pre class="example">
tensor(0.9321)
tensor(0.7614)
tensor(0.2984)
tensor(0.0582)
tensor(0.3288)
</pre>
<p>It seems to pretty much follow the same pattern, although it was even more confused by really hating meetings.</p>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">learner</span><span class="o">.</span><span class="n">no_bar</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"This lettuce is great."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"This lettuce is like butter."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"This lettuce was good enough."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"The lettuce was okay."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"I thought this lettuce wasn't very good."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"This lettuce is terrible."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">"This lettuce was worse than spam."</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
<pre class="example">
tensor(0.9444)
tensor(0.2520)
tensor(0.6674)
tensor(0.3201)
tensor(0.4201)
tensor(0.0237)
tensor(0.0191)
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-orgedca465">
<h2 id="orgedca465">End</h2>
<div class="outline-text-2" id="text-orgedca465">
<p>I think as long as you pass in adjectives that it encountered in the reviews it works well enough. In a way it's more interesting to see how terms match up relative to each other (e.g. <i>terrible</i> isn't as bad as <i>hated</i> and <i>okay</i> is worse than <i>wasn't very good</i>) as it gives you a sense of how the reviewers use descriptive words in their reviews.</p>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/fastai/" rel="tag">fastai</a></li>
<li><a class="tag p-category" href="../../../categories/nlp/" rel="tag">nlp</a></li>
<li><a class="tag p-category" href="../../../categories/sentiment/" rel="tag">sentiment</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../fastai-quickstart-segmentation/" rel="prev" title="FastAI Quickstart: Segmentation">Previous post</a></li>
<li class="next"><a href="../fastai-quickstart/" rel="next" title="FastAI QuickStart">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer"><a href="https://creativecommons.org/licenses/by/4.0/" rel="license"><img alt="Creative Commons License" id="license-image" src="https://licensebuttons.net/l/by/4.0/80x15.png" style="border-width:0"></a>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>. <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
