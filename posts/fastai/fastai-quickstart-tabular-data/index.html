<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="A look at the tabular data quickstart for FastAI." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>FastAI QuickStart Tabular Data | Neurotic Networking</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-quickstart-tabular-data/index.html" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../fastai-quickstart/index.html" rel="prev" title="FastAI QuickStart" type="text/html">
<link href="../fastai-lesson-0-is-it-a-bird/index.html" rel="next" title="Raccoon Or Raccoon Dog?" type="text/html">
<meta content="Neurotic Networking" property="og:site_name">
<meta content="FastAI QuickStart Tabular Data" property="og:title">
<meta content="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-quickstart-tabular-data/index.html" property="og:url">
<meta content="A look at the tabular data quickstart for FastAI." property="og:description">
<meta content="article" property="og:type">
<meta content="2022-11-04T17:27:25-07:00" property="article:published_time">
<meta content="fastai" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../../"><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Monkey Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">The Cloistered Monkey</a> <a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Bowling-For-Data/">Bowling For Data</a> <a class="dropdown-item" href="https://necromuralist.github.io/Beach-Pig-Thigh/">Beach-Pig Rump & Thigh</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href="#">FastAI QuickStart Tabular Data</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2022-11-04T17:27:25-07:00" itemprop="datePublished" title="2022-11-04 17:27">2022-11-04 17:27</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="index.html#orgb6ca213">The Beginning</a>
<ul>
<li><a href="index.html#orgc4fb957">Imports</a></li>
</ul>
</li>
<li><a href="index.html#org0d18313">The Middle</a>
<ul>
<li><a href="index.html#org1f5f1c2">The Data</a></li>
<li><a href="index.html#org9f65596">The Data Loader</a></li>
<li><a href="index.html#org5fb9d89">The Learner</a></li>
<li><a href="index.html#orgc79a015">The Learned</a></li>
</ul>
</li>
<li><a href="index.html#org27db1da">Sources</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgb6ca213">
<h2 id="orgb6ca213">The Beginning</h2>
<div class="outline-text-2" id="text-orgb6ca213"></div>
<div class="outline-3" id="outline-container-orgc4fb957">
<h3 id="orgc4fb957">Imports</h3>
<div class="outline-text-3" id="text-orgc4fb957">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="c1"># fastai</span>
<span class="kn">from</span> <span class="nn">fastai.tabular.all</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Categorify</span><span class="p">,</span>
    <span class="n">FillMissing</span><span class="p">,</span>
    <span class="n">Normalize</span><span class="p">,</span>
    <span class="n">TabularDataLoaders</span><span class="p">,</span>
    <span class="n">URLs</span><span class="p">,</span>
    <span class="n">accuracy</span><span class="p">,</span>
    <span class="n">tabular_learner</span><span class="p">,</span>
    <span class="n">untar_data</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># pypy</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">)</span>
<span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org0d18313">
<h2 id="org0d18313">The Middle</h2>
<div class="outline-text-2" id="text-org0d18313"></div>
<div class="outline-3" id="outline-container-org1f5f1c2">
<h3 id="org1f5f1c2">The Data</h3>
<div class="outline-text-3" id="text-org1f5f1c2">
<p>We're using the <a href="https://archive.ics.uci.edu/ml/datasets/Adult">Adult Data Set</a>, which has an unfortunate title but is a dataset built from 1994 census data to predict whether a person has an income greater than $50,000 a year.</p>
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">ADULT_SAMPLE</span><span class="p">)</span>
<span class="n">DATA_PATH</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="s2">"adult.csv"</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="p">)</span>

<span class="n">numerical</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">])</span>
<span class="n">non_numerical</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">])</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">numerical</span><span class="o">.</span><span class="n">describe</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">age</th>
<th class="org-right" scope="col">fnlwgt</th>
<th class="org-right" scope="col">education-num</th>
<th class="org-right" scope="col">capital-gain</th>
<th class="org-right" scope="col">capital-loss</th>
<th class="org-right" scope="col">hours-per-week</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">count</td>
<td class="org-right">32561</td>
<td class="org-right">32561</td>
<td class="org-right">32074</td>
<td class="org-right">32561</td>
<td class="org-right">32561</td>
<td class="org-right">32561</td>
</tr>
<tr>
<td class="org-left">mean</td>
<td class="org-right">38.5816</td>
<td class="org-right">189778</td>
<td class="org-right">10.0798</td>
<td class="org-right">1077.65</td>
<td class="org-right">87.3038</td>
<td class="org-right">40.4375</td>
</tr>
<tr>
<td class="org-left">std</td>
<td class="org-right">13.6404</td>
<td class="org-right">105550</td>
<td class="org-right">2.573</td>
<td class="org-right">7385.29</td>
<td class="org-right">402.96</td>
<td class="org-right">12.3474</td>
</tr>
<tr>
<td class="org-left">min</td>
<td class="org-right">17</td>
<td class="org-right">12285</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">25%</td>
<td class="org-right">28</td>
<td class="org-right">117827</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">50%</td>
<td class="org-right">37</td>
<td class="org-right">178356</td>
<td class="org-right">10</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-left">75%</td>
<td class="org-right">48</td>
<td class="org-right">237051</td>
<td class="org-right">12</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">45</td>
</tr>
<tr>
<td class="org-left">max</td>
<td class="org-right">90</td>
<td class="org-right">1.4847e+06</td>
<td class="org-right">16</td>
<td class="org-right">99999</td>
<td class="org-right">4356</td>
<td class="org-right">99</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">non_numerical</span><span class="o">.</span><span class="n">describe</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">workclass</th>
<th class="org-right" scope="col">education</th>
<th class="org-right" scope="col">marital-status</th>
<th class="org-right" scope="col">occupation</th>
<th class="org-right" scope="col">relationship</th>
<th class="org-right" scope="col">race</th>
<th class="org-right" scope="col">sex</th>
<th class="org-right" scope="col">native-country</th>
<th class="org-right" scope="col">salary</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">count</td>
<td class="org-right">32561</td>
<td class="org-right">32561</td>
<td class="org-right">32561</td>
<td class="org-right">32049</td>
<td class="org-right">32561</td>
<td class="org-right">32561</td>
<td class="org-right">32561</td>
<td class="org-right">32561</td>
<td class="org-right">32561</td>
</tr>
<tr>
<td class="org-left">unique</td>
<td class="org-right">9</td>
<td class="org-right">16</td>
<td class="org-right">7</td>
<td class="org-right">15</td>
<td class="org-right">6</td>
<td class="org-right">5</td>
<td class="org-right">2</td>
<td class="org-right">42</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">top</td>
<td class="org-right">Private</td>
<td class="org-right">HS-grad</td>
<td class="org-right">Married-civ-spouse</td>
<td class="org-right">Prof-specialty</td>
<td class="org-right">Husband</td>
<td class="org-right">White</td>
<td class="org-right">Male</td>
<td class="org-right">United-States</td>
<td class="org-right">&lt;50k</td>
</tr>
<tr>
<td class="org-left">freq</td>
<td class="org-right">22696</td>
<td class="org-right">10501</td>
<td class="org-right">14976</td>
<td class="org-right">4073</td>
<td class="org-right">13193</td>
<td class="org-right">27816</td>
<td class="org-right">21790</td>
<td class="org-right">29170</td>
<td class="org-right">24720</td>
</tr>
</tbody>
</table>
<p>The column names don't really make clear what some things are, but since this is a quickstart I'll ignore their meaning but note that it was useful to split the data up by numeric and non-numeric types becaus when you build the <code>TabularDataLoader</code> you should specify the numeric and categorical column names. The fastai example only specifies some of the columns but I'll dump them all in and see what happens.</p>
<div class="highlight">
<pre><span></span><span class="n">numeric_columns</span> <span class="o">=</span> <span class="n">numerical</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">categorical_columns</span> <span class="o">=</span> <span class="n">non_numerical</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org9f65596">
<h3 id="org9f65596">The Data Loader</h3>
<div class="outline-text-3" id="text-org9f65596">
<p>The original quickstart uses the <code>TabularDataLoaders</code> class to load batches of data for training, along with some pre-processing classes to encode the categorical data to make it numeric, fill in the missing values, and normalize the values so their ranges will match.</p>
<div class="highlight">
<pre><span></span><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">"salary"</span>

<span class="n">loader</span> <span class="o">=</span> <span class="n">TabularDataLoaders</span><span class="o">.</span><span class="n">from_csv</span><span class="p">(</span>
    <span class="n">DATA_PATH</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">y_names</span><span class="o">=</span><span class="n">TARGET</span><span class="p">,</span>
    <span class="n">cat_names</span> <span class="o">=</span> <span class="n">categorical_columns</span><span class="p">,</span>
    <span class="n">cont_names</span> <span class="o">=</span> <span class="n">numeric_columns</span><span class="p">,</span>
    <span class="n">procs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Categorify</span><span class="p">,</span> <span class="n">FillMissing</span><span class="p">,</span> <span class="n">Normalize</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org5fb9d89">
<h3 id="org5fb9d89">The Learner</h3>
<div class="outline-text-3" id="text-org5fb9d89">
<div class="highlight">
<pre><span></span><span class="n">learner</span> <span class="o">=</span> <span class="n">tabular_learner</span><span class="p">(</span><span class="n">loader</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">accuracy</span><span class="p">)</span>

<span class="k">with</span> <span class="n">learner</span><span class="o">.</span><span class="n">no_bar</span><span class="p">()</span> <span class="k">as</span> <span class="n">nobu</span><span class="p">,</span> <span class="n">TIMER</span> <span class="k">as</span> <span class="n">tim</span><span class="p">:</span>
    <span class="n">learner</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-11-06 17:09:17.344678
[0, 0.37480291724205017, 0.35229262709617615, 0.8412162065505981, '00:02']
[1, 0.3569386303424835, 0.34605613350868225, 0.8421375751495361, '00:02']
Ended: 2022-11-06 17:09:23.994030
Elapsed: 0:00:06.649352
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgc79a015">
<h3 id="orgc79a015">The Learned</h3>
<div class="outline-text-3" id="text-orgc79a015">
<p>Since the last column <code>salary</code> is the target we'll have to drop it before training the model on the data.</p>
<div class="highlight">
<pre><span></span><span class="n">unsalaried</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">"salary"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">test_set</span> <span class="o">=</span> <span class="n">learner</span><span class="o">.</span><span class="n">dls</span><span class="o">.</span><span class="n">test_dl</span><span class="p">(</span><span class="n">unsalaried</span><span class="p">)</span>

<span class="n">row</span><span class="p">,</span> <span class="n">classifications</span><span class="p">,</span> <span class="n">probabilities</span> <span class="o">=</span> <span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org27db1da">
<h2 id="org27db1da">Sources</h2>
<div class="outline-text-2" id="text-org27db1da">
<ul class="org-ul">
<li><a href="https://docs.fast.ai/quick_start.html">FastAI QuickStart</a>: This is where I got the beginnings of the stuff here but it stops before showing you how to use the model you build.</li>
<li><a href="https://docs.fast.ai/tutorial.tabular.html">FastAI Tabular Training page</a>: This is where I got most of this stuffy.</li>
<li><a href="https://stackoverflow.com/a/29442936">StackOverflow</a> answer on how to select pandas columns by data-type.</li>
</ul>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/fastai/index.html" rel="tag">fastai</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../fastai-quickstart/index.html" rel="prev" title="FastAI QuickStart">Previous post</a></li>
<li class="next"><a href="../fastai-lesson-0-is-it-a-bird/index.html" rel="next" title="Raccoon Or Raccoon Dog?">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Scribbles by <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
<div id="license" xmlns:cc="http://creativecommons.org/ns#">This work is licensed under <a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" rel="license noopener noreferrer" style="display:inline-block;" target="_blank">CC BY 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"></a></div>
</footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
