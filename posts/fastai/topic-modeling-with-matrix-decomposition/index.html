<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Topic Modeling using Singular Value Decomposition and Non-Negative Matrix Factorization." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Topic Modeling With Matrix Decomposition | Neurotic Networking</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/topic-modeling-with-matrix-decomposition/" rel="canonical"><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]-->
<link href="../../../apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="../../../favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="../../../favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="../../../site.webmanifest" rel="manifest">
<meta content="Cloistered Monkey" name="author">
<link href="../../link-collection/" rel="prev" title="Link-Collection" type="text/html">
<link href="../hand-rolling-a-countvectorizer/" rel="next" title="Hand-rolling a CountVectorizer" type="text/html">
<meta content="Neurotic Networking" property="og:site_name">
<meta content="Topic Modeling With Matrix Decomposition" property="og:title">
<meta content="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/topic-modeling-with-matrix-decomposition/" property="og:url">
<meta content="Topic Modeling using Singular Value Decomposition and Non-Negative Matrix Factorization." property="og:description">
<meta content="article" property="og:type">
<meta content="2019-12-28T17:11:58-08:00" property="article:published_time">
<meta content="fastai" property="article:tag">
<meta content="matrices" property="article:tag">
<meta content="nlp" property="article:tag">
<meta content="topic modeling" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../../"><span id="blog-title">Neurotic Networking</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../../rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/Neurotic-Networking/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href=".">Topic Modeling With Matrix Decomposition</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2019-12-28T17:11:58-08:00" itemprop="datePublished" title="2019-12-28 17:11">2019-12-28 17:11</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org58197b1">Beginning</a>
<ul>
<li><a href="#orgad30a5f">Related Tutorials</a></li>
<li><a href="#org9c9d70d">Imports</a>
<ul>
<li><a href="#org580477e">Python</a></li>
<li><a href="#org7211ee7">PyPi</a></li>
<li><a href="#orge2188af">Others</a></li>
</ul>
</li>
<li><a href="#orgcb87fbc">Set Up</a>
<ul>
<li><a href="#org9f587d3">The Timer</a></li>
<li><a href="#org9b3f3d2">Plotting</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org6b7737b">Middle</a>
<ul>
<li><a href="#org89161df">The Dataset</a>
<ul>
<li><a href="#org82443a8">Vectorizing</a></li>
</ul>
</li>
<li><a href="#orgf40b31e">Singular Value Decomposition (SVD)</a></li>
<li><a href="#org0e8c55c">Looking At Some Topics</a></li>
<li><a href="#org96a48a0">Non-negative Matrix Factorization (NMF)</a></li>
<li><a href="#org5492c6a">Term-Frequency/Inverse Document Frequency</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org58197b1">
<h2 id="org58197b1">Beginning</h2>
<div class="outline-text-2" id="text-org58197b1">
<p>This is part of a walk-through of the <a href="https://github.com/fastai/course-nlp">fastai Code-First Introduction to NLP</a>. In this post I'll be using <a href="https://www.wikiwand.com/en/Singular_value_decomposition">Singular Value Decomposition (SVD)</a> and <a href="https://www.wikiwand.com/en/Non-negative_matrix_factorization">Non-Negative Matrix Factorization (NMF)</a> to group <a href="https://scikit-learn.org/stable/datasets/index.html#newsgroups-dataset">newsgroup posts</a>. Both of these methods are statistical approaches that use the word-counts within documents to decide how similar they are (while ignoring things like word order).</p>
</div>
<div class="outline-3" id="outline-container-orgad30a5f">
<h3 id="orgad30a5f">Related Tutorials</h3>
<div class="outline-text-3" id="text-orgad30a5f">
<ul class="org-ul">
<li><a href="http://scikit-learn.org/stable/auto_examples/applications/plot_out_of_core_classification.html">Out-Of-Core Text Classification with sklearn</a></li>
<li><a href="https://de.dariah.eu/tatom/index.html)">Text Analysis with Topic Models for the Humanities and Social Sciences</a></li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-org9c9d70d">
<h3 id="org9c9d70d">Imports</h3>
<div class="outline-text-3" id="text-org9c9d70d"></div>
<div class="outline-4" id="outline-container-org580477e">
<h4 id="org580477e">Python</h4>
<div class="outline-text-4" id="text-org580477e">
<div class="highlight">
<pre><span></span>from functools import partial
import random
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org7211ee7">
<h4 id="org7211ee7">PyPi</h4>
<div class="outline-text-4" id="text-org7211ee7">
<div class="highlight">
<pre><span></span>from scipy import linalg
from sklearn import decomposition
from sklearn.datasets import fetch_20newsgroups
from sklearn.feature_extraction.text import CountVectorizer, TfidfVectorizer
import hvplot.pandas
import matplotlib.pyplot as pyplot
import numpy
import pandas
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orge2188af">
<h4 id="orge2188af">Others</h4>
<div class="outline-text-4" id="text-orge2188af">
<div class="highlight">
<pre><span></span>from graeae import EmbedHoloviews, Timer
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgcb87fbc">
<h3 id="orgcb87fbc">Set Up</h3>
<div class="outline-text-3" id="text-orgcb87fbc"></div>
<div class="outline-4" id="outline-container-org9f587d3">
<h4 id="org9f587d3">The Timer</h4>
<div class="outline-text-4" id="text-org9f587d3">
<div class="highlight">
<pre><span></span>TIMER = Timer()
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org9b3f3d2">
<h4 id="org9b3f3d2">Plotting</h4>
<div class="outline-text-4" id="text-org9b3f3d2">
<div class="highlight">
<pre><span></span>Embed = partial(
    EmbedHoloviews,
    folder_path="../../files/posts/fastai/topic-modeling-with-matrix-decomposition")
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org6b7737b">
<h2 id="org6b7737b">Middle</h2>
<div class="outline-text-2" id="text-org6b7737b"></div>
<div class="outline-3" id="outline-container-org89161df">
<h3 id="org89161df">The Dataset</h3>
<div class="outline-text-3" id="text-org89161df">
<p>The dataset consists of ~18,000 newsgroup posts with 20 topics. To keep the computation down I'll only use a subset of the categories. I'm also going to only use the body of the posts.</p>
<div class="highlight">
<pre><span></span>keep = ("alt.atheism", "comp.graphics", "misc.forsale", "sci.crypt", "talk.politics.guns")
remove = ("headers", "footers", "quotes")
training = fetch_20newsgroups(subset="train", categories=keep, remove=remove)
testing = fetch_20newsgroups(subset="test", categories=keep, remove=remove)
</pre></div>
<p>I've run this more than once so there's no output, but the first time you run the <code>fetch_20newsgroups</code> function it downloads the dataset and you'll see some output mentioning this fact.</p>
<div class="highlight">
<pre><span></span>print(f"{training.filenames.shape[0]:,}")
print(f"{training.target.shape[0]:,}")
</pre></div>
<pre class="example">
2,790
2,790
</pre>
<p>So, although the entire dataset has over 18,000 entries, our sub-set has fewer than 3,000.</p>
<div class="highlight">
<pre><span></span>print(numpy.unique(training.target))
</pre></div>
<pre class="example">
[0 1 2 3 4]
</pre>
<p>So the categories don't seem to be preserved (I'm assuming that the five I kept weren't the first five in the original set) so you have to check anytime you pull a subset out of the data.</p>
<p>Lets see what one of the posts looks like.</p>
<div class="highlight">
<pre><span></span>print(random.choice(training.data))
</pre></div>
<pre class="example" id="org228ad88">
      Just a question. 
      As a provider of a public BBS service - aren't you bound by law to gurantee
      intelligble access to the data of the users on the BBS, if police comes
      with sufficent authorisation ? I guessed this would be  a basic condition
      for such systems. (I did run a bbs some time ago, but that was in Switzerland)

The US doesn't yet have many laws covering BBSs - they're not common carriers,
they're not phone companies, they're just private machines or services
operated by businesses.  There's no obligation to keep records.
As Perry Metzger points out, if the police come with a search warrant,
you have to let them see what the warrant demands, if it exists,
and they generally can confiscate the equipment as "evidence"
(which is not Constitutionally valid, but we're only beginning to
develop court cases supporting us).  A court MAY be able to compel
you to tell them information you know, such as the encryption password
for the disk - there aren't any definitive cases yet, since it's a new
situation, and there probably aren't laws specifically covering it.
But the court can't force you to *know* the keys, and there are no
laws preventing you from allowing your users to have their own keys
for their own files without giving them to you.

Even in areas that do have established law, there is uncertainty.
There was a guy in Idaho a few years ago who had his business records
subpoenaed as evidence for taxes or some other business-restriction law,
so he gave the court the records.  Which were in Hebrew.
The US doesn't have laws forcing you to keep your records in English,
and these were the originals of the records.  HE didn't speak Hebrew,
and neither did anybody in the court organization.  Don't think they
were able to do much about it.

It might be illegal for your BBS to deny access to potential customers
based on race, religion, national origin, gender, or sexual preference;
it probably hasn't been tested in court, but it seems like a plausible
extension of anti-discrimination laws affecting other businesses.
</pre></div>
<div class="outline-4" id="outline-container-org82443a8">
<h4 id="org82443a8">Vectorizing</h4>
<div class="outline-text-4" id="text-org82443a8">
<p>Here we'll convert the text to a matrix using <a href="https://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html">sklearn's CountVectorizer</a>. Interestingly, the <a href="https://nlp.stanford.edu/IR-book/html/htmledition/dropping-common-terms-stop-words-1.html">Introduction to Information Retrieval</a> book says the the trend has been towards not removing the most common words (<i>stop word</i>) but we'll be dropping them. There's a paper called <a href="https://www.aclweb.org/anthology/W18-2502/">Stop Word Lists in Free Open-source Software Packages</a> which points out some problems with stop-word lists in general, but sklearn's list in particular. I don't know if sklearn has done anything to address their concerns since the paper came out, but the sklearn documentation includes a link to the paper so I would assume the problems are still there. Nonetheless, the fastai examples uses them so I will too.</p>
<div class="highlight">
<pre><span></span>vectorizer = CountVectorizer(stop_words="english")
</pre></div>
<p>The function we'le going to use doesn't accept the sparse matrices that are output by default so we'll make it a dense matrix after it's fit.</p>
<div class="highlight">
<pre><span></span>with TIMER:
    vectors = vectorizer.fit_transform(training.data).todense()
</pre></div>
<pre class="example">
2020-01-01 16:26:48,048 graeae.timers.timer start: Started: 2020-01-01 16:26:48.047927
2020-01-01 16:26:48,466 graeae.timers.timer end: Ended: 2020-01-01 16:26:48.466285
2020-01-01 16:26:48,466 graeae.timers.timer end: Elapsed: 0:00:00.418358
</pre>
<p>That was much quicker than I thought it would be, probably because our dataset is so small.</p>
<div class="highlight">
<pre><span></span>vocabulary = vectorizer.get_feature_names()
print(f"{len(vocabulary):,}")
</pre></div>
<pre class="example">
34,632
</pre>
<p>So our "vocabulary" is around 35,000 tokens.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgf40b31e">
<h3 id="orgf40b31e">Singular Value Decomposition (SVD)</h3>
<div class="outline-text-3" id="text-orgf40b31e">
<p>Singular Value Decomposition is a linear algebra method to factor a matrix. The math is beyond me at this point, so I'll just try using it as a black box.</p>
<div class="highlight">
<pre><span></span>with TIMER:
    U, s, V = linalg.svd(vectors, full_matrices=False)
</pre></div>
<pre class="example">
2020-01-01 16:26:50,508 graeae.timers.timer start: Started: 2020-01-01 16:26:50.508003
2020-01-01 16:27:23,979 graeae.timers.timer end: Ended: 2020-01-01 16:27:23.978988
2020-01-01 16:27:23,980 graeae.timers.timer end: Elapsed: 0:00:33.470985
</pre>
<div class="highlight">
<pre><span></span>s_frame = pandas.Series(s)
plot = s_frame.hvplot().opts(title="Diagonal Matrix S", width=1000, height=800)
Embed(plot=plot, file_name="s_values")()
</pre></div>
<object data="s_values.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-3" id="outline-container-org0e8c55c">
<h3 id="org0e8c55c">Looking At Some Topics</h3>
<div class="outline-text-3" id="text-org0e8c55c">
<div class="highlight">
<pre><span></span>top_words_count = 8

def top_words(token):
    return [vocabulary[index] for index in numpy.argsort(token)[: -top_words_count - 1: -1]]

def show_topics(array):
    topic_words = ([top_words(topic) for topic in array])
    return [' '.join(topic) for topic in topic_words]
</pre></div>
<div class="highlight">
<pre><span></span>topics = show_topics(V[:10])
for index, topic in enumerate(topics):
    print(f"{index}: {topic}")
</pre></div>
<pre class="example" id="org2439b79">
0: propagandist heliocentric galacticentric surname sandvik 400included wovy imaginative
1: file jpeg image edu pub ftp use graphics
2: file gun congress firearms control mr states rkba
3: privacy internet anonymous pub email information eff mail
4: graphics edu 128 3d ray pub data ftp
5: 00 50 40 appears dos 10 art 25
6: privacy internet 00 jpeg eff pub email electronic
7: key data image encryption des chip available law
8: pub key jesus jpeg eff graphics encryption ripem
9: key encryption edu des anonymous posting chip graphics
</pre>
<p>So what we're showing is the most significant words for the top-ten most strongly grouped "topics". It takes a little bit of interpretation to figure out how to map them to the newsgroups we used, and there probably could have been some clean-up of the texts (entry 5 looks suspect) but it's interesting that this linear algebra decomposition method could find these similar groups without any kind of prompting as to what groups might even exist in the first place (this is an unsupervised method, not a supervised method).</p>
</div>
</div>
<div class="outline-3" id="outline-container-org96a48a0">
<h3 id="org96a48a0">Non-negative Matrix Factorization (NMF)</h3>
<div class="outline-text-3" id="text-org96a48a0">
<div class="highlight">
<pre><span></span>number_of_topics = 5
classifier = decomposition.NMF(n_components=number_of_topics, random_state=1)
weights = classifier.fit_transform(vectors)
classified = classifier.components_
for index, topic in enumerate(show_topics(classified)):
    print(f"{index}: {topic}")
</pre></div>
<pre class="example">
0: db mov bh si cs byte al bl
1: privacy internet anonymous information email eff use pub
2: file gun congress control firearms states mr united
3: jpeg image gif file color images format quality
4: edu graphics pub image data ftp mail available
</pre></div>
</div>
<div class="outline-3" id="outline-container-org5492c6a">
<h3 id="org5492c6a">Term-Frequency/Inverse Document Frequency</h3>
<div class="outline-text-3" id="text-org5492c6a">
<div class="highlight">
<pre><span></span>tfidf_vectorizer = TfidfVectorizer(stop_words="english")
tfidf_vectors = tfidf_vectorizer.fit_transform(training.data)
weights = classifier.fit_transform(tfidf_vectors)
classified = classifier.components_

for index, topic in enumerate(show_topics(classified)):
    print(f"{index}: {topic}")
</pre></div>
<pre class="example">
0: people gun don think just guns right government
1: 00 sale offer shipping new drive price condition
2: key chip encryption clipper keys escrow government algorithm
3: graphics thanks file files image program know windows
4: god atheism believe does atheists belief said exist
</pre></div>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../../categories/fastai/" rel="tag">fastai</a></li>
<li><a class="tag p-category" href="../../../categories/matrices/" rel="tag">matrices</a></li>
<li><a class="tag p-category" href="../../../categories/nlp/" rel="tag">nlp</a></li>
<li><a class="tag p-category" href="../../../categories/topic-modeling/" rel="tag">topic modeling</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../../link-collection/" rel="prev" title="Link-Collection">Previous post</a></li>
<li class="next"><a href="../hand-rolling-a-countvectorizer/" rel="next" title="Hand-rolling a CountVectorizer">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer"><a href="https://creativecommons.org/licenses/by/4.0/" rel="license"><img alt="Creative Commons License" id="license-image" src="https://licensebuttons.net/l/by/4.0/80x15.png" style="border-width:0"></a>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>. <a href="mailto:cloisteredmonkey.jmark@slmail.me">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="../../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script>
</body>
</html>
