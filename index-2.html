<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Studies in Deep Learning." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>In Too Deep (old posts, page 2) | In Too Deep</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="rss.xml" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/In-Too-Deep/index-2.html" rel="canonical">
<link href="index-3.html" rel="prev" type="text/html">
<link href="index-1.html" rel="next" type="text/html"><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
<link href="apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="site.webmanifest" rel="manifest">
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
<script async src="javascript/bokeh-1.3.4.min.js" type="text/javascript"></script>
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="https://necromuralist.github.io/In-Too-Deep/"><span id="blog-title">In Too Deep</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="/archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="/categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="/rss.xml">RSS feed</a></li>
<li class="nav-item"><a class="nav-link" href="https://necromuralist.github.io/">Cloistered Monkey</a></li>
</ul>
<!-- Google custom search -->
<form action="https://www.google.com/search" class="navbar-form navbar-right" method="get" role="search">
<div class="form-group"><input class="form-control" name="q" placeholder="Search" type="text"></div>
<!-- 
<button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span>
</button>
-->
<input name="sitesearch" type="hidden" value="https://necromuralist.github.io/In-Too-Deep/"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<div class="postindex">
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/nano/introduction-to-neural-networks/student-admissions/">Student Admissions</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/nano/introduction-to-neural-networks/student-admissions/" rel="bookmark"><time class="published dt-published" datetime="2018-10-29T12:21:25-07:00" itemprop="datePublished" title="2018-10-29 12:21">2018-10-29 12:21</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/nano/introduction-to-neural-networks/student-admissions/#orgf850250">Introduction</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/student-admissions/#orgb855192">Imports</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/student-admissions/#orgb5a5f2a">Some Set Up</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/student-admissions/#org4acef83">Loading the data</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/student-admissions/#org13bb735">Plotting the data</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/student-admissions/#org3ba2c60">One-Hot Encoding the Rank</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/student-admissions/#orgedf0ecb">Scaling the data</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/student-admissions/#orgd58be1a">Splitting the data into Training and Testing</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/student-admissions/#org31f2df7">Splitting the data into features and targets (labels)</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/student-admissions/#org2f022ee">Training the 2-layer Neural Network</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/student-admissions/#org4b161cb">Backpropagate the error</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/student-admissions/#orgf568993">Calculating the Accuracy on the Test Data</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgf850250">
<h2 id="orgf850250">Introduction</h2>
<div class="outline-text-2" id="text-orgf850250">
<p>In this notebook, I'll student admissions to graduate school at UCLA based on three pieces of data:</p>
<ul class="org-ul">
<li>GRE Scores (Test)</li>
<li>GPA Scores (Grades)</li>
<li>Class rank (1-4)</li>
</ul>
<p>The dataset originally came from here: <a href="http://www.ats.ucla.edu/">http://www.ats.ucla.edu/</a> (although I couldn't find it).</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgb855192">
<h2 id="orgb855192">Imports</h2>
<div class="outline-text-2" id="text-orgb855192"></div>
<div class="outline-3" id="outline-container-orgab56897">
<h3 id="orgab56897">From python</h3>
<div class="outline-text-3" id="text-orgab56897">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org3c2252c">
<h3 id="org3c2252c">From PyPi</h3>
<div class="outline-text-3" id="text-org3c2252c">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org56c6d36">
<h3 id="org56c6d36">This Project</h3>
<div class="outline-text-3" id="text-org56c6d36">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.tangles.data_paths</span> <span class="kn">import</span> <span class="n">DataPath</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgb5a5f2a">
<h2 id="orgb5a5f2a">Some Set Up</h2>
<div class="outline-text-2" id="text-orgb5a5f2a"></div>
<div class="outline-3" id="outline-container-org1744202">
<h3 id="org1744202">Tables</h3>
<div class="outline-text-3" id="text-org1744202">
<div class="highlight">
<pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">'orgtbl'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgb3f24da">
<h3 id="orgb3f24da">Plotting</h3>
<div class="outline-text-3" id="text-orgb3f24da">
<div class="highlight">
<pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">"whitegrid"</span><span class="p">)</span>
<span class="n">FIGURE_SIZE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org4acef83">
<h2 id="org4acef83">Loading the data</h2>
<div class="outline-text-2" id="text-org4acef83">
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">DataPath</span><span class="p">(</span><span class="s2">"student_data.csv"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">from_folder</span><span class="p">)</span>
</pre></div>
<pre class="example">
../../../data/introduction-to-neural-networks/student_data.csv

</pre>
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">from_folder</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">admit</th>
<th class="org-right" scope="col">gre</th>
<th class="org-right" scope="col">gpa</th>
<th class="org-right" scope="col">rank</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">380</td>
<td class="org-right">3.61</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">660</td>
<td class="org-right">3.67</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">800</td>
<td class="org-right">4</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">640</td>
<td class="org-right">3.19</td>
<td class="org-right">4</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">520</td>
<td class="org-right">2.93</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span> <span class="n">showindex</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">admit</th>
<th class="org-right" scope="col">gre</th>
<th class="org-right" scope="col">gpa</th>
<th class="org-right" scope="col">rank</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">count</td>
<td class="org-right">400</td>
<td class="org-right">400</td>
<td class="org-right">400</td>
<td class="org-right">400</td>
</tr>
<tr>
<td class="org-left">mean</td>
<td class="org-right">0.3175</td>
<td class="org-right">587.7</td>
<td class="org-right">3.3899</td>
<td class="org-right">2.485</td>
</tr>
<tr>
<td class="org-left">std</td>
<td class="org-right">0.466087</td>
<td class="org-right">115.517</td>
<td class="org-right">0.380567</td>
<td class="org-right">0.94446</td>
</tr>
<tr>
<td class="org-left">min</td>
<td class="org-right">0</td>
<td class="org-right">220</td>
<td class="org-right">2.26</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">25%</td>
<td class="org-right">0</td>
<td class="org-right">520</td>
<td class="org-right">3.13</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">50%</td>
<td class="org-right">0</td>
<td class="org-right">580</td>
<td class="org-right">3.395</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">75%</td>
<td class="org-right">1</td>
<td class="org-right">660</td>
<td class="org-right">3.67</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">max</td>
<td class="org-right">1</td>
<td class="org-right">800</td>
<td class="org-right">4</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
<p>So we have 400 applicants with about 32% of them being admitted. I don't know how to interpret the rank, maybe that's the quarter the student was in.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org13bb735">
<h2 id="org13bb735">Plotting the data</h2>
<div class="outline-text-2" id="text-org13bb735">
<p>First let's make a plot of our data to see how it looks. In order to have a 2D plot, let's ingore the rank.</p>
</div>
<div class="outline-3" id="outline-container-org87c6693">
<h3 id="org87c6693">Plot Points</h3>
<div class="outline-text-3" id="text-org87c6693">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">plot_points</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">"All"</span><span class="p">):</span>
    <span class="sd">"""Plots the GRE vs GPA</span>

<span class="sd">    Args:</span>
<span class="sd">     data: frame with the admission, GRE, and GPA data</span>
<span class="sd">     identifier: something to identify the data set</span>
<span class="sd">    """</span>
    <span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
    <span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"GRE vs GPA and Admissions to UCLA Graduate School ({})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">identifier</span><span class="p">))</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s2">"gre"</span><span class="p">,</span><span class="s2">"gpa"</span><span class="p">]])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"admit"</span><span class="p">])</span>
    <span class="n">admitted</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">rejected</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">)]</span>
    <span class="n">axe</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">rejected</span><span class="p">],</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">rejected</span><span class="p">],</span>
                <span class="n">s</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">'red'</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'k'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Rejected"</span><span class="p">)</span>
    <span class="n">axe</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">admitted</span><span class="p">],</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">admitted</span><span class="p">],</span>
                <span class="n">s</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">'cyan'</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'k'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Admitted"</span><span class="p">)</span>
    <span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Test (GRE)'</span><span class="p">)</span>
    <span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Grades (GPA)'</span><span class="p">)</span>
    <span class="n">axe</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgd016a88">
<h3 id="orgd016a88">GRE Vs GPA</h3>
<div class="outline-text-3" id="text-orgd016a88">
<div class="highlight">
<pre><span></span><span class="n">plot_points</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="gre_vs_gpa.png" src="/posts/nano/introduction-to-neural-networks/student-admissions/gre_vs_gpa.png"></p>
</div>
<p>Roughly, it looks like the students with high scores in the grades and test passed, while the ones with low scores didn't, but the data is not as nicely separable as we hoped it would be (to say the least). Maybe it would help to take the rank into account? Let's make 4 plots, each one for each rank.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orged05e16">
<h3 id="orged05e16">By Rank</h3>
<div class="outline-text-3" id="text-orged05e16"></div>
<div class="outline-4" id="outline-container-orgc8451cc">
<h4 id="orgc8451cc">Separating the ranks</h4>
<div class="outline-text-4" id="text-orgc8451cc">
<div class="highlight">
<pre><span></span><span class="n">data_rank_1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">"rank"</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
<span class="n">data_rank_2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">"rank"</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">]</span>
<span class="n">data_rank_3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">"rank"</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">]</span>
<span class="n">data_rank_4</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">"rank"</span><span class="p">]</span><span class="o">==</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">plot_points</span><span class="p">(</span><span class="n">data_rank_1</span><span class="p">,</span> <span class="s2">"Rank 1"</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="rank_1.png" src="/posts/nano/introduction-to-neural-networks/student-admissions/rank_1.png"></p>
</div>
<div class="highlight">
<pre><span></span><span class="n">plot_points</span><span class="p">(</span><span class="n">data_rank_2</span><span class="p">,</span> <span class="s2">"Rank 2"</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="rank_2.png" src="/posts/nano/introduction-to-neural-networks/student-admissions/rank_2.png"></p>
</div>
<div class="highlight">
<pre><span></span><span class="n">plot_points</span><span class="p">(</span><span class="n">data_rank_3</span><span class="p">,</span> <span class="s2">"Rank 3"</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="rank_3.png" src="/posts/nano/introduction-to-neural-networks/student-admissions/rank_3.png"></p>
</div>
<div class="highlight">
<pre><span></span><span class="n">plot_points</span><span class="p">(</span><span class="n">data_rank_4</span><span class="p">,</span> <span class="s2">"Rank 4"</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="rank_4.png" src="/posts/nano/introduction-to-neural-networks/student-admissions/rank_4.png"></p>
</div>
<div class="highlight">
<pre><span></span><span class="n">ranked</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">"rank"</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">fraction</span> <span class="o">=</span> <span class="p">(</span><span class="n">ranked</span><span class="o">/</span><span class="n">data</span><span class="o">.</span><span class="n">admit</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">fraction</span><span class="p">[[</span><span class="s2">"rank"</span><span class="p">,</span> <span class="s2">"admit"</span><span class="p">]]))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">rank</th>
<th class="org-right" scope="col">admit</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.259843</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">0.425197</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">0.220472</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">0.0944882</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Fraction Admitted By Rank"</span><span class="p">)</span>
<span class="n">axe</span> <span class="o">=</span> <span class="n">fraction</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"rank"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"admit"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axe</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="rank_bar.png" src="/posts/nano/introduction-to-neural-networks/student-admissions/rank_bar.png"></p>
</div>
<p>This looks more promising, as it seems that the lower the rank, the higher the acceptance rate (with rank 2 being the dominant rank among the admitted). Let's use the rank as one of our inputs. In order to do this, we should one-hot encode it.</p>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org3ba2c60">
<h2 id="org3ba2c60">One-Hot Encoding the Rank</h2>
<div class="outline-text-2" id="text-org3ba2c60">
<p>We'll do the one-hot-encoding using pandas' <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.get_dummies.html">get_dummies</a> function.</p>
<div class="highlight">
<pre><span></span><span class="n">one_hot_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"rank"</span><span class="p">])</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">one_hot_data</span><span class="o">.</span><span class="n">head</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">admit</th>
<th class="org-right" scope="col">gre</th>
<th class="org-right" scope="col">gpa</th>
<th class="org-right" scope="col">rank_1</th>
<th class="org-right" scope="col">rank_2</th>
<th class="org-right" scope="col">rank_3</th>
<th class="org-right" scope="col">rank_4</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">380</td>
<td class="org-right">3.61</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">660</td>
<td class="org-right">3.67</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">800</td>
<td class="org-right">4</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">640</td>
<td class="org-right">3.19</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">520</td>
<td class="org-right">2.93</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-2" id="outline-container-orgedf0ecb">
<h2 id="orgedf0ecb">Scaling the data</h2>
<div class="outline-text-2" id="text-orgedf0ecb">
<p>The next step is to scale the data. We notice that the range for grades is 1.0-4.0, whereas the range for test scores is roughly 200-800, which is much larger. This means our data is skewed, and that makes it hard for a neural network to handle. Let's fit our two features into a range of 0-1, by dividing the grades by 4.0, and the test score by 800.</p>
</div>
<div class="outline-3" id="outline-container-orge5e5091">
<h3 id="orge5e5091">Making a copy of our data</h3>
<div class="outline-text-3" id="text-orge5e5091">
<div class="highlight">
<pre><span></span><span class="n">processed_data</span> <span class="o">=</span> <span class="n">one_hot_data</span><span class="p">[:]</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgaca1bb5">
<h3 id="orgaca1bb5">Scale the columns</h3>
<div class="outline-text-3" id="text-orgaca1bb5">
<div class="highlight">
<pre><span></span><span class="n">processed_data</span><span class="p">[</span><span class="s2">"gpa"</span><span class="p">]</span> <span class="o">=</span> <span class="n">one_hot_data</span><span class="p">[</span><span class="s2">"gpa"</span><span class="p">]</span><span class="o">/</span><span class="mi">4</span>
<span class="n">processed_data</span><span class="p">[</span><span class="s2">"gre"</span><span class="p">]</span> <span class="o">=</span> <span class="n">one_hot_data</span><span class="p">[</span><span class="s2">"gre"</span><span class="p">]</span><span class="o">/</span><span class="mi">800</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">processed_data</span><span class="o">.</span><span class="n">head</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">admit</th>
<th class="org-right" scope="col">gre</th>
<th class="org-right" scope="col">gpa</th>
<th class="org-right" scope="col">rank_1</th>
<th class="org-right" scope="col">rank_2</th>
<th class="org-right" scope="col">rank_3</th>
<th class="org-right" scope="col">rank_4</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.475</td>
<td class="org-right">0.9025</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.825</td>
<td class="org-right">0.9175</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.8</td>
<td class="org-right">0.7975</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.65</td>
<td class="org-right">0.7325</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgd58be1a">
<h2 id="orgd58be1a">Splitting the data into Training and Testing</h2>
<div class="outline-text-2" id="text-orgd58be1a">
<p>In order to test our algorithm, we'll split the data into a Training and a Testing set by sampling the data's index (using <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.random.choice.html">numpy.random.choice</a>) to find the training set and dropping the sample (<a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.drop.html">pandas.DataFrame.drop</a>) from the data to create the test set. The size of the testing set will be 10% of the total data.</p>
<div class="highlight">
<pre><span></span><span class="n">training_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_data</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">)</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">processed_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                             <span class="n">size</span><span class="o">=</span><span class="n">training_size</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span> <span class="o">=</span> <span class="n">processed_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sample</span><span class="p">],</span> <span class="n">processed_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"Number of training samples is"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_data</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Number of testing samples is"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_data</span><span class="p">))</span>
</pre></div>
<pre class="example">
Number of training samples is 360
Number of testing samples is 40

</pre>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">train_data</span><span class="p">[:</span><span class="mi">10</span><span class="p">]))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">admit</th>
<th class="org-right" scope="col">gre</th>
<th class="org-right" scope="col">gpa</th>
<th class="org-right" scope="col">rank_1</th>
<th class="org-right" scope="col">rank_2</th>
<th class="org-right" scope="col">rank_3</th>
<th class="org-right" scope="col">rank_4</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.85</td>
<td class="org-right">0.77</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.7</td>
<td class="org-right">0.745</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.775</td>
<td class="org-right">0.7625</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.825</td>
<td class="org-right">0.8975</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.75</td>
<td class="org-right">0.85</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.65</td>
<td class="org-right">0.975</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.775</td>
<td class="org-right">0.8325</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.875</td>
<td class="org-right">0.8175</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.475</td>
<td class="org-right">0.835</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.725</td>
<td class="org-right">0.84</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">test_data</span><span class="p">[:</span><span class="mi">10</span><span class="p">]))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">admit</th>
<th class="org-right" scope="col">gre</th>
<th class="org-right" scope="col">gpa</th>
<th class="org-right" scope="col">rank_1</th>
<th class="org-right" scope="col">rank_2</th>
<th class="org-right" scope="col">rank_3</th>
<th class="org-right" scope="col">rank_4</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.5</td>
<td class="org-right">0.77</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.875</td>
<td class="org-right">0.77</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.875</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.65</td>
<td class="org-right">0.8225</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.45</td>
<td class="org-right">0.785</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.75</td>
<td class="org-right">0.7875</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.725</td>
<td class="org-right">0.865</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.775</td>
<td class="org-right">0.795</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
<td class="org-right">0.725</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0.55</td>
<td class="org-right">0.8625</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-2" id="outline-container-org31f2df7">
<h2 id="org31f2df7">Splitting the data into features and targets (labels)</h2>
<div class="outline-text-2" id="text-org31f2df7">
<p>Now, as a final step before the training, we'll split the data into features (X) and targets (y).</p>
<div class="highlight">
<pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'admit'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">'admit'</span><span class="p">]</span>
<span class="n">features_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'admit'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
<span class="n">targets_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">'admit'</span><span class="p">]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">features</span><span class="p">[:</span><span class="mi">10</span><span class="p">]))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">gre</th>
<th class="org-right" scope="col">gpa</th>
<th class="org-right" scope="col">rank_1</th>
<th class="org-right" scope="col">rank_2</th>
<th class="org-right" scope="col">rank_3</th>
<th class="org-right" scope="col">rank_4</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0.85</td>
<td class="org-right">0.77</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">0.7</td>
<td class="org-right">0.745</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0.775</td>
<td class="org-right">0.7625</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0.825</td>
<td class="org-right">0.8975</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0.75</td>
<td class="org-right">0.85</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0.65</td>
<td class="org-right">0.975</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0.775</td>
<td class="org-right">0.8325</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0.875</td>
<td class="org-right">0.8175</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0.475</td>
<td class="org-right">0.835</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0.725</td>
<td class="org-right">0.84</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">admit</span><span class="o">=</span><span class="n">targets</span><span class="p">[:</span><span class="mi">10</span><span class="p">])))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">admit</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-2" id="outline-container-org2f022ee">
<h2 id="org2f022ee">Training the 2-layer Neural Network</h2>
<div class="outline-text-2" id="text-org2f022ee">
<p>The following function trains the 2-layer neural network. First, we'll write some helper functions.</p>
</div>
<div class="outline-3" id="outline-container-orgcc29004">
<h3 id="orgcc29004">Helper Functions</h3>
<div class="outline-text-3" id="text-orgcc29004">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>
</pre></div>
<p>and the derivative of the <code>sigmoid</code>.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">sigmoid_prime</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">error_formula</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span> <span class="n">y</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org4b161cb">
<h2 id="org4b161cb">Backpropagate the error</h2>
<div class="outline-text-2" id="text-org4b161cb">
<p>Now it's your turn to shine. Write the error term. Remember that this is given by the equation \[ -(y-\hat{y}) \sigma'(x) \]</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">error_term_formula</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">output</span><span class="p">)</span> <span class="o">*</span> <span class="n">output</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-org8b30d07">
<h3 id="org8b30d07">Training</h3>
<div class="outline-text-3" id="text-org8b30d07">
<div class="highlight">
<pre><span></span><span class="n">epochs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">learn_rate</span> <span class="o">=</span> <span class="mf">0.5</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org500285e">
<h4 id="org500285e">Training function</h4>
<div class="outline-text-4" id="text-org500285e">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">train_nn</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">learnrate</span><span class="p">):</span>

    <span class="c1"># Use to same seed to make debugging easier</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

    <span class="n">n_records</span><span class="p">,</span> <span class="n">n_features</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">last_loss</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># Initialize weights</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n_features</span><span class="o">**.</span><span class="mi">5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_features</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
        <span class="n">del_w</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">weights</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
            <span class="c1"># Loop through all records, x is the input, y is the target</span>

            <span class="c1"># Activation of the output unit</span>
            <span class="c1">#   Notice we multiply the inputs and the weights here </span>
            <span class="c1">#   rather than storing h as a separate variable </span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">weights</span><span class="p">))</span>

            <span class="c1"># The error, the target minus the network output</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">error_formula</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

            <span class="c1"># The error term</span>
            <span class="c1">#   Notice we calulate f'(h) here instead of defining a separate</span>
            <span class="c1">#   sigmoid_prime function. This just makes it faster because we</span>
            <span class="c1">#   can re-use the result of the sigmoid function stored in</span>
            <span class="c1">#   the output variable</span>
            <span class="n">error_term</span> <span class="o">=</span> <span class="n">error_term_formula</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

            <span class="c1"># The gradient descent step, the error times the gradient times the inputs</span>
            <span class="n">del_w</span> <span class="o">+=</span> <span class="n">error_term</span> <span class="o">*</span> <span class="n">x</span>

        <span class="c1"># Update the weights here. The learning rate times the </span>
        <span class="c1"># change in weights, divided by the number of records to average</span>
        <span class="n">weights</span> <span class="o">+=</span> <span class="n">learnrate</span> <span class="o">*</span> <span class="n">del_w</span> <span class="o">/</span> <span class="n">n_records</span>

        <span class="c1"># Printing out the mean square error on the training set</span>
        <span class="k">if</span> <span class="n">e</span> <span class="o">%</span> <span class="p">(</span><span class="n">epochs</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">weights</span><span class="p">))</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">out</span> <span class="o">-</span> <span class="n">targets</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"Epoch:"</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">last_loss</span> <span class="ow">and</span> <span class="n">last_loss</span> <span class="o">&lt;</span> <span class="n">loss</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">"Train loss: "</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="s2">"  WARNING - Loss Increasing"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">"Train loss: "</span><span class="p">,</span> <span class="n">loss</span><span class="p">)</span>
            <span class="n">last_loss</span> <span class="o">=</span> <span class="n">loss</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"========="</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"Finished training!"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">weights</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="n">train_nn</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">learn_rate</span><span class="p">)</span>
</pre></div>
<pre class="example">
Epoch: 0
Train loss:  0.27247853979302755
=========
Epoch: 100
Train loss:  0.20397593223991445
=========
Epoch: 200
Train loss:  0.2014297690420066
=========
Epoch: 300
Train loss:  0.2003513187214578
=========
Epoch: 400
Train loss:  0.19984320017443669
=========
Epoch: 500
Train loss:  0.19956325048732546
=========
Epoch: 600
Train loss:  0.19938027609704898
=========
Epoch: 700
Train loss:  0.1992416788675009
=========
Epoch: 800
Train loss:  0.19912513146497982
=========
Epoch: 900
Train loss:  0.19902058341953008
=========
Finished training!
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgf568993">
<h2 id="orgf568993">Calculating the Accuracy on the Test Data</h2>
<div class="outline-text-2" id="text-orgf568993">
<div class="highlight">
<pre><span></span><span class="n">test_out</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">features_test</span><span class="p">,</span> <span class="n">weights</span><span class="p">))</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">test_out</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predictions</span> <span class="o">==</span> <span class="n">targets_test</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">"Prediction accuracy: {:.3f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">accuracy</span><span class="p">))</span>
</pre></div>
<pre class="example">
Prediction accuracy: 0.575

</pre>
<p>Not horrible, considering the test-set, but not great either.</p>
</div>
<div class="outline-3" id="outline-container-org137c8b5">
<h3 id="org137c8b5">Try More Epochs</h3>
<div class="outline-text-3" id="text-org137c8b5">
<div class="highlight">
<pre><span></span><span class="n">weights_2</span> <span class="o">=</span> <span class="n">train_nn</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">epochs</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">learn_rate</span><span class="p">)</span>
</pre></div>
<pre class="example">
Epoch: 0
Train loss:  0.27247853979302755
=========
Epoch: 200
Train loss:  0.2014297690420066
=========
Epoch: 400
Train loss:  0.19984320017443669
=========
Epoch: 600
Train loss:  0.19938027609704898
=========
Epoch: 800
Train loss:  0.19912513146497982
=========
Epoch: 1000
Train loss:  0.19892324129363695
=========
Epoch: 1200
Train loss:  0.19874162735565162
=========
Epoch: 1400
Train loss:  0.19857138905455757
=========
Epoch: 1600
Train loss:  0.1984095079666442
=========
Epoch: 1800
Train loss:  0.1982546851201456
=========
Finished training!
</pre>
<div class="highlight">
<pre><span></span><span class="n">test_out</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">features_test</span><span class="p">,</span> <span class="n">weights_2</span><span class="p">))</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">test_out</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predictions</span> <span class="o">==</span> <span class="n">targets_test</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">"Prediction accuracy: {:.3f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">accuracy</span><span class="p">))</span>
</pre></div>
<pre class="example">
Prediction accuracy: 0.575

</pre>
<p>It doesn't make a noticeable difference. Maybe this is the best it can do with only these features.</p>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/nano/introduction-to-neural-networks/gradient-descent-practice/">Gradient Descent Practice</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/nano/introduction-to-neural-networks/gradient-descent-practice/" rel="bookmark"><time class="published dt-published" datetime="2018-10-26T19:32:58-07:00" itemprop="datePublished" title="2018-10-26 19:32">2018-10-26 19:32</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/nano/introduction-to-neural-networks/gradient-descent-practice/#org3437c9d">Imports</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/gradient-descent-practice/#org27c85df">Helpers</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/gradient-descent-practice/#org21e91e4">The Data</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/gradient-descent-practice/#org89c51a6">The Basic Functions</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/gradient-descent-practice/#orgb8ed0bc">Training function</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/gradient-descent-practice/#orgcf12e66">Simpler Training</a></li>
</ul>
</div>
</div>
<p>This will implement the basic functions of the Gradient Descent algorithm to find the boundary in a small dataset.</p>
<div class="outline-2" id="outline-container-org3437c9d">
<h2 id="org3437c9d">Imports</h2>
<div class="outline-text-2" id="text-org3437c9d"></div>
<div class="outline-3" id="outline-container-org710d55c">
<h3 id="org710d55c">From Pypi</h3>
<div class="outline-text-3" id="text-org710d55c">
<div class="highlight">
<pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgf77c31d">
<h3 id="orgf77c31d">This Project</h3>
<div class="outline-text-3" id="text-orgf77c31d">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">neurotic.tangles.data_paths</span> <span class="kn">import</span> <span class="n">DataPath</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org27c85df">
<h2 id="org27c85df">Helpers</h2>
<div class="outline-text-2" id="text-org27c85df"></div>
<div class="outline-3" id="outline-container-org705730b">
<h3 id="org705730b">For Plotting</h3>
<div class="outline-text-3" id="text-org705730b"></div>
<div class="outline-4" id="outline-container-orgad5b054">
<h4 id="orgad5b054">Plot Points</h4>
<div class="outline-text-4" id="text-orgad5b054">
<p>This first function is used to plot the data points as a scatter plot.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">plot_points</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">"""Makes a scatter plot</span>

<span class="sd">    Args:</span>
<span class="sd">     X: array of inputs</span>
<span class="sd">     y: array of labels (1's and 0's)</span>
<span class="sd">     axe: matplotlib axis object</span>

<span class="sd">    Return:</span>
<span class="sd">     axe: matplotlib axis</span>
<span class="sd">    """</span>
    <span class="n">admitted</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">rejected</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">axe</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
    <span class="n">axe</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">axe</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">axe</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">rejected</span><span class="p">],</span>
                <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">rejected</span><span class="p">],</span>
                <span class="n">s</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">"k"</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">"Rejects"</span><span class="p">)</span>
    <span class="n">axe</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">admitted</span><span class="p">],</span>
                   <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">admitted</span><span class="p">],</span>
                   <span class="n">s</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Accepted"</span><span class="p">)</span>
    <span class="n">axe</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">axe</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgbe872d6">
<h4 id="orgbe872d6">Display</h4>
<div class="outline-text-4" id="text-orgbe872d6">
<p>The somewhat obscurely named <code>display</code> function is used to plot the separation lines of our model.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'g--'</span><span class="p">,</span> <span class="n">axe</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">"""Makes a line plot</span>

<span class="sd">    Args:</span>
<span class="sd">     m: slope for the line</span>
<span class="sd">     b: intercept for the line</span>
<span class="sd">     color: color and line type for plot</span>
<span class="sd">     axe: matplotlib axis</span>

<span class="sd">    Return:</span>
<span class="sd">     axe: matplotlib axis</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">axe</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">m</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">b</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">axe</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">"whitegrid"</span><span class="p">)</span>
<span class="n">FIGURE_SIZE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org21e91e4">
<h2 id="org21e91e4">The Data</h2>
<div class="outline-text-2" id="text-org21e91e4">
<p>We'll load the data from <code>data.csv</code> which has three columns - the first two are the inputs and the third is the label that we are trying to predict for the inputs.</p>
<div class="highlight">
<pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">DataPath</span><span class="p">(</span><span class="s2">"data.csv"</span><span class="p">)</span>
</pre></div>
<p>My setup is a little different than the Udacity setup so I'm going to have to get into the habit of setting the file before submission.</p>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">from_folder</span><span class="p">)</span>
<span class="n">DATA_FILE</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">from_folder</span>
</pre></div>
<pre class="example">
../../../data/introduction_to_neural_networks/data.csv

</pre>
<p>I'm not sure exactly why, but the data is loaded as a pandas DataFrame (with <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html">read_csv</a>) and then converted into two <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.array.html">arrays</a>.</p>
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA_FILE</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Data</th>
<th class="org-right" scope="col">Rows</th>
<th class="org-left" scope="col">Columns</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">X</td>
<td class="org-right">100</td>
<td class="org-left">2</td>
</tr>
<tr>
<td class="org-left">y</td>
<td class="org-right">100</td>
<td class="org-left">N/A</td>
</tr>
</tbody>
</table>
<p>Here's what our data looks like. I don't know what the inputs represent so I didn't label the axes, but it is a plot of the first input variable vs the second input variable, with the colors determined by the labels (y-values).</p>
<div class="highlight">
<pre><span></span><span class="n">axe</span> <span class="o">=</span> <span class="n">plot_points</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="data_scatter.png" src="/posts/nano/introduction-to-neural-networks/gradient-descent-practice/data_scatter.png"></p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org89c51a6">
<h2 id="org89c51a6">The Basic Functions</h2>
<div class="outline-text-2" id="text-org89c51a6"></div>
<div class="outline-3" id="outline-container-orgc93c312">
<h3 id="orgc93c312">The Sigmoid activation function</h3>
<div class="outline-text-3" id="text-orgc93c312">
<p>This is the function that pushes the probabilities that are produced to be close to 1 or 0 so we can classify the inputs.</p>
<p>\[\sigma(x) = \frac{1}{1+e^{-x}}\]</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""Calculates the sigmoid of x</span>

<span class="sd">    Args:</span>
<span class="sd">     x: input to classify</span>

<span class="sd">    Returns:</span>
<span class="sd">     sigmoid of x</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="sigmoid.png" src="/posts/nano/introduction-to-neural-networks/gradient-descent-practice/sigmoid.png"></p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org7da41c7">
<h3 id="org7da41c7">Output (prediction) formula</h3>
<div class="outline-text-3" id="text-org7da41c7">
<p>This function takes the dot product of the weights and inputs and adds the bias before returning the sigmoid of the calculation.</p>
<p>\[\hat{y} = \sigma(w_1 x_1 + w_2 x_2 + b)\]</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">output_formula</span><span class="p">(</span><span class="n">features</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                   <span class="n">weights</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                   <span class="n">bias</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""Predicts the outcomes for the inputs</span>

<span class="sd">    Args:</span>
<span class="sd">     features: inputs variables</span>
<span class="sd">     weights: array of weights for the variables</span>
<span class="sd">     bias: array of constants to adjust the output</span>

<span class="sd">    Returns:</span>
<span class="sd">     an array of predicted labels for the inputs</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="n">bias</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org2ad757b">
<h3 id="org2ad757b">Error function (log-loss)</h3>
<div class="outline-text-3" id="text-org2ad757b">
<p>This is used for reporting, since the actual updating of the weights uses the gradient.</p>
<p>\[Error(y, \hat{y}) = - y \log(\hat{y}) - (1-y) \log(1-\hat{y})\]</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">error_formula</span><span class="p">(</span><span class="n">y</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""Calculates the amount of error</span>

<span class="sd">    Args:</span>
<span class="sd">     y: the true labels</span>
<span class="sd">     output: the predicted labels</span>

<span class="sd">    Returns:</span>
<span class="sd">     amount of error in the output</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">y</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgb742775">
<h3 id="orgb742775">The function that updates the weights (the gradient descent step)</h3>
<div class="outline-text-3" id="text-orgb742775">
<p>This makes a prediction of the labels based on the inputs (using <code>output_formula</code>) and then updates the weights and bias based on the amount of error it had in the predictions.</p>
<p>\[ w_i \longrightarrow w_i + \alpha (y - \hat{y}) x_i\\ b \longrightarrow b + \alpha (y - \hat{y})\\ \]</p>
<p>Where \(\alpha\) is our learning rate and \(\hat{y}\) is our prediction for <i>y</i>.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">update_weights</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">bias</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">"""Updates the weights based on the amount of error</span>

<span class="sd">    Args:</span>
<span class="sd">     x: inputs</span>
<span class="sd">     y: actual labels</span>
<span class="sd">     weights: amount to weight each input</span>
<span class="sd">     bias: constant to adjust the output</span>
<span class="sd">     learning_rate: how much to adjust the weights</span>

<span class="sd">    Return:</span>
<span class="sd">     w, b: the updated weights</span>
<span class="sd">    """</span>
    <span class="n">y_hat</span> <span class="o">=</span> <span class="n">output_formula</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">bias</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">+=</span>  <span class="n">learning_rate</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_hat</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span>
    <span class="n">bias</span> <span class="o">+=</span> <span class="n">learning_rate</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_hat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">weights</span><span class="p">,</span> <span class="n">bias</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgb8ed0bc">
<h2 id="orgb8ed0bc">Training function</h2>
<div class="outline-text-2" id="text-orgb8ed0bc">
<p>This function will help us iterate the gradient descent algorithm through all the data, for a number of epochs. It will also plot the data, and some of the boundary lines obtained as we run the algorithm.</p>
<div class="highlight">
<pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">44</span><span class="p">)</span>
<span class="n">epochs</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.01</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">,</span> <span class="n">graph_lines</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">"""Trains a model using gradient descent</span>

<span class="sd">    Args:</span>
<span class="sd">     features: matrix of inputs</span>
<span class="sd">     targets: array of labels for the inputs</span>
<span class="sd">     epochs: number of times to train the model</span>
<span class="sd">     learning_rate: how much to adjust the weights per epoch</span>

<span class="sd">    Returns:</span>
<span class="sd">     weights, bias, errors, plot_x, plot_y: What we learned and how we improved</span>
<span class="sd">    """</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n_records</span><span class="p">,</span> <span class="n">n_features</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">last_loss</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n_features</span><span class="o">**.</span><span class="mi">5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_features</span><span class="p">)</span>
    <span class="n">bias</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">plot_x</span><span class="p">,</span> <span class="n">plot_y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
        <span class="c1"># train on each row in the training data</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">output_formula</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">bias</span><span class="p">)</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">error_formula</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
            <span class="n">weights</span><span class="p">,</span> <span class="n">bias</span> <span class="o">=</span> <span class="n">update_weights</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">bias</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">)</span>

        <span class="c1"># Printing out the log-loss error on the training set</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">output_formula</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">bias</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">error_formula</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">out</span><span class="p">))</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="p">(</span><span class="n">epochs</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">========== Epoch {} =========="</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">last_loss</span> <span class="ow">and</span> <span class="n">last_loss</span> <span class="o">&lt;</span> <span class="n">loss</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">"Training loss: "</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="s2">"  WARNING - Loss Increasing"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">"Training loss: "</span><span class="p">,</span> <span class="n">loss</span><span class="p">)</span>
            <span class="n">last_loss</span> <span class="o">=</span> <span class="n">loss</span>
            <span class="n">predictions</span> <span class="o">=</span> <span class="n">out</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
            <span class="n">accuracy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predictions</span> <span class="o">==</span> <span class="n">targets</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"Accuracy: "</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">graph_lines</span> <span class="ow">and</span> <span class="n">epoch</span> <span class="o">%</span> <span class="p">(</span><span class="n">epochs</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plot_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">plot_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">bias</span><span class="o">/</span><span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">weights</span><span class="p">,</span> <span class="n">bias</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">plot_x</span><span class="p">,</span> <span class="n">plot_y</span>
</pre></div>
<p>Time to train the algorithm.</p>
<p>When we run the function, we'll obtain the following:</p>
<ul class="org-ul">
<li>10 updates with the current training loss and accuracy</li>
<li>A plot of the data and some of the boundary lines obtained. The final one is in black. Notice how the lines get closer and closer to the best fit, as we go through more epochs.</li>
<li>A plot of the error function. Notice how it decreases as we go through more epochs.</li>
</ul>
<div class="highlight">
<pre><span></span><span class="n">weights</span><span class="p">,</span> <span class="n">bias</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">plot_x</span><span class="p">,</span> <span class="n">plot_y</span> <span class="o">=</span> <span class="n">train</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
<pre class="example">

========== Epoch 0 ==========
Training loss:  0.7135845195381634
Accuracy:  0.4

========== Epoch 10 ==========
Training loss:  0.6225835210454962
Accuracy:  0.59

========== Epoch 20 ==========
Training loss:  0.5548744083669508
Accuracy:  0.74

========== Epoch 30 ==========
Training loss:  0.501606141872473
Accuracy:  0.84

========== Epoch 40 ==========
Training loss:  0.4593334641861401
Accuracy:  0.86

========== Epoch 50 ==========
Training loss:  0.42525543433469976
Accuracy:  0.93

========== Epoch 60 ==========
Training loss:  0.3973461571671399
Accuracy:  0.93

========== Epoch 70 ==========
Training loss:  0.3741469765239074
Accuracy:  0.93

========== Epoch 80 ==========
Training loss:  0.35459973368161973
Accuracy:  0.94

========== Epoch 90 ==========
Training loss:  0.3379273658879921
Accuracy:  0.94
</pre>
<p>As you can see from the output the accuracy is getting better while the training loss (the mean of the error) is going down.</p>
<div class="highlight">
<pre><span></span><span class="c1"># Plotting the solution boundary</span>
<span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Solution boundary"</span><span class="p">)</span>
<span class="n">learning</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">plot_x</span><span class="p">,</span> <span class="n">plot_y</span><span class="p">)</span>
<span class="k">for</span> <span class="n">learn_x</span><span class="p">,</span> <span class="n">learn_y</span> <span class="ow">in</span> <span class="n">learning</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">learn_x</span><span class="p">,</span> <span class="n">learn_y</span><span class="p">,</span> <span class="n">axe</span><span class="o">=</span><span class="n">axe</span><span class="p">)</span>
<span class="n">axe</span> <span class="o">=</span> <span class="n">display</span><span class="p">(</span><span class="o">-</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">bias</span><span class="o">/</span><span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">'black'</span><span class="p">,</span> <span class="n">axe</span><span class="p">)</span>

<span class="c1"># Plotting the data</span>
<span class="n">axe</span> <span class="o">=</span> <span class="n">plot_points</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">axe</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="training.png" src="/posts/nano/introduction-to-neural-networks/gradient-descent-practice/training.png"></p>
</div>
<p>The green lines are the boundary as the model is trained, the black line is the final separator. While pretty, the green lines kind of obscure how well the sepration did. Here's just the final line with the input data.</p>
<div class="highlight">
<pre><span></span><span class="c1"># Plotting the solution boundary</span>
<span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"The Final Model"</span><span class="p">)</span>
<span class="n">axe</span> <span class="o">=</span> <span class="n">display</span><span class="p">(</span><span class="o">-</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">bias</span><span class="o">/</span><span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">'black'</span><span class="p">,</span> <span class="n">axe</span><span class="p">)</span>

<span class="c1"># Plotting the data</span>
<span class="n">axe</span> <span class="o">=</span> <span class="n">plot_points</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">axe</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="model.png" src="/posts/nano/introduction-to-neural-networks/gradient-descent-practice/model.png"></p>
</div>
<p>Finally, this is the amount of error as the model is trained.</p>
<div class="highlight">
<pre><span></span><span class="c1"># Plotting the error</span>
<span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Error Plot"</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Number of epochs'</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Error'</span><span class="p">)</span>
<span class="n">axe</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="error.png" src="/posts/nano/introduction-to-neural-networks/gradient-descent-practice/error.png"></p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgcf12e66">
<h2 id="orgcf12e66">Simpler Training</h2>
<div class="outline-text-2" id="text-orgcf12e66">
<p>If you squint at the <code>train</code> function you might notice that a considerable amount of it is used for reporting, making it a little harder to read than necessary. This is the same function without the extra reporting.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">only_train</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">"""Trains a model using gradient descent</span>

<span class="sd">    Args:</span>
<span class="sd">     features: matrix of inputs</span>
<span class="sd">     targets: array of labels for the inputs</span>
<span class="sd">     epochs: number of times to train the model</span>
<span class="sd">     learning_rate: how much to adjust the weights per epoch</span>

<span class="sd">    Returns:</span>
<span class="sd">     weights, bias: Our final model</span>
<span class="sd">    """</span>
    <span class="n">number_of_records</span><span class="p">,</span> <span class="n">number_of_features</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">number_of_records</span><span class="o">**.</span><span class="mi">5</span><span class="p">,</span>
                                  <span class="n">size</span><span class="o">=</span><span class="n">number_of_features</span><span class="p">)</span>
    <span class="n">bias</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
            <span class="n">weights</span><span class="p">,</span> <span class="n">bias</span> <span class="o">=</span> <span class="n">update_weights</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">bias</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">weights</span><span class="p">,</span> <span class="n">bias</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">weights</span><span class="p">,</span> <span class="n">bias</span> <span class="o">=</span> <span class="n">only_train</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="c1"># Plotting the solution boundary</span>
<span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"The Final Model"</span><span class="p">)</span>
<span class="n">axe</span> <span class="o">=</span> <span class="n">display</span><span class="p">(</span><span class="o">-</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">bias</span><span class="o">/</span><span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">'black'</span><span class="p">,</span> <span class="n">axe</span><span class="p">)</span>

<span class="c1"># Plotting the data</span>
<span class="n">axe</span> <span class="o">=</span> <span class="n">plot_points</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">axe</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="model_2.png" src="/posts/nano/introduction-to-neural-networks/gradient-descent-practice/model_2.png"></p>
</div>
<p>And the model for our linear classifier:</p>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">((</span><span class="s2">"</span><span class="se">\\</span><span class="s2">[</span><span class="se">\n</span><span class="s2">w_0 x_0 + w_1 x_1 + b "</span>
       <span class="s2">"= {:.2f}x_0 + {:.2f}x_1 + {:.2f}</span><span class="se">\n\\</span><span class="s2">]"</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                       <span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                       <span class="n">bias</span><span class="p">))</span>
</pre></div>
<p>\[ w_0 x_0 + w_1 x_1 + b = -3.13x_0 + -3.62x_1 + 3.31 \]</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/nano/introduction-to-neural-networks/gradient-descent/">Gradient Descent</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/nano/introduction-to-neural-networks/gradient-descent/" rel="bookmark"><time class="published dt-published" datetime="2018-10-26T18:30:34-07:00" itemprop="datePublished" title="2018-10-26 18:30">2018-10-26 18:30</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/nano/introduction-to-neural-networks/gradient-descent/#org5f1e3ae">What is this about?</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/gradient-descent/#org1937fd3">How does Gradient Descent Work?</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/gradient-descent/#orgc1b4af6">Okay, but what again?</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/gradient-descent/#org1715e34">So, how do you put it all together?</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org5f1e3ae">
<h2 id="org5f1e3ae">What is this about?</h2>
<div class="outline-text-2" id="text-org5f1e3ae">
<p>We have an initial network and we make a prediction using the inputs. USing the output we can calculate the error. Now that we have the error we need to update our weights - how do we do this? With <a href="https://en.wikipedia.org/wiki/Gradient_descent">Gradient Descent</a>, a method that tries to pursue a downward trajectory using the slope of our errors.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org1937fd3">
<h2 id="org1937fd3">How does Gradient Descent Work?</h2>
<div class="outline-text-2" id="text-org1937fd3">
<p>We start by making an initial prediction.</p>
<p>\[ \hat{y} = \sigma(Wx+b) \]</p>
<p>which it turns out is not accurate. We then subtract the gradient of the error (a partial derivative \(\frac{\delta E}{\delta W}\)) multiplied by some learning rate \(\alpha\) that governs how much we are willing to change at each step down the hill.</p>
<p>\[ w'_i \gets w_i - \alpha \frac{\delta E}{\delta W_i}\\ b' \gets b -\alpha \frac{\delta E}{\delta b}\\ \hat{y'} = \sigma(W'x t b') \]</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgc1b4af6">
<h2 id="orgc1b4af6">Okay, but what again?</h2>
<div class="outline-text-2" id="text-orgc1b4af6">
<p>To find our gradient we need to take some derivatives. Let's start with the derivative of our sigmoid.</p>
<p>\[ \sigma' = \sigma(x) (1 - \sigma(x)) \] The lecturer shows the derivation, but take my word for it, this is what it is.</p>
<p>Our error is:</p>
<p>\[ E = -y \ln(\hat{y}) - (1 - y)\ln(1 - \hat{y}) \]</p>
<p>and the derivative of this error:</p>
<p>\[ \frac{\delta}{\delta_{wj}}\hat{y} = \hat{y}(1 - \hat{y}) \dot x_j \]</p>
<p>Trust me, this is the derivation. And the derivation of our error becomes:</p>
<p>\[ \frac{\delta}{\delta w_j} = -(y - \hat{y})x_j \]</p>
<p>and for the bias term we get:</p>
<p>\[ \frac{\delta}{\delta b} = -(y - \hat{y}) \]</p>
<p>And our overall gradient can be written as:</p>
<p>\[ \Delta E = -(y - \hat{y})(x_1, \ldots, x_n, 1) \]</p>
<p>So our gradient is the coordinates of the points times the error. This means that the closer our prediction is to the true value, the smaller the gradient will be, and vice-versa, much like the <i>Perceptron Trick</i> we learned earlier.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org1715e34">
<h2 id="org1715e34">So, how do you put it all together?</h2>
<div class="outline-text-2" id="text-org1715e34">
<p>Okay, this is how you update your weights. First, scale \(\alpha\) to match your data set (divide by the number of rows). \[ \alpha = \frac{1}{m}\alpha \]</p>
<p>Now calculate your new weights.</p>
<p>\[ w_i' \gets w_i + \alpha(y - \hat{y})x_i \]</p>
<p>And the new bias.</p>
<p>\[ b' \gets b \alpha(y - \hat{y}) \]</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/grokking/04_gradient_descent/compare-and-learn/">Compare and Learn</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/grokking/04_gradient_descent/compare-and-learn/" rel="bookmark"><time class="published dt-published" datetime="2018-10-26T10:54:02-07:00" itemprop="datePublished" title="2018-10-26 10:54">2018-10-26 10:54</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<p>i#t+BEGIN_COMMENT .. title: Compare and Learn .. slug: compare-and-learn .. date: 2018-10-26 10:54:02 UTC-07:00 .. tags: grokking,gradient descent .. category: Grokking .. link: .. description: Introduction to Gradient Descent. .. type: text #+END_COMMENT</p>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/grokking/04_gradient_descent/compare-and-learn/#orgba67144">Imports</a></li>
<li><a href="/posts/grokking/04_gradient_descent/compare-and-learn/#orge97b104">What is this about?</a></li>
<li><a href="/posts/grokking/04_gradient_descent/compare-and-learn/#org22a5a46">What's the next step after Predict?</a></li>
<li><a href="/posts/grokking/04_gradient_descent/compare-and-learn/#org1df2e8c">So how do we learn?</a></li>
<li><a href="/posts/grokking/04_gradient_descent/compare-and-learn/#org08bc3b2">Training the Model</a></li>
<li><a href="/posts/grokking/04_gradient_descent/compare-and-learn/#orgc4e2f24">Is there a better way to update the weights?</a></li>
<li><a href="/posts/grokking/04_gradient_descent/compare-and-learn/#orgb1fee6d">A Discursion On Derivatives</a></li>
<li><a href="/posts/grokking/04_gradient_descent/compare-and-learn/#org56af07a">When does this work?</a></li>
<li><a href="/posts/grokking/04_gradient_descent/compare-and-learn/#org1ea5dcc">Fixing the Big Input Problem</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgba67144">
<h2 id="orgba67144">Imports</h2>
<div class="outline-text-2" id="text-orgba67144"></div>
<div class="outline-3" id="outline-container-orgd01836b">
<h3 id="orgd01836b">From PyPi</h3>
<div class="outline-text-3" id="text-orgd01836b">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">graphviz</span> <span class="kn">import</span> <span class="n">Digraph</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">pyplot</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgfb16645">
<h3 id="orgfb16645">Setup the plotting</h3>
<div class="outline-text-3" id="text-orgfb16645">
<div class="highlight">
<pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="o">%</span><span class="n">config</span> <span class="n">InlineBackend</span><span class="o">.</span><span class="n">figure_format</span><span class="o">=</span><span class="s1">'retina'</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">"whitegrid"</span><span class="p">)</span>
<span class="n">FIGURE_SIZE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orge97b104">
<h2 id="orge97b104">What is this about?</h2>
<div class="outline-text-2" id="text-orge97b104">
<p>The three main steps in training a model are:</p>
<ol class="org-ol">
<li>Predict</li>
<li>Compare</li>
<li>Learn</li>
</ol>
<p><i>Forward Propagation</i> was about the <i>Predict</i> step - we fed some inputs to a network and it output its predictions. Now we're going to look an steps 2 and 3 - <i>Compare</i> and <i>Learn</i>, the steps where we figure out how to improve the weights in our network.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org22a5a46">
<h2 id="org22a5a46">What's the next step after Predict?</h2>
<div class="outline-text-2" id="text-org22a5a46">
<p>As noted above, step 2 is <i>Compare</i> meaning compare our predictions with what we know to be the real answers (so this is <a href="https://en.wikipedia.org/wiki/Supervised_learning">supervised learning</a>) and see how well (or bad) we did.</p>
</div>
<div class="outline-3" id="outline-container-orge97b6d0">
<h3 id="orge97b6d0">Okay, but then what?</h3>
<div class="outline-text-3" id="text-orge97b6d0">
<p>After <i>Compare</i> we move on to the <i>Learn</i> step where we adjust the weights based on the errors we found in <i>Compare</i>. In this case we'll use <a href="https://en.wikipedia.org/wiki/Gradient_descent">Gradient Descent</a> to find new weights for the network.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orga5c4201">
<h3 id="orga5c4201">So, how do we find the error again?</h3>
<div class="outline-text-3" id="text-orga5c4201">
<p>There are many different ways to measure error, each with different positive and negative attributes, but in this case we're going to use <a href="https://en.wikipedia.org/wiki/Mean_squared_error">Mean Squared Error</a>. Here's an example with one measurement.</p>
<div class="highlight">
<pre><span></span><span class="n">weight</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">input_value</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">expected</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">input_value</span>
<span class="c1"># you implicitly divide by 1 to get the mean of the square</span>
<span class="n">actual_error</span> <span class="o">=</span> <span class="p">(</span><span class="n">expected</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="n">expected_error</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">expected_error</span> <span class="o">-</span> <span class="n">actual_error</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Error: {:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">actual_error</span><span class="p">))</span>
</pre></div>
<pre class="example">
Error: 0.30

</pre>
<p>Two things to note about the consequences of squaring the error - one is that it's always positive which is useful because you might have both positive and negative errors which would tend to cancel each other out when you take the mean (the <code>actual_error</code> above is a mean with an implied count of 1), even though both positive and negative errors are wrong, the other consequence is that the greater the error, the larger it grows (it follows a parabola instead of a line).</p>
<div class="highlight">
<pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
<span class="n">errors</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Squared vs Unsquared Errors"</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Squared Errors"</span> <span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Errors"</span><span class="p">)</span>
<span class="n">legend</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
<div class="figure">
<p><img alt="squared_error.png" src="/posts/grokking/04_gradient_descent/compare-and-learn/squared_error.png"></p>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org1df2e8c">
<h2 id="org1df2e8c">So how do we learn?</h2>
<div class="outline-text-2" id="text-org1df2e8c">
<p>One method is <i>Hot-and-Cold Learning</i>. With this method you move your weights a little and pick the one that improves the error-rate. This first example will go back to the one feature network that tries to predict if a team will win using the average number of toes they have.</p>
<div class="highlight">
<pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">Digraph</span><span class="p">(</span><span class="n">comment</span><span class="o">=</span><span class="s2">"Toes"</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">"png"</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">rankdir</span><span class="o">=</span><span class="s2">"LR"</span><span class="p">)</span>
<span class="c1"># input layer</span>
<span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"Toes"</span><span class="p">)</span>

<span class="c1"># output layer</span>
<span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">"b"</span><span class="p">,</span> <span class="s2">"Win"</span><span class="p">)</span>

<span class="c1"># edge</span>
<span class="n">graph</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Weight"</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">"graphs/toes_model.dot"</span><span class="p">)</span>
<span class="n">graph</span>
</pre></div>
<div class="figure">
<p><img alt="toes_model.dot.png" src="/posts/grokking/04_gradient_descent/compare-and-learn/toes_model.dot.png"></p>
</div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">toes_model</span><span class="p">(</span><span class="n">toes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">"""Predicts if the team will win based on the number of toes</span>

<span class="sd">    Return:</span>
<span class="sd">     predction: probability of winning</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">toes</span> <span class="o">*</span> <span class="n">weight</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">print_error</span><span class="p">(</span><span class="n">predicted</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">actual</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">"Toes Model"</span><span class="p">,</span>
                <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">"""Prints the (mean) squared error</span>

<span class="sd">    Args:</span>

<span class="sd">     predicted: what the model predicted</span>
<span class="sd">     actual: whether the team won or not</span>
<span class="sd">     label: something to identify the model</span>
<span class="sd">     separator: How to separate the output</span>
<span class="sd">    Returns:</span>
<span class="sd">     mse: the error</span>
<span class="sd">    """</span>
    <span class="n">error</span> <span class="o">=</span> <span class="p">(</span><span class="n">actual</span> <span class="o">-</span> <span class="n">predicted</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">print</span><span class="p">(</span><span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">label</span><span class="p">,</span>
                          <span class="s2">"Predicted: {:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">predicted</span><span class="p">),</span>
                          <span class="s2">"Actual: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">actual</span><span class="p">),</span>
                          <span class="s2">"MSE: {:.4f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">)]))</span>
    <span class="k">return</span> <span class="n">error</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">toes</span> <span class="o">=</span> <span class="mf">8.5</span>
<span class="n">actual</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">predicted</span> <span class="o">=</span> <span class="n">toes_model</span><span class="p">(</span><span class="n">toes</span><span class="p">)</span>
<span class="n">error_original</span> <span class="o">=</span> <span class="n">print_error</span><span class="p">(</span><span class="n">predicted</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
</pre></div>
<pre class="example">
Toes Model
Predicted: 0.85
Actual: 1
MSE: 0.0225

</pre>
<p>So our model has a Mean Squared Error of around 0.02, how do we make it better with the Hot and Cold Method? By trying a larger and smaller weight and using the one that makes the error smaller.</p>
<div class="highlight">
<pre><span></span><span class="n">weight_change</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">weight</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">knob_turned_up</span> <span class="o">=</span> <span class="n">toes_model</span><span class="p">(</span><span class="n">toes</span><span class="p">,</span> <span class="n">weight</span> <span class="o">+</span> <span class="n">weight_change</span><span class="p">)</span>
<span class="n">knob_turned_down</span> <span class="o">=</span> <span class="n">toes_model</span><span class="p">(</span><span class="n">toes</span><span class="p">,</span> <span class="n">weight</span> <span class="o">-</span> <span class="n">weight_change</span><span class="p">)</span>

<span class="n">error_up</span> <span class="o">=</span> <span class="n">print_error</span><span class="p">(</span><span class="n">knob_turned_up</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="s2">"Turned Up"</span><span class="p">)</span>
<span class="k">print</span><span class="p">()</span>
<span class="n">error_down</span> <span class="o">=</span> <span class="n">print_error</span><span class="p">(</span><span class="n">knob_turned_down</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="s2">"Turned Down"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Turned Up
Predicted: 0.94
Actual: 1
MSE: 0.0042

Turned Down
Predicted: 0.77
Actual: 1
MSE: 0.0552

</pre>
<p>Looking at the error, it looks like making the weight higher improved the score, so we should adjust our weight upwards.</p>
<div class="highlight">
<pre><span></span><span class="k">if</span> <span class="n">error_original</span> <span class="o">&gt;</span> <span class="n">error_up</span> <span class="ow">or</span> <span class="n">error_original</span> <span class="o">&gt;</span> <span class="n">error_down</span><span class="p">:</span>
    <span class="n">change_direction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">error_down</span> <span class="o">&lt;</span> <span class="n">error_original</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">weight_updated</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">+</span> <span class="n">change_direction</span> <span class="o">*</span> <span class="n">weight_change</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">toes_model</span><span class="p">(</span><span class="n">toes</span><span class="p">,</span> <span class="n">weight_updated</span><span class="p">)</span>
    <span class="n">error_update</span> <span class="o">=</span> <span class="n">print_error</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="s2">"Updated Model"</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">error_update</span> <span class="o">&lt;</span> <span class="n">error_original</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"Model didn't improve."</span><span class="p">)</span>
</pre></div>
<pre class="example">
Updated Model
Predicted: 0.94
Actual: 1
MSE: 0.0042

</pre>
<p>So, this is what machine learning is really about, finding the parameters that give the best prediction. This is why it is often called a <b>search</b> problem - each of your parameters can have a variety of weights (infinite, actually) so what you are doing when you train your model is searching the space of weights to find the set that gives the best outcome for your metric. In this case we are looking to minimize our Mean Squared Error.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org08bc3b2">
<h2 id="org08bc3b2">Training the Model</h2>
<div class="outline-text-2" id="text-org08bc3b2">
<p>Rather than than trying to do the checks one at a time, we can run the Hot and Cold Learning in a loop to tune our model.</p>
<div class="highlight">
<pre><span></span><span class="n">weight</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">input_value</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">actual</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">weight_change</span> <span class="o">=</span> <span class="mf">0.001</span>

<span class="n">prediction</span> <span class="o">=</span> <span class="n">toes_model</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span>
<span class="n">print_error</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="s2">"Step    1 Weight: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight</span><span class="p">),</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">)</span>
<span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">optimal_step</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">**</span><span class="mi">8</span>
<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2001</span><span class="p">):</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">toes_model</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="p">(</span><span class="n">print_error</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span>
                         <span class="s2">"Step {:4} Weight: {:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">weight</span><span class="p">),</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">)</span>
             <span class="k">if</span> <span class="ow">not</span> <span class="n">step</span> <span class="o">%</span> <span class="mi">100</span> <span class="k">else</span> <span class="p">(</span><span class="n">prediction</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">optimal_step</span> <span class="ow">and</span> <span class="n">error</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">:</span>
        <span class="n">optimal_step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">up_prediction</span> <span class="o">=</span> <span class="n">toes_model</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">weight</span> <span class="o">+</span> <span class="n">weight_change</span><span class="p">)</span>
    <span class="n">down_prediction</span> <span class="o">=</span> <span class="n">toes_model</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">weight</span> <span class="o">-</span> <span class="n">weight_change</span><span class="p">)</span>
    <span class="n">up_error</span> <span class="o">=</span> <span class="p">(</span><span class="n">up_prediction</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">down_error</span> <span class="o">=</span> <span class="p">(</span><span class="n">down_prediction</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">down_error</span> <span class="o">&lt;</span> <span class="n">up_error</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">weight</span> <span class="o">+=</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">weight_change</span>
    <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">"Optimum Reached at Step {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">optimal_step</span><span class="p">))</span>
</pre></div>
<pre class="example">
Step    1 Weight: 0.5   Predicted: 0.25 Actual: 0.8     MSE: 0.3025
Step  100 Weight: 0.60  Predicted: 0.30 Actual: 0.8     MSE: 0.2505
Step  200 Weight: 0.70  Predicted: 0.35 Actual: 0.8     MSE: 0.2030
Step  300 Weight: 0.80  Predicted: 0.40 Actual: 0.8     MSE: 0.1604
Step  400 Weight: 0.90  Predicted: 0.45 Actual: 0.8     MSE: 0.1229
Step  500 Weight: 1.00  Predicted: 0.50 Actual: 0.8     MSE: 0.0903
Step  600 Weight: 1.10  Predicted: 0.55 Actual: 0.8     MSE: 0.0628
Step  700 Weight: 1.20  Predicted: 0.60 Actual: 0.8     MSE: 0.0402
Step  800 Weight: 1.30  Predicted: 0.65 Actual: 0.8     MSE: 0.0227
Step  900 Weight: 1.40  Predicted: 0.70 Actual: 0.8     MSE: 0.0101
Step 1000 Weight: 1.50  Predicted: 0.75 Actual: 0.8     MSE: 0.0026
Step 1100 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step 1200 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step 1300 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step 1400 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step 1500 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step 1600 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step 1700 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step 1800 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step 1900 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step 2000 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Optimum Reached at Step 1100
</pre>
<div class="highlight">
<pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Hot and Cold Mean Squared Error"</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Training Repetition"</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"MSE"</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)),</span> <span class="n">errors</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="hot_and_cold_error.png" src="/posts/grokking/04_gradient_descent/compare-and-learn/hot_and_cold_error.png"></p>
</div>
<p>Looking at the output you can see that it reached an error of (nearly) zero at the 1,100th repetition. Based on the plot it looks like it kind of slowed down at the end, which is odd since we're using addition and subtraction, but I guess as the weight gets bigger the proportion of change you add becomes less.</p>
<div class="highlight">
<pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Hot and Cold Mean Squared Error vs Weights"</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Weight"</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"MSE"</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="s2">"."</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="hot_and_cold_weights_vs_error.png" src="/posts/grokking/04_gradient_descent/compare-and-learn/hot_and_cold_weights_vs_error.png"></p>
</div>
<p>Our optimal weight appears to be 1.6. Given the simplicity of our model we can check by solving the equation.</p>
<p>\[ prediction = weight \times input\\ weight = \frac{prediction}{input} \]</p>
<div class="highlight">
<pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">prediction</span><span class="o">/</span><span class="n">input_value</span><span class="p">)</span>
</pre></div>
<pre class="example">
1.6009999999999343

</pre>
<p>So, that looks about right.</p>
</div>
<div class="outline-3" id="outline-container-org81df0ca">
<h3 id="org81df0ca">Pros and Cons of Hot and Cold Learning</h3>
<div class="outline-text-3" id="text-org81df0ca">
<p>The main thing that Hot and Cold Learning has going for it is that it is simple to understand and implement. There are a couple of problems with it though:</p>
<ul class="org-ul">
<li>You have to make multiple predictions per knob to make a decision on the change to make.</li>
<li>The amount you change the weight at each step can make it impossible to get the right weight, and in most cases you won't have just one input value so it's hard to know what to pick</li>
</ul>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgc4e2f24">
<h2 id="orgc4e2f24">Is there a better way to update the weights?</h2>
<div class="outline-text-2" id="text-orgc4e2f24">
<p>With <i>Hot and Cold Learning</i> we make multiple predictions to decide which direction to add a set amount to the weight. But we can instead use the error to change our weight, and in doing so we will change both direction and scale based on the error. In this case <i>error</i> means "pure error", or just the difference between the prediction and the actual value.</p>
<p>\[ error = prediction - actual \]</p>
<p>Since we don't square it the error will be positive if our prediction is too high and negative if it is too low. We don't want to just use the difference, though, because we are adjusting a weight that gets multiplied by the input, so we need to scale the amount of change by the input.</p>
<p>Note that the ordering is now important - you have to subtract the error in the version above and add it if the terms are switched.</p>
<p>\[ adjustment = error * input\\ weights' = weights - adjustment \]</p>
<p>This is the method of <a href="https://en.wikipedia.org/wiki/Gradient_descent">Gradient Descent</a>. This is how it looks run on our previous problem.</p>
<div class="highlight">
<pre><span></span><span class="n">weight</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">input_value</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">actual</span> <span class="o">=</span> <span class="mf">0.8</span>

<span class="n">prediction</span> <span class="o">=</span> <span class="n">toes_model</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span>
<span class="n">print_error</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="s2">"Step    1 Weight: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight</span><span class="p">),</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">)</span>
<span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">optimal_step</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">**</span><span class="mi">8</span>
<span class="n">optimal_count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">print_every</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">stop_after</span> <span class="o">=</span> <span class="mi">30</span>
<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2001</span><span class="p">):</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">toes_model</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span>
    <span class="n">difference</span> <span class="o">=</span> <span class="p">(</span><span class="n">prediction</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">*</span> <span class="n">input_value</span>
    <span class="n">weight</span> <span class="o">-=</span> <span class="n">difference</span>
    <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>    
    <span class="n">error</span> <span class="o">=</span> <span class="p">(</span><span class="n">print_error</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span>
                         <span class="s2">"Step {:4} Weight: {:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">weight</span><span class="p">),</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">)</span>
             <span class="k">if</span> <span class="ow">not</span> <span class="n">step</span> <span class="o">%</span> <span class="n">print_every</span> <span class="k">else</span> <span class="p">(</span><span class="n">prediction</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">optimal_step</span> <span class="ow">and</span> <span class="n">error</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">:</span>
        <span class="n">optimal_step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">error</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">:</span>
        <span class="n">optimal_count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">optimal_count</span> <span class="o">&gt;=</span> <span class="n">stop_after</span><span class="p">:</span>
        <span class="k">break</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Optimum Reached at Step {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">optimal_step</span><span class="p">))</span>
</pre></div>
<pre class="example">
Step    1 Weight: 0.5   Predicted: 0.25 Actual: 0.8     MSE: 0.3025
Step    5 Weight: 1.34  Predicted: 0.63 Actual: 0.8     MSE: 0.0303
Step   10 Weight: 1.54  Predicted: 0.76 Actual: 0.8     MSE: 0.0017
Step   15 Weight: 1.59  Predicted: 0.79 Actual: 0.8     MSE: 0.0001
Step   20 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step   25 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step   30 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step   35 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step   40 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step   45 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step   50 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step   55 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Step   60 Weight: 1.60  Predicted: 0.80 Actual: 0.8     MSE: 0.0000
Optimum Reached at Step 30
</pre>
<p>So it now hits the optimal solution at the 30th step instead of the 1,100th step (although it really seems to reach it at step 20, I think the difference is a rounding problem).</p>
<div class="highlight">
<pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Gradient Descent Mean Squared Error"</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Training Repetition"</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"MSE"</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)),</span> <span class="n">errors</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="gradient_descent_error.png" src="/posts/grokking/04_gradient_descent/compare-and-learn/gradient_descent_error.png"></p>
</div>
<div class="highlight">
<pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Gradient Descent Mean Squared Error vs Weights"</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Weight"</span><span class="p">)</span>
<span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"MSE"</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="s2">"o"</span><span class="p">)</span>
</pre></div>
<div class="figure">
<p><img alt="gradient_descent_weights_vs_error.png" src="/posts/grokking/04_gradient_descent/compare-and-learn/gradient_descent_weights_vs_error.png"></p>
</div>
<p>The plots show what we already saw in the output, that Gradient Descent converges on a solution much faster than Hot and Cold Learning does.</p>
</div>
<div class="outline-3" id="outline-container-org72b49b2">
<h3 id="org72b49b2">Why multiply the error by the input?</h3>
<div class="outline-text-3" id="text-org72b49b2">
<p>This has three main effects called <i>stopping, negative reversal</i>, and <i>scaling</i>.</p>
</div>
<div class="outline-4" id="outline-container-orge445714">
<h4 id="orge445714">What is Stopping?</h4>
<div class="outline-text-4" id="text-orge445714">
<p>Stopping refers to the case where the input is 0. If that's the case then we don't want to adjust the weight so multiplying the error by the input nullifies it.</p>
</div>
</div>
<div class="outline-4" id="outline-container-orgf172946">
<h4 id="orgf172946">What is Negative Reversal?</h4>
<div class="outline-text-4" id="text-orgf172946">
<p>The sign of the input changes which direction we want the weight to change, so multiplying it by the input keeps the change moving in the right direction even when the sign of the input changes.</p>
</div>
</div>
<div class="outline-4" id="outline-container-org06c6e2f">
<h4 id="org06c6e2f">What is Scaling?</h4>
<div class="outline-text-4" id="text-org06c6e2f">
<p>The larger the input, the greater the amount of change it will add. This can be a bad thing, since the inputs can now have an outsized (negative) effect.</p>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgb1fee6d">
<h2 id="orgb1fee6d">A Discursion On Derivatives</h2>
<div class="outline-text-2" id="text-orgb1fee6d">
<p>What we're doing when we train our model to minimize our error. In the Mean Squared Error equation:</p>
<p>\[ MSE = \frac{1}{n} \sum_{i=1}^n ((input \times weight) - actual)^2 \]</p>
<p>The only thing we can change is the <code>weight</code>, the <code>input</code> and <code>actual output</code> is set by the data. So what we're interested in is how the error changes as we change the weight. The relationship between how the output changes in relationship to how the input changes is the <a href="https://en.wikipedia.org/wiki/Derivative">derivative</a>. One way to think of the derivative is the slope at a point on a line. If you have a straight line the slope will be the same everywhere on it, but if it is curved then different points will have different slopes.</p>
<p>In our case our input is the <code>weight</code> and the output is the <code>error</code>. If you think about slope as \[\frac{rise}{run}\] you'll notice that the bigger the rise, the bigger the slope (since we're taking it at a point the <i>run</i> is infinitesimal), and it's positive going up and negative going down, so if you think of the plot of the MSE earlier, the further you go away from the center (where the error is zero), the steeper the slope, and moving away from the center is always moving up, so the slope is always positive, and moving toward the center where the error is zero is always moving down, so the slope is negative.</p>
<p>What we want, then, is to move our weights in the opposite direction of the slope. There's more math involved to explain this than I can handle right now, but when we calculate our weight adjustment, we are calculating the derivative, and since we want to move in the opposite direction of the derivative, we negate it. And the further away we are from the true value (where our error is zero), the greater the difference is, as we would expect from the slope of our line.</p>
<p>\[ \Delta = prediction - actual\\ \Delta_{weighted} = \Delta \times input\\ weight' = weight - \Delta_{weighted} \]</p>
</div>
</div>
<div class="outline-2" id="outline-container-org56af07a">
<h2 id="org56af07a">When does this work?</h2>
<div class="outline-text-2" id="text-org56af07a">
<p>Well, it's easier to look at when it doesn't work than when it does.</p>
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">OneNode</span><span class="p">:</span>
    <span class="sd">"""Implements a single-node network</span>

<span class="sd">    Args:</span>
<span class="sd">     weight: the starting weight for the edge from the input to the output</span>
<span class="sd">     input_value: the input to the node</span>
<span class="sd">     actual: the actual output we are trying to predict</span>

<span class="sd">     training_steps: how many times to train the model</span>
<span class="sd">     tolerance: how close to zero we need our error to be</span>
<span class="sd">     print_every: how often to print training status</span>
<span class="sd">     stop_after: how many times to keep going after the optimal was found</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">input_value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">actual</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">training_steps</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                 <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.1</span><span class="o">**</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">print_every</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">stop_after</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_weight</span> <span class="o">=</span> <span class="n">weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_value</span> <span class="o">=</span> <span class="n">input_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actual</span> <span class="o">=</span> <span class="n">actual</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">training_steps</span> <span class="o">=</span> <span class="n">training_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span> <span class="o">=</span> <span class="n">tolerance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_every</span> <span class="o">=</span> <span class="n">print_every</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_after</span> <span class="o">=</span> <span class="n">stop_after</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">errors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">"""list of MSE values"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">weights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">"""List of weights built during training"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">"""List of predictions made"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">"""The current model's prediction"""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_value</span>

    <span class="k">def</span> <span class="nf">mean_squared_error</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">"""The mean squared error for the prediction"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">except</span> <span class="ne">OverflowError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"prediction: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"actual: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actual</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">print_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">step</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">,</span>
                    <span class="n">force_print</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                    <span class="n">store_error</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">"""Prints the (mean) squared error</span>

<span class="sd">       Args:</span>
<span class="sd">        step: what step this is</span>
<span class="sd">        separator: How to separate the output</span>
<span class="sd">        force_print: ignore the step count and print anyway</span>
<span class="sd">        store_error: whether to add to the errors</span>
<span class="sd">       Returns:</span>
<span class="sd">        mse: the error</span>
<span class="sd">       """</span>
        <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">store_error</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">force_print</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">step</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_every</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">"Input: {} Actual Output: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_value</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">actual</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">"Step: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">),</span>
                                  <span class="s2">"Weight: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">),</span>
                                  <span class="s2">"Predicted: {:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction</span><span class="p">),</span>
                                  <span class="s2">"MSE: {:.4f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="p">)]))</span>
        <span class="k">return</span> <span class="n">error</span>

    <span class="k">def</span> <span class="nf">adjust_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="sd">"""Takes the gradient descent step"""</span>
        <span class="n">scaled_derivative</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">actual</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">-=</span> <span class="n">scaled_derivative</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Trains our model on the values</span>

<span class="sd">       """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_value</span>
        <span class="n">optimal_step</span> <span class="o">=</span> <span class="n">optimal_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_error</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
                                 <span class="n">force_print</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                 <span class="n">store_error</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_error</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">adjust_weight</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">optimal_step</span> <span class="ow">and</span> <span class="n">error</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tolerance</span><span class="p">:</span>
                <span class="n">optimal_step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">error</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">:</span>
                <span class="n">optimal_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">optimal_count</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_after</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">"Optimum Reached at Step {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">optimal_step</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">plot_errors_over_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s2">"linear"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="sd">"""Plots the error as it is trained</span>

<span class="sd">       Args:</span>
<span class="sd">        scale: y-axis scale</span>
<span class="sd">       """</span>
        <span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
        <span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Gradient Descent Mean Squared Error"</span><span class="p">)</span>
        <span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Training Repetition"</span><span class="p">)</span>
        <span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"MSE"</span><span class="p">)</span>
        <span class="n">axe</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">plot_errors_vs_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">"o"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="sd">"""Plots errors given weights"""</span>
        <span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
        <span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Gradient Descent Mean Squared Error vs Weights"</span><span class="p">)</span>
        <span class="n">axe</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Weight"</span><span class="p">)</span>
        <span class="n">axe</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"MSE"</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">axe</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">plot_weight_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="sd">"""Plots the distribution of the weights"""</span>
        <span class="n">figure</span><span class="p">,</span> <span class="n">axe</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGURE_SIZE</span><span class="p">)</span>
        <span class="n">axe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Distribution Of Weights"</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
        <span class="k">return</span>


    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Resets the properties"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_weight</span>
        <span class="k">return</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgc04cb84">
<h3 id="orgc04cb84">Really Big Inputs</h3>
<div class="outline-text-3" id="text-orgc04cb84">
<div class="highlight">
<pre><span></span><span class="n">network</span> <span class="o">=</span> <span class="n">OneNode</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">input_value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">actual</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">print_every</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">network</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</pre></div>
<pre class="example">
Input: 5 Actual Output: 0.1
Step: 1 Weight: 0.1     Predicted: 0.50 MSE: 0.1600
Input: 5 Actual Output: 0.1
Step: 30        Weight: -8.496029205125367e+38  Predicted: -4248014602562683567255766167412625375232.00 MSE: 18045628063585794511112671022597693816764790617265863683813015097617735965736960.0000
Input: 5 Actual Output: 0.1
Step: 60        Weight: -2.1654753676302967e+80 Predicted: -1082737683815148355196656106977575165473067380893761893846901009426287310965571584.00       MSE: 1172320891953392254658250331342439625964504567088377053437708818301948653571886896236931555371967400274585017142698424782066192956435576184566862647806273773371392.0000
Input: 5 Actual Output: 0.1
Step: 90        Weight: -5.51938258990998e+121  Predicted: -275969129495499010312802960568845701886516344963538842611688052470072992651229004282112996195046030793242534509005731004416.00      MSE: 76158960434503501277477316231095001035615545032300898123025508833954593912013767638712660721529293958181614329406854402338675069139074333788043867020532267345247209268079568592806683870329999393916410491701860464641755145654976460424275531137024.0000
(34, 'Numerical result out of range')
prediction: 1.5336245888098994e+154
actual: 0.1
</pre>
<p>So, when the input is too big, the prediction explodes.</p>
<div class="highlight">
<pre><span></span><span class="n">network</span><span class="o">.</span><span class="n">plot_errors_over_time</span><span class="p">()</span>
</pre></div>
<div class="figure">
<p><img alt="too_big_errors.png" src="/posts/grokking/04_gradient_descent/compare-and-learn/too_big_errors.png"></p>
</div>
<p>It looks at first like there was no error and then all of a sudden it got huge - but if you look at the scale of the y-axis it maxes out at over \(4\times10^{305}\) and then the overflow error causes it to quit. So when the input is too large, the network goes out of control.</p>
<div class="highlight">
<pre><span></span><span class="n">network</span><span class="o">.</span><span class="n">plot_errors_vs_weights</span><span class="p">()</span>
</pre></div>
<p><img alt="too_big_errors_vs_weights.png" src="/posts/grokking/04_gradient_descent/compare-and-learn/too_big_errors_vs_weights.png"> So now it looks like there aren't really many weights, but if you look at both the X and Y scales you can see that they're really huge, so most of the points are probably centered around 0 (relative to the overall scale) and then all of a sudden they go crazy on the last two points.</p>
<div class="highlight">
<pre><span></span><span class="n">figure</span><span class="p">,</span> <span class="n">axe</span>
<span class="n">network</span><span class="o">.</span><span class="n">plot_weight_distribution</span><span class="p">()</span>
</pre></div>
<div class="figure">
<p><img alt="too_big_distribution_of_weights.png" src="/posts/grokking/04_gradient_descent/compare-and-learn/too_big_distribution_of_weights.png"></p>
</div>
<p>So we have a small number of weights that are very large. Or a lot of very large weights with a small number of very-very-large weights.</p>
<div class="highlight">
<pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">weights</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
<pre class="example">
count     1.130000e+02
mean     2.605805e+151
std      2.888965e+152
min     -1.278020e+152
25%      -6.526920e+74
50%      -1.900000e+00
75%       1.566461e+76
max      3.067249e+153
dtype: float64

</pre>
<p>So the median is -1.9 and the mean is \(0.6 \times 10^{151}\). Looks like there are some outliers.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org1ea5dcc">
<h2 id="org1ea5dcc">Fixing the Big Input Problem</h2>
<div class="outline-text-2" id="text-org1ea5dcc">
<p>The problem with big inputs is that they cause the gradient descent to explode. Remember our error function:</p>
<p>\[ error = input \times (predicted - actual)\\ = input \times ((input \times weights) - actual) \]</p>
<p>If the input is big the error will be big, and since our correction to the weights is based on the error:</p>
<p>\[ weights' = weights - error \]</p>
<p>our weights can start to swing wildly back and forth with the error growing larger and larger and swinginig between positive and negative numbers. The larger the input, the larger the error, the larger the derivative will be in the opposite direction.</p>
<p>The fix is to only update using a fraction of the correction. We find some value (\(\alpha\)) and multiply it by the change to reduce the influence any one change has. How do we find \(\alpha\)? Well, that turns out to be done by trial and error. If your error goes up as you train, then you probably have to make it smaller.</p>
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">AlphaNode</span><span class="p">(</span><span class="n">OneNode</span><span class="p">):</span>
    <span class="sd">"""Incorporates weight update reduction</span>

<span class="sd">    Args:</span>
<span class="sd">     alpha: amount to weight the update</span>

<span class="sd">     weight: the starting weight for the edge from the input to the output</span>
<span class="sd">     input_value: the input to the node</span>
<span class="sd">     actual: the actual output we are trying to predict</span>

<span class="sd">     training_steps: how many times to train the model</span>
<span class="sd">     tolerance: how close to zero we need our error to be</span>
<span class="sd">     print_every: how often to print training status</span>
<span class="sd">     stop_after: how many times to keep going after the optimal was found</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="vm">__class__</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">adjust_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="sd">"""Takes the gradient descent step with alpha weight"""</span>
        <span class="n">scaled_derivative</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">actual</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">scaled_derivative</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
        <span class="k">return</span>
</pre></div>
<p>Why does this help? Our problem is that the large inputs cause the gradient descent to overshoot past the value that would give zero error and by reducing the amount any one change can have we reduce the likelihood that this will happen.</p>
<div class="highlight">
<pre><span></span><span class="n">alpha_network</span> <span class="o">=</span> <span class="n">AlphaNode</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">input_value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                          <span class="n">actual</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">print_every</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">alpha_network</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</pre></div>
<pre class="example">
Input: 5 Actual Output: 0.8
Step: 1 Weight: 0.5     Predicted: 2.50 MSE: 2.8900
Input: 5 Actual Output: 0.8
Step: 30        Weight: -43463.41342612052      Predicted: -217317.07   MSE: 47227055374.1942
Input: 5 Actual Output: 0.8
Step: 60        Weight: -8334186242.344855      Predicted: -41670931211.72      MSE: 1736466508118929965056.0000
Input: 5 Actual Output: 0.8
Step: 90        Weight: -1598089039844441.2     Predicted: -7990445199222206.00 MSE: 63847214481773219178788224499712.0000
Input: 5 Actual Output: 0.8
Step: 120       Weight: -3.064352661386353e+20  Predicted: -1532176330693176459264.00   MSE: 2347564308336405932287023519199639310958592.0000
Input: 5 Actual Output: 0.8
Step: 150       Weight: -5.875928686839428e+25  Predicted: -293796434341971398081118208.00      MSE: 86316344832056315635271476663737243674922770633850880.0000
Input: 5 Actual Output: 0.8
Step: 180       Weight: -1.1267155496783526e+31 Predicted: -56335777483917627928853446918144.00 MSE: 3173719824717480263078840848567916525595895306706307529098395648.0000
Optimum Reached at Step 0
</pre>
<p>Okay, so that still didn't work, maybe if \(\alpha\) was smaller?</p>
<div class="highlight">
<pre><span></span><span class="n">alpha_network</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">alpha_network</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</pre></div>
<pre class="example">
Input: 5 Actual Output: 0.8
Step: 1 Weight: 0.5     Predicted: 2.50 MSE: 2.8900
Input: 5 Actual Output: 0.8
Step: 30        Weight: 0.1600809572142104      Predicted: 0.80 MSE: 0.0000
Input: 5 Actual Output: 0.8
Step: 60        Weight: 0.16000001445750855     Predicted: 0.80 MSE: 0.0000
Optimum Reached at Step 34

</pre>
<p>So now our model is able to reach the correct value again. Can you figure out what the best \(\alpha\) is ahead of time? The magic eight ball says no. At this point in time the best way to find the hyperparameters for machine learning is to try them until you find the ones that perform the best.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/nano/introduction-to-neural-networks/logistic-regression/">Logistic Regression</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/nano/introduction-to-neural-networks/logistic-regression/" rel="bookmark"><time class="published dt-published" datetime="2018-10-26T07:44:43-07:00" itemprop="datePublished" title="2018-10-26 07:44">2018-10-26 07:44</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/nano/introduction-to-neural-networks/logistic-regression/#orgb14138d">What is Logistic Regression?</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/logistic-regression/#orgbe87651">The Error Function</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgb14138d">
<h2 id="orgb14138d">What is Logistic Regression?</h2>
<div class="outline-text-2" id="text-orgb14138d">
<p>Logistic Regression is a classification algorithm that estimates the probability of a classification given an input. It is one of the foundations of deep learning.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgbe87651">
<h2 id="orgbe87651">The Error Function</h2>
<div class="outline-text-2" id="text-orgbe87651">
<p>\[ error = -\frac{1}{m} \sum^m_{i=1} (1-y)\ln(1-\hat{y}) + y \ln \hat{y} \]</p>
<p>To build our model we add weights (W) and a bias term (b) to the error function \(E(W,b)\).</p>
<p>\[ E(W,b) = -\frac{1}{m} \sum^m_{i=1} (1-y_i)\ln(1-\sigma(Wx^{(i)}) + b) + y_i \ln(\sigma(Wx^{(i)} + b)) \]</p>
<p>This is the function for the binary case, but you can generalize it to more cases using this function.</p>
<p>\[ E(W, b) = -\frac{1}{m} \sum^m_{i=1} \sum^n_{j=1} y_{ij} \ln(\hat{y_{ij}}) \]</p>
<p>The goal is to minimize this function to get the best model.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/nano/introduction-to-neural-networks/multi-class-cross-entropy/">Multi-Class Cross Entropy</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/nano/introduction-to-neural-networks/multi-class-cross-entropy/" rel="bookmark"><time class="published dt-published" datetime="2018-10-25T21:24:59-07:00" itemprop="datePublished" title="2018-10-25 21:24">2018-10-25 21:24</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/nano/introduction-to-neural-networks/multi-class-cross-entropy/#orgb20916e">Our Probabilities</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/multi-class-cross-entropy/#org544d59b">So, what does this mean?</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgb20916e">
<h2 id="orgb20916e">Our Probabilities</h2>
<div class="outline-text-2" id="text-orgb20916e">
<p>Weh have three doors behind which could be one of three animals. These are the probabilities that if you open a door, you will find a particular animal behind it.</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Animal</th>
<th class="org-left" scope="col">Door 1</th>
<th class="org-left" scope="col">Door 2</th>
<th class="org-left" scope="col">Door 3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Duck</td>
<td class="org-left">\(P_{11}\)</td>
<td class="org-left">\(P_{12}\)</td>
<td class="org-left">\(P_{13}\)</td>
</tr>
<tr>
<td class="org-left">Beaver</td>
<td class="org-left">\(P_{21}\)</td>
<td class="org-left">\(P_{22}\)</td>
<td class="org-left">\(P_{23}\)</td>
</tr>
<tr>
<td class="org-left">Walrus</td>
<td class="org-left">\(P_{31}\)</td>
<td class="org-left">\(P_{32}\)</td>
<td class="org-left">\(P_{33}\)</td>
</tr>
</tbody>
</table>
<p>\[ \textit{Cross Entropy} = - \sum^n_{i=1} \sum^m_{j=1} y_{ij} \ln (p_{ij}) \]</p>
</div>
</div>
<div class="outline-2" id="outline-container-org544d59b">
<h2 id="org544d59b">So, what does this mean?</h2>
<div class="outline-text-2" id="text-org544d59b">
<p>Cross Entropy is inversely proportional to the the total probability of an outcome - so the higher the cross entropy you calculate, the less likely it is that the outcome you are looking at will happen.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/grokking/03_forward_propagation/okay-but-what-about-this-deep-learning-stuff/">Okay, but what about this deep-learning stuff?</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/grokking/03_forward_propagation/okay-but-what-about-this-deep-learning-stuff/" rel="bookmark"><time class="published dt-published" datetime="2018-10-24T13:26:12-07:00" itemprop="datePublished" title="2018-10-24 13:26">2018-10-24 13:26</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/grokking/03_forward_propagation/okay-but-what-about-this-deep-learning-stuff/#orgdebfc84">Imports</a></li>
<li><a href="/posts/grokking/03_forward_propagation/okay-but-what-about-this-deep-learning-stuff/#org73a0e34">Typing</a></li>
<li><a href="/posts/grokking/03_forward_propagation/okay-but-what-about-this-deep-learning-stuff/#org0b4a760">What is this about?</a></li>
<li><a href="/posts/grokking/03_forward_propagation/okay-but-what-about-this-deep-learning-stuff/#org15292f4">Okay, so how do you implement that?</a></li>
<li><a href="/posts/grokking/03_forward_propagation/okay-but-what-about-this-deep-learning-stuff/#orge068310">Let's try it out</a></li>
<li><a href="/posts/grokking/03_forward_propagation/okay-but-what-about-this-deep-learning-stuff/#orgbd4fc48">Okay, but can we do that with numpy?</a></li>
<li><a href="/posts/grokking/03_forward_propagation/okay-but-what-about-this-deep-learning-stuff/#org525a713">Okay, so what was this about again?</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgdebfc84">
<h2 id="orgdebfc84">Imports</h2>
<div class="outline-text-2" id="text-orgdebfc84"></div>
<div class="outline-3" id="outline-container-org87227df">
<h3 id="org87227df">From Python</h3>
<div class="outline-text-3" id="text-org87227df">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orge44bac9">
<h3 id="orge44bac9">From Pypi</h3>
<div class="outline-text-3" id="text-orge44bac9">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">graphviz</span> <span class="kn">import</span> <span class="n">Digraph</span>
<span class="kn">import</span> <span class="nn">numpy</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org73a0e34">
<h2 id="org73a0e34">Typing</h2>
<div class="outline-text-2" id="text-org73a0e34">
<p>This is to develop some type hinting.</p>
<div class="highlight">
<pre><span></span><span class="n">Vector</span> <span class="o">=</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
<span class="n">Matrix</span> <span class="o">=</span> <span class="n">List</span><span class="p">[</span><span class="n">Vector</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org0b4a760">
<h2 id="org0b4a760">What is this about?</h2>
<div class="outline-text-2" id="text-org0b4a760">
<p>I previously looked at a model with multiple inputs and outputs to predict whether a team would win or lose and how the fans would feel in response to the outcome. Now I'm going to stack the network on top of another one to 'deepen' the network.</p>
<div class="highlight">
<pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">Digraph</span><span class="p">(</span><span class="n">comment</span><span class="o">=</span><span class="s2">"Hidden Layers"</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">"png"</span><span class="p">)</span>
<span class="c1"># input layer</span>
<span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"Toes"</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">"B"</span><span class="p">,</span> <span class="s2">"Wins"</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">"C"</span><span class="p">,</span> <span class="s2">"Fans"</span><span class="p">)</span>

<span class="c1"># Hidden Layer</span>
<span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">"D"</span><span class="p">,</span> <span class="s2">"H1"</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">"E"</span><span class="p">,</span> <span class="s2">"H2"</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">"F"</span><span class="p">,</span> <span class="s2">"H3"</span><span class="p">)</span>

<span class="c1"># Output Layer</span>
<span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">"G"</span><span class="p">,</span> <span class="s2">"Hurt"</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">"H"</span><span class="p">,</span> <span class="s2">"Win"</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">"I"</span><span class="p">,</span> <span class="s2">"Sad"</span><span class="p">)</span>

<span class="c1"># Input to hidden edges</span>
<span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">([</span><span class="s2">"AD"</span><span class="p">,</span> <span class="s2">"AE"</span><span class="p">,</span> <span class="s2">"AF"</span><span class="p">,</span>
             <span class="s2">"BD"</span><span class="p">,</span> <span class="s2">"BE"</span><span class="p">,</span> <span class="s2">"BF"</span><span class="p">,</span>
             <span class="s2">"CD"</span><span class="p">,</span> <span class="s2">"CE"</span><span class="p">,</span> <span class="s2">"CF"</span><span class="p">,</span>
<span class="p">])</span>

<span class="c1"># Hidden to output egdes</span>
<span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">([</span><span class="s2">"DG"</span><span class="p">,</span> <span class="s2">"DH"</span><span class="p">,</span> <span class="s2">"DI"</span><span class="p">,</span>
             <span class="s2">"EG"</span><span class="p">,</span> <span class="s2">"EH"</span><span class="p">,</span> <span class="s2">"EI"</span><span class="p">,</span>
             <span class="s2">"FG"</span><span class="p">,</span> <span class="s2">"FH"</span><span class="p">,</span> <span class="s2">"FI"</span><span class="p">,</span>
<span class="p">])</span>
<span class="n">graph</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">"graphs/hidden_layer.dot"</span><span class="p">)</span>
<span class="n">graph</span>
</pre></div>
<div class="figure">
<p><img alt="hidden_layer.dot.png" src="/posts/grokking/03_forward_propagation/okay-but-what-about-this-deep-learning-stuff/hidden_layer.dot.png"></p>
</div>
<p>These networks between the input and output layers are called <i>hidden layers</i>.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org15292f4">
<h2 id="org15292f4">Okay, so how do you implement that?</h2>
<div class="outline-text-2" id="text-org15292f4">
<p>It works like our previous model except that you insert an extra vector-matrix-multiplication call between the inputs and outputs. For this example I'm going to do it as a class so that I can check the hidden layer's values more easily, but otherwise you would do it using matrices and vectors.</p>
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">HiddenLayer</span><span class="p">:</span>
    <span class="sd">"""Implements a neural network with one hidden layer</span>

<span class="sd">    Args:</span>
<span class="sd">     inputs: vector of input values</span>
<span class="sd">     input_to_hidden_weights: vector of weights for the first layer</span>
<span class="sd">     hidden_to_output_weights: vector of weights of the second layer</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">input_to_hidden_weights</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span>
                 <span class="n">hidden_to_output_weights</span><span class="p">:</span> <span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_to_hidden_weights</span> <span class="o">=</span> <span class="n">input_to_hidden_weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_to_output_weights</span> <span class="o">=</span> <span class="n">hidden_to_output_weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hidden_output</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hidden_output</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector</span><span class="p">:</span>
        <span class="sd">"""the output of the hidden layer"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hidden_output</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hidden_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_matrix_multiplication</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input_to_hidden_weights</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hidden_output</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector</span><span class="p">:</span>
        <span class="sd">"""Predictions for the inputs"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_matrix_multiplication</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hidden_output</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hidden_to_output_weights</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span>

    <span class="k">def</span> <span class="nf">vector_matrix_multiplication</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span>
                                     <span class="n">matrix</span><span class="p">:</span> <span class="n">Matrix</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vector</span><span class="p">:</span>
        <span class="sd">"""calculates the dot-product for each row of the matrix</span>

<span class="sd">       Args:</span>
<span class="sd">        vector: input with one cell for each row in the matrix</span>
<span class="sd">        matrix: input with rows of the same length as the vector</span>

<span class="sd">       Returns:</span>
<span class="sd">        vector: dot-products for the vector and matrix rows</span>
<span class="sd">       """</span>
        <span class="n">vector_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">vector_length</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">matrix</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dot_product</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">matrix</span><span class="p">[</span><span class="n">row</span><span class="p">])</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">dot_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_1</span><span class="p">:</span><span class="n">Vector</span><span class="p">,</span> <span class="n">vector_2</span><span class="p">:</span><span class="n">Vector</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">"""Calculate the dot-product of the two vectors</span>

<span class="sd">       Returns:</span>
<span class="sd">        dot-product: the dot product of the two vectors</span>
<span class="sd">       """</span>
        <span class="n">vector_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vector_1</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">vector_length</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">vector_2</span><span class="p">)</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">vector_length</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="n">vector_1</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">*</span> <span class="n">vector_2</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-orge068310">
<h2 id="orge068310">Let's try it out</h2>
<div class="outline-text-2" id="text-orge068310"></div>
<div class="outline-3" id="outline-container-orge11bc18">
<h3 id="orge11bc18">The Input Layer To Hidden Layer Weights</h3>
<div class="outline-text-3" id="text-orge11bc18">
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Toes</th>
<th class="org-right" scope="col">Wins</th>
<th class="org-right" scope="col">Fans</th>
<th class="org-left" scope="col">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0.1</td>
<td class="org-right">0.2</td>
<td class="org-right">-0.1</td>
<td class="org-left">h<sub>0</sub></td>
</tr>
<tr>
<td class="org-right">-0.1</td>
<td class="org-right">0.1</td>
<td class="org-right">0.9</td>
<td class="org-left">h<sub>1</sub></td>
</tr>
<tr>
<td class="org-right">0.1</td>
<td class="org-right">0.4</td>
<td class="org-right">0.1</td>
<td class="org-left">h<sub>2</sub></td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">input_to_hidden_weights</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">],</span>
                           <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span>
                           <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org1954dec">
<h3 id="org1954dec">The Weights From the Hidden Layer to the Outputs</h3>
<div class="outline-text-3" id="text-org1954dec">
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">h0</th>
<th class="org-right" scope="col">h1</th>
<th class="org-right" scope="col">h2</th>
<th class="org-left" scope="col">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0.3</td>
<td class="org-right">1.1</td>
<td class="org-right">-0.3</td>
<td class="org-left">hurt</td>
</tr>
<tr>
<td class="org-right">0.1</td>
<td class="org-right">0.2</td>
<td class="org-right">0.0</td>
<td class="org-left">won</td>
</tr>
<tr>
<td class="org-right">0.0</td>
<td class="org-right">1.3</td>
<td class="org-right">0.1</td>
<td class="org-left">sad</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">hidden_layer_to_output_weights</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">],</span>
                                  <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                                  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orge2a56a2">
<h3 id="orge2a56a2">Testing it Out</h3>
<div class="outline-text-3" id="text-orge2a56a2">
<div class="highlight">
<pre><span></span><span class="n">toes</span> <span class="o">=</span> <span class="p">[</span><span class="mf">8.5</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">,</span> <span class="mf">9.9</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">]</span>
<span class="n">wins</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>
<span class="n">fans</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">expected_hiddens</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.86</span><span class="p">,</span> <span class="mf">0.295</span><span class="p">,</span> <span class="mf">1.23</span><span class="p">]</span>
<span class="n">expected_outputs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.214</span><span class="p">,</span> <span class="mf">0.145</span><span class="p">,</span> <span class="mf">0.507</span><span class="p">]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">first_input</span> <span class="o">=</span> <span class="p">[</span><span class="n">toes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">wins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fans</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">network</span> <span class="o">=</span> <span class="n">HiddenLayer</span><span class="p">(</span><span class="n">first_input</span><span class="p">,</span>
                       <span class="n">input_to_hidden_weights</span><span class="p">,</span>
                       <span class="n">hidden_layer_to_output_weights</span><span class="p">)</span>
<span class="n">hidden_outputs</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">hidden_output</span>
<span class="n">expected_actual</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expected_hiddens</span><span class="p">,</span> <span class="n">hidden_outputs</span><span class="p">)</span>
<span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">**</span><span class="mi">5</span>
<span class="n">labels</span> <span class="o">=</span> <span class="s2">"h0 h1 h2"</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"|Node | Expected | Actual"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"|-+-+-|"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">expected_actual</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"|{} | {}| {:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">expected</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Node</th>
<th class="org-right" scope="col">Expected</th>
<th class="org-right" scope="col">Actual</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">h0</td>
<td class="org-right">0.86</td>
<td class="org-right">0.86</td>
</tr>
<tr>
<td class="org-left">h1</td>
<td class="org-right">0.295</td>
<td class="org-right">0.29</td>
</tr>
<tr>
<td class="org-left">h2</td>
<td class="org-right">1.23</td>
<td class="org-right">1.23</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">outputs</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">predictions</span>
<span class="n">expected_actual</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expected_outputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>
<span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">**</span><span class="mi">3</span>
<span class="n">labels</span> <span class="o">=</span> <span class="s2">"Hurt Won Sad"</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"|Node | Expected | Actual"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"|-+-+-|"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">expected_actual</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"|{} | {}| {:.3f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">expected</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Node</th>
<th class="org-right" scope="col">Expected</th>
<th class="org-right" scope="col">Actual</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Hurt</td>
<td class="org-right">0.214</td>
<td class="org-right">0.214</td>
</tr>
<tr>
<td class="org-left">Won</td>
<td class="org-right">0.145</td>
<td class="org-right">0.145</td>
</tr>
<tr>
<td class="org-left">Sad</td>
<td class="org-right">0.507</td>
<td class="org-right">0.506</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgbd4fc48">
<h2 id="orgbd4fc48">Okay, but can we do that with numpy?</h2>
<div class="outline-text-2" id="text-orgbd4fc48">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">one_hidden_layer</span><span class="p">(</span><span class="n">inputs</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="n">Matrix</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">"""Converts arguments to numpy and calculates predictions</span>

<span class="sd">    Args:</span>
<span class="sd">     inputs: array of inputs</span>
<span class="sd">     weights: matrix with two rows of weights</span>

<span class="sd">    Returns:</span>
<span class="sd">     predictions: predicted values for each output node</span>
<span class="sd">    """</span>
    <span class="n">inputs</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">inputs</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">hidden</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hidden</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
<p>One thing to watch out for here is that the dot product won't raise an error if you don't transpose the weights, but you will get the wrong values.</p>
<div class="highlight">
<pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">input_to_hidden_weights</span><span class="p">,</span>
           <span class="n">hidden_layer_to_output_weights</span><span class="p">]</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">one_hidden_layer</span><span class="p">(</span><span class="n">first_input</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
<span class="n">expected_actual</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expected_outputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>
<span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">**</span><span class="mi">3</span>
<span class="n">labels</span> <span class="o">=</span> <span class="s2">"Hurt Won Sad"</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"|Node | Expected | Actual"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"|-+-+-|"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">expected_actual</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"|{} | {}| {:.3f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">expected</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Node</th>
<th class="org-right" scope="col">Expected</th>
<th class="org-right" scope="col">Actual</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Hurt</td>
<td class="org-right">0.214</td>
<td class="org-right">0.214</td>
</tr>
<tr>
<td class="org-left">Won</td>
<td class="org-right">0.145</td>
<td class="org-right">0.145</td>
</tr>
<tr>
<td class="org-left">Sad</td>
<td class="org-right">0.507</td>
<td class="org-right">0.506</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-2" id="outline-container-org525a713">
<h2 id="org525a713">Okay, so what was this about again?</h2>
<div class="outline-text-2" id="text-org525a713">
<p>This showed that you can stack networks up and have the outputs of one layer feed into the next until you reach the output layer. This is called <i>Forward Propagation</i>. Although I mentioned deep-learning in the title this really isn't an example yet, it's more like a multilayer perceptron, but it's deeper than two-layers, anyway.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/nano/introduction-to-neural-networks/maximum-likelihood/">Maximum Likelihood</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/nano/introduction-to-neural-networks/maximum-likelihood/" rel="bookmark"><time class="published dt-published" datetime="2018-10-23T21:29:52-07:00" itemprop="datePublished" title="2018-10-23 21:29">2018-10-23 21:29</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/nano/introduction-to-neural-networks/maximum-likelihood/#org97119ca">What is this about?</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/maximum-likelihood/#org556160b">Yeah, okay, but how do you do this?</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/maximum-likelihood/#org064b3d5">The Problem With Products</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/maximum-likelihood/#orgae10090">Cross Entropy</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/maximum-likelihood/#org567cabb">Okay, but how do we implement this?</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org97119ca">
<h2 id="org97119ca">What is this about?</h2>
<div class="outline-text-2" id="text-org97119ca">
<p>We want a way to train our neural network based on the data we have - how do we do this? One way is to use <a href="https://en.wikipedia.org/wiki/Maximum_likelihood_estimation">maximum likelihood</a> where we give weights based on the past occurrences for each score.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org556160b">
<h2 id="org556160b">Yeah, okay, but how do you do this?</h2>
<div class="outline-text-2" id="text-org556160b">
<p>First, remember that our probability for any point being 0 or 1 is based on the sigmoid.</p>
<p>\[ \hat{y} = \sigma(Wx+b) \]</p>
<p>Where \(\hat{y}\) is the probability that a point is non-negative.</p>
<p>So we can take the product of the sigmoid of all the points in our data set and find the probability that any point is a 1. If we were to find a model that maximized this probability, we would have a model that separated our categories - this is the Maximum Likelihood Model.</p>
<p>To be more specific, we calculate \(\hat{y}\) for all of our training set points and multiply them to get the total probability (multiplication is an AND operation - \(p(a) \land p(b) \land p(c) = p(a) \times p(b) \time p(c)\)) then we adjust our moder to maximize this probability.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org064b3d5">
<h2 id="org064b3d5">The Problem With Products</h2>
<div class="outline-text-2" id="text-org064b3d5">
<p>Each of our probablilities is less than 1, so the more of them you have, the smaller their product will become. What we want to do is use addition - which is where the logarithm comes in.</p>
<p>\[ p(a) * p(b) * p(c) = \log(a) + \log p(b) + \log p(4) \]</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgae10090">
<h2 id="orgae10090">Cross Entropy</h2>
<div class="outline-text-2" id="text-orgae10090">
<p>Our logarithms give us the values that we want to maximize, but another way to look at is as "we want to minimize the error". We can do this by using the negatives of the logarithms to find the error and trying to minimize their sums.</p>
<p>\[ \textit{cross entropy} = -\log p(a) - \log p(b) - \log p(4) \]</p>
<p>More generally:</p>
<p>\[ \textit{Cross Entropy} = -\sum_{i=1}^m y_i \ln(p_i) + (1 - y_i)\ln(1-p_i) \]</p>
<p>Where <i>y</i> is vector of 1's and 0's. When <i>y</i> is 0, the left term is 0 and when <i>y</i> is 1 the right term is 0 so it works as sort of a conditional to choose which term to use.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org567cabb">
<h2 id="org567cabb">Okay, but how do we implement this?</h2>
<div class="outline-text-2" id="text-org567cabb">
<p>Write a function that takes as input two lists Y, P, and returns the float corresponding to their cross-entropy.</p>
<div class="highlight">
<pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">cross_entropy</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
    <span class="sd">"""calculates the cross entropy of two lists</span>

<span class="sd">    Args:</span>
<span class="sd">     Y: lists of 1s and 0s</span>
<span class="sd">     P: lists of probabilities that Y is 1</span>
<span class="sd">    Returns:</span>
<span class="sd">     cross-entropy: the cross entropy of the two lists</span>
<span class="sd">    """</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
    <span class="n">not_Y</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Y</span>    
    <span class="n">P</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    <span class="n">not_P</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">P</span>
    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">Y</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">+</span> <span class="n">not_Y</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">not_P</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">Y</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> 
<span class="n">P</span><span class="o">=</span><span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
<span class="n">expected</span> <span class="o">=</span>  <span class="mf">4.8283137373</span>
<span class="n">entropy</span> <span class="o">=</span> <span class="n">cross_entropy</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">entropy</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">entropy</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="o">**</span><span class="mi">5</span>
</pre></div>
<pre class="example">
4.828313737302301

</pre></div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/nano/introduction-to-neural-networks/one-hot-encoding/">One-Hot Encoding</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/nano/introduction-to-neural-networks/one-hot-encoding/" rel="bookmark"><time class="published dt-published" datetime="2018-10-23T21:16:36-07:00" itemprop="datePublished" title="2018-10-23 21:16">2018-10-23 21:16</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/nano/introduction-to-neural-networks/one-hot-encoding/#orgd84e98b">The Problem</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/one-hot-encoding/#org9dc6dad">One Solution</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgd84e98b">
<h2 id="orgd84e98b">The Problem</h2>
<div class="outline-text-2" id="text-orgd84e98b">
<p>We are dealing with categories - Duck, Beaver, and Walrus - but our classifier works with numbers, what do we do?</p>
</div>
</div>
<div class="outline-2" id="outline-container-org9dc6dad">
<h2 id="org9dc6dad">One Solution</h2>
<div class="outline-text-2" id="text-org9dc6dad">
<p><a href="https://en.wikipedia.org/wiki/One-hot">one-hot encoding</a>, in this context, means taking each of our classifications and creating a column for it and putting a 1 in the row if it matches the column and a 0 otherwise.</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Sighting</th>
<th class="org-right" scope="col">Duck</th>
<th class="org-right" scope="col">Beaver</th>
<th class="org-right" scope="col">Walrus</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="/posts/nano/introduction-to-neural-networks/softmax/">Softmax</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">Cloistered Monkey</span></p>
<p class="dateline"><a href="/posts/nano/introduction-to-neural-networks/softmax/" rel="bookmark"><time class="published dt-published" datetime="2018-10-23T07:44:24-07:00" itemprop="datePublished" title="2018-10-23 07:44">2018-10-23 07:44</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="/posts/nano/introduction-to-neural-networks/softmax/#orgbe98765">What is the Softmax Function?</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/softmax/#org597199b">A classification problem</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/softmax/#orgdd3cc4f">The Exponential</a></li>
<li><a href="/posts/nano/introduction-to-neural-networks/softmax/#orgaf08347">Implementation</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgbe98765">
<h2 id="orgbe98765">What is the Softmax Function?</h2>
<div class="outline-text-2" id="text-orgbe98765">
<p>With the stepwise and logistic function you are limited to binary classifications. The <a href="https://en.wikipedia.org/wiki/Softmax_function">softmax</a> function is a generalization of the logistic (sigmoid) function that lets you choose between multiple categories.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org597199b">
<h2 id="org597199b">A classification problem</h2>
<div class="outline-text-2" id="text-org597199b"></div>
<div class="outline-3" id="outline-container-org2e21880">
<h3 id="org2e21880">What animal did you see?</h3>
<div class="outline-text-3" id="text-org2e21880">
<p>We have three animals and the probabilities that the animal you saw are the following:</p>
<ul class="org-ul">
<li>P(duck) = 0.67</li>
<li>P(beaver) = 0.24</li>
<li>P(walrus) = 0.09</li>
</ul>
<p>We count the occurrence of animals we see and get these counts.</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Animal</th>
<th class="org-right" scope="col">Count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Duck</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">Beaver</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">Walrus</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>
<p>So, how do you convert these scores into probabilities?</p>
</div>
</div>
<div class="outline-3" id="outline-container-org675a90d">
<h3 id="org675a90d">Standardize</h3>
<div class="outline-text-3" id="text-org675a90d">
<p>One way to convert the counts to probabilities is by dividing each count by the total.</p>
<p>\[ P = \frac{count}{\textit{total count}} \]</p>
<p>The problem with this is we might not be dealing with counts and so we have to deal with negative numbers in which case the sum of the values (total count in this case) could equal zero. We need to use a function that will turn any value we have (even if it isn't a count) into a positive number.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org0a06596">
<h3 id="org0a06596">Which function would turn every number into a positive number?</h3>
<div class="outline-text-3" id="text-org0a06596">
<ul class="org-ul">
<li class="off"><code>[&nbsp;]</code> sin</li>
<li class="off"><code>[&nbsp;]</code> cos</li>
<li class="off"><code>[&nbsp;]</code> log</li>
<li class="on"><code>[X]</code> exp</li>
</ul>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgdd3cc4f">
<h2 id="orgdd3cc4f">The Exponential</h2>
<div class="outline-text-2" id="text-orgdd3cc4f">
<p>It turns out that if you take the numbers and use them as the power of <i>e</i>, your values will always be positive, so to normalize our values, instead of taking the count divided by the sum of the counts, we would take the exponential of our count divided by the sum of the exponentials of all the counts.</p>
<p>\[ P(duck) = \frac{e^2}{e^2 + e^1 + e^0}\\ = 0.67 \]</p>
<p>This is the <i>softmax</i> function.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgaf08347">
<h2 id="orgaf08347">Implementation</h2>
<div class="outline-text-2" id="text-orgaf08347"></div>
<div class="outline-3" id="outline-container-orgf3447ba">
<h3 id="orgf3447ba">Imports</h3>
<div class="outline-text-3" id="text-orgf3447ba">
<div class="highlight">
<pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
</pre></div>
<p>Write a function that takes as input a list of numbers, and returns the list of values given by the softmax function. This uses <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.exp.html">numpy.exp</a> to approximate <a href="https://en.wikipedia.org/wiki/E_(mathematical_constant)">e</a>.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">softmax</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
    <span class="sd">"""calculates the softmax probmabilities</span>

<span class="sd">    Args:</span>
<span class="sd">     L: List of values</span>

<span class="sd">    Returns:</span>
<span class="sd">     softmax: the softmax probabilities for the values</span>
<span class="sd">    """</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span><span class="o">/</span><span class="n">values</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">expected_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.67</span><span class="p">,</span> <span class="mf">0.24</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">]</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">softmax</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">**</span><span class="mi">2</span>
<span class="n">expected_actual</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expected_values</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">expected_actual</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">"{:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">actual</span> <span class="o">-</span> <span class="n">expected</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tolerance</span><span class="p">,</span>\
        <span class="s2">"Expected: {} Actual: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
</pre></div>
<pre class="example">
0.67
0.24
0.09

</pre></div>
</div>
</div>
</div>
</article>
</div>
<ul class="pager postindexpager clearfix">
<li class="previous"><a href="/index-3.html" rel="prev">Newer posts</a></li>
<li class="next"><a href="/index-1.html" rel="next">Older posts</a></li>
</ul>
<!--End of body content-->
<footer id="footer">Contents  2019 <a href="mailto:necromuralist@protonmail.com">Cloistered Monkey</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></footer>
</div>
</div>
<script src="/assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script> 
</body>
</html>
