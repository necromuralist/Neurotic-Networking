<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Neurotic Networking (Posts about Testing)</title><link>https://necromuralist.github.io/Neurotic-Networking/</link><description></description><atom:link href="https://necromuralist.github.io/Neurotic-Networking/categories/cat_testing.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents © 2023 &lt;a href="mailto:cloisteredmonkey.jmark@slmail.me"&gt;Cloistered Monkey&lt;/a&gt; 
&lt;div id="license"xmlns:cc="http://creativecommons.org/ns#" &gt;This work is licensed under
&lt;a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;"&gt;CC BY 4.0
&lt;img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"&gt;
&lt;img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"&gt;&lt;/a&gt;
&lt;/div&gt;
</copyright><lastBuildDate>Mon, 03 Jul 2023 02:12:17 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Setting up pytest</title><link>https://necromuralist.github.io/Neurotic-Networking/posts/setting-up-pytest/index.html</link><dc:creator>Cloistered Monkey</dc:creator><description>&lt;div id="table-of-contents" role="doc-toc"&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id="text-table-of-contents" role="doc-toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/setting-up-pytest/index.html#org9990ca7"&gt;What is this about?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/setting-up-pytest/index.html#org274b896"&gt;Requirements&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/setting-up-pytest/index.html#org3d8dc62"&gt;The Neurotic Repository&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/setting-up-pytest/index.html#org1d25a77"&gt;The Testing Dependencies&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/setting-up-pytest/index.html#orgf86f1fc"&gt;The Configuration File&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/setting-up-pytest/index.html#org9264d4b"&gt;The Regular Testing Run&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/setting-up-pytest/index.html#orgbbb812f"&gt;The Run-Once&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/setting-up-pytest/index.html#org195ed4f"&gt;The PUDB Run&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/setting-up-pytest/index.html#org72c0512"&gt;Links&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org9990ca7" class="outline-2"&gt;
&lt;h2 id="org9990ca7"&gt;What is this about?&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org9990ca7"&gt;
&lt;p&gt;
This is a post to generate and document the &lt;code&gt;pytest.ini&lt;/code&gt; configuration for testing.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org274b896" class="outline-2"&gt;
&lt;h2 id="org274b896"&gt;Requirements&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org274b896"&gt;
&lt;/div&gt;
&lt;div id="outline-container-org3d8dc62" class="outline-3"&gt;
&lt;h3 id="org3d8dc62"&gt;The Neurotic Repository&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org3d8dc62"&gt;
&lt;p&gt;
To make the neurotic code importable you need to install the package (in development mode, since it's (hopefully) always changing) using &lt;a href="https://pip.pypa.io/en/stable/"&gt;pip&lt;/a&gt;.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pip install --editable .
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org1d25a77" class="outline-2"&gt;
&lt;h2 id="org1d25a77"&gt;The Testing Dependencies&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org1d25a77"&gt;
&lt;p&gt;
There are some things that need to be installed to get the code to run (like numpy and nltk) but for the testing this is what's needed.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;expects&lt;/span&gt;
&lt;span class="n"&gt;faker&lt;/span&gt;
&lt;span class="n"&gt;pytest&lt;/span&gt;
&lt;span class="n"&gt;pytest&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;bdd&lt;/span&gt;
&lt;span class="n"&gt;pytest&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mock&lt;/span&gt;
&lt;span class="n"&gt;pytest&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;xdist&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
This list is in a text-file (&lt;code&gt;tests/testing-requriements&lt;/code&gt;) so they can be installed by changing into the &lt;code&gt;tests&lt;/code&gt; folder and running pip.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pip install --requirement testing-requirements
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgf86f1fc" class="outline-2"&gt;
&lt;h2 id="orgf86f1fc"&gt;The Configuration File&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgf86f1fc"&gt;
&lt;p&gt;
Pytest can read in an &lt;a href="https://en.wikipedia.org/wiki/INI_file?useskin=vector"&gt;INI&lt;/a&gt; formatted file. It has a bunch of &lt;a href="https://docs.pytest.org/en/7.1.x/reference/reference.html#ini-options-ref"&gt;configuration options&lt;/a&gt; but I haven't really explored them much. I mostly use it to set the command line arguments that I would otherwise pass in.
&lt;/p&gt;
&lt;/div&gt;

&lt;div id="outline-container-org9264d4b" class="outline-3"&gt;
&lt;h3 id="org9264d4b"&gt;The Regular Testing Run&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org9264d4b"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[pytest]&lt;/span&gt;
&lt;span class="na"&gt;addopts&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;--exitfirst --failed-first --color yes --gherkin-terminal-reporter&lt;/span&gt;
&lt;span class="w"&gt;	  &lt;/span&gt;&lt;span class="na"&gt;--looponfail --numprocesses auto&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
I didn't realize it before, but as &lt;a href="https://stackoverflow.com/a/11401142"&gt;this stackoverflow answer&lt;/a&gt; mentions, you can break up long line in INI files (assuming that the code is using python's ConfigParser) by indenting the continuation lines (although it appears, unfortunately, to break &lt;a href="https://pygments.org/"&gt;pygments'&lt;/a&gt; syntax highlighting).
&lt;/p&gt;

&lt;p&gt;
Here's a breakdown of the options.
&lt;/p&gt;

&lt;ul class="org-ul"&gt;
&lt;li&gt;&lt;code&gt;exitfirst&lt;/code&gt;: stop testing after the first failed test&lt;/li&gt;
&lt;li&gt;&lt;code&gt;failed-first&lt;/code&gt;: when re-starting the tests, start with the test that failed&lt;/li&gt;
&lt;li&gt;&lt;code&gt;color yes&lt;/code&gt;: Add some highlight-coloring to the pytest output&lt;/li&gt;
&lt;li&gt;&lt;code&gt;gherkin-terminal-reporter&lt;/code&gt;: Format the output using pytest-bdd&lt;/li&gt;
&lt;li&gt;&lt;code&gt;looponfail&lt;/code&gt;: re-run the testing if a file changes&lt;/li&gt;
&lt;li&gt;&lt;code&gt;numprocesses auto&lt;/code&gt;: Run the tests in parallel across all available cores.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
The &lt;code&gt;numprocesses&lt;/code&gt; option can alternatively take &lt;code&gt;logical&lt;/code&gt; as an argument, meaning use all logical CPUs, not physical cores (this requires you install &lt;code&gt;pytest-xdist[psutil]&lt;/code&gt;) or the actual number of processes you want to run in parallel.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgbbb812f" class="outline-3"&gt;
&lt;h3 id="orgbbb812f"&gt;The Run-Once&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-orgbbb812f"&gt;
&lt;p&gt;
This removes the automatic re-running of tests. I don't really use this, but sometimes it can be helpful, especially when using something like Selenium that slows everything down a lot, to not re-run the test every time you save a file.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# addopts = --exitfirst --failed-first --color yes --gherkin-terminal-reporter --numprocesses auto&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org195ed4f" class="outline-3"&gt;
&lt;h3 id="org195ed4f"&gt;The PUDB Run&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org195ed4f"&gt;
&lt;p&gt;
&lt;code&gt;pytest&lt;/code&gt; will grab standard out by default, making it impossible to run an interactive debugger. They have support for python's &lt;a href="https://docs.python.org/3/library/pdb.html"&gt;pdb&lt;/a&gt; debugger, but I use &lt;a href="https://documen.tician.de/pudb/"&gt;pudb&lt;/a&gt; instead, so this set of arguments turns off the capturing of standard out which will let you run the tests with PUDB. There is &lt;a href="https://github.com/wronglink/pytest-pudb"&gt;a project&lt;/a&gt; that integrates &lt;code&gt;pudb&lt;/code&gt; into pytest, but it appears to have died out, so I'll just stick to my old way of doing it.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# addopts = --exitfirst --failed-first --color yes --gherkin-terminal-reporter --capture=no&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org72c0512" class="outline-2"&gt;
&lt;h2 id="org72c0512"&gt;Links&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org72c0512"&gt;
&lt;ul class="org-ul"&gt;
&lt;li&gt;Faker 18.11.2 documentation [Internet]. [cited 2023 Jul 2]. Available from: &lt;a href="https://faker.readthedocs.io/en/master/index.html"&gt;https://faker.readthedocs.io/en/master/index.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;INI file. In: Wikipedia [Internet]. 2023 [cited 2023 Jul 2]. Available from: &lt;a href="https://en.wikipedia.org/w/index.php?title=INI_file&amp;amp;oldid=1153411356"&gt;https://en.wikipedia.org/w/index.php?title=INI_file&amp;amp;oldid=1153411356&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Pytest-BDD 6.1.1 documentation [Internet]. [cited 2023 Jul 2]. Available from: &lt;a href="https://pytest-bdd.readthedocs.io/en/latest/#bdd-library-for-the-pytest-runner"&gt;https://pytest-bdd.readthedocs.io/en/latest/#bdd-library-for-the-pytest-runner&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;pip documentation v23.1.2 [Internet]. [cited 2023 Jul 2]. Available from: &lt;a href="https://pip.pypa.io/en/stable/"&gt;https://pip.pypa.io/en/stable/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;pudb 2022.1.3 documentation [Internet]. [cited 2023 Jul 2]. Available from: &lt;a href="https://documen.tician.de/pudb/"&gt;https://documen.tician.de/pudb/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;pytest-mock documentation [Internet]. [cited 2023 Jul 2]. Available from: &lt;a href="https://pytest-mock.readthedocs.io/en/latest/"&gt;https://pytest-mock.readthedocs.io/en/latest/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;pytest-xdist — pytest-xdist documentation [Internet]. [cited 2023 Jul 2]. Available from: &lt;a href="https://pytest-xdist.readthedocs.io/en/stable/"&gt;https://pytest-xdist.readthedocs.io/en/stable/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;</description><category>pytest</category><category>testing</category><guid>https://necromuralist.github.io/Neurotic-Networking/posts/setting-up-pytest/index.html</guid><pubDate>Sun, 02 Jul 2023 22:28:13 GMT</pubDate></item></channel></rss>