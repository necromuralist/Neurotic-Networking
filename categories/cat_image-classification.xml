<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Neurotic Networking (Posts about Image Classification)</title><link>https://necromuralist.github.io/Neurotic-Networking/</link><description></description><atom:link href="https://necromuralist.github.io/Neurotic-Networking/categories/cat_image-classification.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents Â© 2023 &lt;a href="mailto:cloisteredmonkey.jmark@slmail.me"&gt;Cloistered Monkey&lt;/a&gt; 
&lt;div id="license"xmlns:cc="http://creativecommons.org/ns#" &gt;This work is licensed under
&lt;a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;"&gt;CC BY 4.0
&lt;img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"&gt;
&lt;img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"&gt;&lt;/a&gt;
&lt;/div&gt;
</copyright><lastBuildDate>Mon, 26 Jun 2023 20:42:37 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>FastAI Cats and Dogs</title><link>https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/index.html</link><dc:creator>Cloistered Monkey</dc:creator><description>&lt;div id="table-of-contents" role="doc-toc"&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id="text-table-of-contents" role="doc-toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/index.html#org0d07fd6"&gt;What Is This?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/index.html#org732e82a"&gt;Importing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/index.html#org9b2693e"&gt;Setting Up&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/index.html#org8f97618"&gt;Train It&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/index.html#org0c483bb"&gt;Some Test Images&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/index.html#orgeae752d"&gt;A Cat&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/index.html#orgcdc6054"&gt;A Negative Test Image&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/index.html#orgb02076a"&gt;A Strange Cat&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/index.html#orgbc002ac"&gt;The End&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/index.html#orgda8bee9"&gt;Sources&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/index.html#org5e7bddb"&gt;Fast AI&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/index.html#org85d0868"&gt;Test Images (Wikimedia commons)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org0d07fd6" class="outline-2"&gt;
&lt;h2 id="org0d07fd6"&gt;What Is This?&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org0d07fd6"&gt;
&lt;p&gt;
This is a run-through of the fastai &lt;a href="https://docs.fast.ai/quick_start.html#computer-vision-classification"&gt;Computer Vision Quickstart&lt;/a&gt; that shows how to build an image classification model from a public dataset hosted on fastai's site. It is similar to the post on &lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-lesson-0-is-it-a-bird/"&gt;classifying rabbits and pigs&lt;/a&gt; except in the other post we create our own dataset by searching duckduckgo for images.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org732e82a" class="outline-2"&gt;
&lt;h2 id="org732e82a"&gt;Importing&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org732e82a"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# python standard library&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pathlib&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Path&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
As noted on &lt;a href="https://stackoverflow.com/questions/65128126/fast-ai-attributeerror-learner-object-has-no-attribute-fine-tune"&gt;Stack Overflow&lt;/a&gt;, FastAI does a lot of monkey patching, so if you just import something from where it's defined (to make it clearer where things are coming from) it might not have the methods or attributes you expect. In this case, for instance, the &lt;code&gt;vision_learner&lt;/code&gt; function is defined in &lt;code&gt;fastai.vision.learner&lt;/code&gt; but if you try and import it from there the object you get back won't have the &lt;code&gt;to_fp16&lt;/code&gt; method that we're going to use so you have to import it from &lt;code&gt;fastai.vision.all&lt;/code&gt; instead. Since there's no good way to avoid using &lt;code&gt;all&lt;/code&gt; I'll import objects from there but I'll try and also point to the original modules where things are defined to make it easier to look things up.
&lt;/p&gt;

&lt;table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"&gt;


&lt;colgroup&gt;
&lt;col class="org-left"&gt;

&lt;col class="org-left"&gt;
&lt;/colgroup&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th scope="col" class="org-left"&gt;Module&lt;/th&gt;
&lt;th scope="col" class="org-left"&gt;Import&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td class="org-left"&gt;fastai.data.external&lt;/td&gt;
&lt;td class="org-left"&gt;untar_data, URLs&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-left"&gt;fastai.data.transforms&lt;/td&gt;
&lt;td class="org-left"&gt;get_image_files&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-left"&gt;fastai.metrics&lt;/td&gt;
&lt;td class="org-left"&gt;error_rate&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-left"&gt;fastai.vision.augment&lt;/td&gt;
&lt;td class="org-left"&gt;Resize&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-left"&gt;fastai.vision.core&lt;/td&gt;
&lt;td class="org-left"&gt;PILImage&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-left"&gt;fastai.vision.data&lt;/td&gt;
&lt;td class="org-left"&gt;ImageDataLoaders&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-left"&gt;fastai.vision.learner&lt;/td&gt;
&lt;td class="org-left"&gt;vision_learner&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-left"&gt;torchvision.models.resnet&lt;/td&gt;
&lt;td class="org-left"&gt;resnet34&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;
&lt;br&gt;
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;fastai.vision.all&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;ImageDataLoaders&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;PILImage&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;Resize&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; 
    &lt;span class="n"&gt;URLs&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;error_rate&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;get_image_files&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;resnet34&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;untar_data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;vision_learner&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org9b2693e" class="outline-2"&gt;
&lt;h2 id="org9b2693e"&gt;Setting Up&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org9b2693e"&gt;
&lt;p&gt;
This downloads the &lt;a href="https://www.robots.ox.ac.uk/~vgg/data/pets/"&gt;Oxford-IIIT Pet Dataset&lt;/a&gt;. Despite the name, there are only cats and dogs in the dataset (37 breeds across the species).
&lt;/p&gt;

&lt;table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"&gt;


&lt;colgroup&gt;
&lt;col class="org-left"&gt;

&lt;col class="org-left"&gt;

&lt;col class="org-left"&gt;
&lt;/colgroup&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th scope="col" class="org-left"&gt;Function/Object&lt;/th&gt;
&lt;th scope="col" class="org-left"&gt;Description&lt;/th&gt;
&lt;th scope="col" class="org-left"&gt;Documentation Link&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td class="org-left"&gt;&lt;code&gt;untar_data&lt;/code&gt;&lt;/td&gt;
&lt;td class="org-left"&gt;Function to download fastai datasets/weights&lt;/td&gt;
&lt;td class="org-left"&gt;&lt;a href="https://docs.fast.ai/data.external.html"&gt;External Data&lt;/a&gt;, &lt;a href="https://docs.fast.ai/data.external.html#untar_data"&gt;function arguments&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-left"&gt;&lt;code&gt;URLs&lt;/code&gt;&lt;/td&gt;
&lt;td class="org-left"&gt;Constants for datasets&lt;/td&gt;
&lt;td class="org-left"&gt;&lt;a href="https://docs.fast.ai/data.external.html#urls"&gt;A &lt;i&gt;brief&lt;/i&gt; description&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


&lt;p&gt;
By default this will download the data to &lt;code&gt;~/.fastai/data&lt;/code&gt; but both &lt;code&gt;untar_data&lt;/code&gt; and &lt;code&gt;URLs&lt;/code&gt; (note the &lt;code&gt;s&lt;/code&gt; at the end is lowercase) take an argument &lt;code&gt;c_key&lt;/code&gt; that allows changing this but I don't know what the difference is between using one or the other.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;untar_data&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;URLs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PETS&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s2"&gt;"images"&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre class="example"&gt;
/home/athena/.fastai/data/oxford-iiit-pet/images
&lt;/pre&gt;


&lt;p&gt;
The names of the files give the breed of the pet (either cat or dog) with dog names all in lower case (e.g. "yorkshire_terrire_9.jpg") and cats with the first initials capitalized (e.g. "Abyssinian_100.jpg"). So our function to categorize the training data will check if the first letter is a capital letter and label it True if it is, False if it isn't, using the following function.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;its_a_cat&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;filename&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;bool&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="sd"&gt;"""Decide if file is a picture of a cat&lt;/span&gt;

&lt;span class="sd"&gt;    Args:&lt;/span&gt;
&lt;span class="sd"&gt;     filename: name of file where first letter is capitalized if it's a cat&lt;/span&gt;

&lt;span class="sd"&gt;    Returns:&lt;/span&gt;
&lt;span class="sd"&gt;     True if first letter is capitalized (so it's a picture of a cat)&lt;/span&gt;
&lt;span class="sd"&gt;    """&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;filename&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;isupper&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;
This next bit creates a batch data loader for us.
&lt;/p&gt;

&lt;table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"&gt;


&lt;colgroup&gt;
&lt;col class="org-left"&gt;

&lt;col class="org-left"&gt;

&lt;col class="org-left"&gt;
&lt;/colgroup&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th scope="col" class="org-left"&gt;Object&lt;/th&gt;
&lt;th scope="col" class="org-left"&gt;Description&lt;/th&gt;
&lt;th scope="col" class="org-left"&gt;Documentation&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td class="org-left"&gt;&lt;code&gt;ImageDataLoaders&lt;/code&gt;&lt;/td&gt;
&lt;td class="org-left"&gt;Data loader with functions for images.&lt;/td&gt;
&lt;td class="org-left"&gt;&lt;a href="https://docs.fast.ai/vision.data.html#imagedataloaders"&gt;ImageDataLoaders&lt;/a&gt;, &lt;a href="https://docs.fast.ai/vision.data.html#imagedataloaders.from_name_func"&gt;from_name_func&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-left"&gt;&lt;code&gt;get_image_files&lt;/code&gt;&lt;/td&gt;
&lt;td class="org-left"&gt;Recursively retrieve images from folders.&lt;/td&gt;
&lt;td class="org-left"&gt;&lt;a href="https://docs.fast.ai/data.transforms.html#get_image_files"&gt;docstring&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-left"&gt;&lt;code&gt;Resize&lt;/code&gt;&lt;/td&gt;
&lt;td class="org-left"&gt;Resize each image (if you pass in one size it uses it for all dimensions).&lt;/td&gt;
&lt;td class="org-left"&gt;&lt;a href="https://docs.fast.ai/vision.augment.html#resize"&gt;docstring&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;
&lt;br&gt;
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;loader&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ImageDataLoaders&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_name_func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;get_image_files&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;valid_pct&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;seed&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;42&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;label_func&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;its_a_cat&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;item_tfms&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;Resize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;224&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
Now we create the model that learns to detect cats.
&lt;/p&gt;

&lt;table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"&gt;


&lt;colgroup&gt;
&lt;col class="org-left"&gt;

&lt;col class="org-left"&gt;

&lt;col class="org-left"&gt;
&lt;/colgroup&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th scope="col" class="org-left"&gt;Object&lt;/th&gt;
&lt;th scope="col" class="org-left"&gt;Description&lt;/th&gt;
&lt;th scope="col" class="org-left"&gt;Documentation&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td class="org-left"&gt;&lt;code&gt;vision_learner&lt;/code&gt;&lt;/td&gt;
&lt;td class="org-left"&gt;Builds a model for transfer learning.&lt;/td&gt;
&lt;td class="org-left"&gt;&lt;a href="https://docs.fast.ai/vision.learner.html#vision_learner"&gt;Arguments&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-left"&gt;&lt;code&gt;resnet34&lt;/code&gt;&lt;/td&gt;
&lt;td class="org-left"&gt;Residual Network model&lt;/td&gt;
&lt;td class="org-left"&gt;&lt;a href="https://pytorch.org/vision/main/models/generated/torchvision.models.resnet34.html"&gt;torchvision documentation&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-left"&gt;&lt;code&gt;error_rate&lt;/code&gt;&lt;/td&gt;
&lt;td class="org-left"&gt;1 - accuracy (the fraction that was incorrect)&lt;/td&gt;
&lt;td class="org-left"&gt;&lt;a href="https://docs.fast.ai/metrics.html#error_rate"&gt;arguments&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-left"&gt;&lt;code&gt;to_fp16&lt;/code&gt;&lt;/td&gt;
&lt;td class="org-left"&gt;Use 16-bit (half-precision) floats&lt;/td&gt;
&lt;td class="org-left"&gt;&lt;a href="https://docs.fast.ai/callback.fp16.html"&gt;Mixed Precision Training Explained&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;
&lt;br&gt;
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;learner&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vision_learner&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;loader&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;resnet34&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;metrics&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;error_rate&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;cat_model&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;learner&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to_fp16&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
Pretty much all of this is inexplicable if you haven't used some kind of neural network library before, but that last call (``to_fp16``) seems especially mysterious. This first part is just about making sure things work, though, so I'll wait until I get to the more detailed explanations to figure it out, although their article &lt;a href="https://docs.fast.ai/callback.fp16.html"&gt;"Mixed Precision Training Explained"&lt;/a&gt; explains it pretty well.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org8f97618" class="outline-2"&gt;
&lt;h2 id="org8f97618"&gt;Train It&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org8f97618"&gt;
&lt;p&gt;
We're using a pre-trained model so we just have to do some transfer learning - freezing the weights of most of the layers and training the last layer to make a cat or not a cat classification.
&lt;/p&gt;

&lt;p&gt;
For some reason fastai assumes that you'll only run it in a jupyter notebook and dumps out a progress bar with no simple way to disable it permanently. As a workaround I'll use the context-manager &lt;code&gt;no_bar&lt;/code&gt; to turn off the progress bar temporarily.
&lt;/p&gt;

&lt;table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"&gt;


&lt;colgroup&gt;
&lt;col class="org-left"&gt;

&lt;col class="org-left"&gt;

&lt;col class="org-left"&gt;
&lt;/colgroup&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th scope="col" class="org-left"&gt;Method&lt;/th&gt;
&lt;th scope="col" class="org-left"&gt;Description&lt;/th&gt;
&lt;th scope="col" class="org-left"&gt;Documentation&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td class="org-left"&gt;&lt;code&gt;fine_tune&lt;/code&gt;&lt;/td&gt;
&lt;td class="org-left"&gt;Does transfer learning (presumably)&lt;/td&gt;
&lt;td class="org-left"&gt;None found, but here's the signatures for the &lt;a href="https://docs.fast.ai/learner.html#transfer-learning"&gt;freeze and unfreeze methods&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-left"&gt;&lt;code&gt;no_bar&lt;/code&gt;&lt;/td&gt;
&lt;td class="org-left"&gt;Turn off the progress bar.&lt;/td&gt;
&lt;td class="org-left"&gt;&lt;a href="https://docs.fast.ai/callback.progress.html#no_bar"&gt;docstring&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;
&lt;br&gt;
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;cat_model&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;no_bar&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;cat_model&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fine_tune&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre class="example"&gt;
[0, 0.17085878551006317, 0.019044965505599976, 0.005412719678133726, '00:20']
[0, 0.05584857985377312, 0.01942548155784607, 0.0067658997140824795, '00:25']
&lt;/pre&gt;



&lt;p&gt;
Fastai really seems to want to force you to use their system the way they do - the output from &lt;code&gt;fine_tune&lt;/code&gt; is printed to standard out and not returned as some kind of object so I can't re-format it to make it nicer looking here (using org-mode), but for reference, the columns for the two rows of output are:
&lt;/p&gt;

&lt;ul class="org-ul"&gt;
&lt;li&gt;epoch&lt;/li&gt;
&lt;li&gt;train_loss&lt;/li&gt;
&lt;li&gt;valid_loss&lt;/li&gt;
&lt;li&gt;error_rate&lt;/li&gt;
&lt;li&gt;time&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
Given these labels, the output of the last block shows that the error rate for the second epoch was 0.005, and it took about twenty and twenty-five seconds per epoch.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org0c483bb" class="outline-2"&gt;
&lt;h2 id="org0c483bb"&gt;Some Test Images&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org0c483bb"&gt;
&lt;p&gt;
We're going to apply our model to some images of cats and a dog to see what it tells us about the image. Since it's the same process for each image I'll create a function &lt;code&gt;check_image&lt;/code&gt; to handle it.
&lt;/p&gt;

&lt;table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"&gt;


&lt;colgroup&gt;
&lt;col class="org-left"&gt;

&lt;col class="org-left"&gt;

&lt;col class="org-left"&gt;
&lt;/colgroup&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th scope="col" class="org-left"&gt;Object&lt;/th&gt;
&lt;th scope="col" class="org-left"&gt;Description&lt;/th&gt;
&lt;th scope="col" class="org-left"&gt;Documentation&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td class="org-left"&gt;&lt;code&gt;PILImage&lt;/code&gt;&lt;/td&gt;
&lt;td class="org-left"&gt;Object to represent images.&lt;/td&gt;
&lt;td class="org-left"&gt;&lt;a href="https://docs.fast.ai/vision.core.html#pilimage"&gt;docstring&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="org-left"&gt;&lt;code&gt;create&lt;/code&gt;&lt;/td&gt;
&lt;td class="org-left"&gt;Load the image as PILImage&lt;/td&gt;
&lt;td class="org-left"&gt;&lt;a href="https://docs.fast.ai/vision.core.html#load_image"&gt;load_image&lt;/a&gt;, &lt;a href="https://docs.fast.ai/vision.core.html#pilimage"&gt;PILBase&lt;/a&gt; (follow source link to see definition of &lt;code&gt;create&lt;/code&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;
&lt;br&gt;
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;check_image&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="sd"&gt;"""Loads the image and checks if it's a cat&lt;/span&gt;

&lt;span class="sd"&gt;    Args:&lt;/span&gt;
&lt;span class="sd"&gt;     path: string with path to the image&lt;/span&gt;
&lt;span class="sd"&gt;    """&lt;/span&gt;
    &lt;span class="n"&gt;POSITIVE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;NEGATIVE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;" think"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;" don't think"&lt;/span&gt;

    &lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;PILImage&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;expanduser&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;

    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;cat_model&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;no_bar&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
	&lt;span class="n"&gt;ees_cat&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;probablilities&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cat_model&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;predict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;"I&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;POSITIVE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ees_cat&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="s1"&gt;'True'&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NEGATIVE&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; this is a cat."&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;"The probability that it's a cat is &lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;probablilities&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="si"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;.2f&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;


&lt;div id="outline-container-orgeae752d" class="outline-3"&gt;
&lt;h3 id="orgeae752d"&gt;A Cat&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-orgeae752d"&gt;
&lt;p&gt;
Here's our first test image.
&lt;/p&gt;


&lt;div id="orgb8e0329" class="figure"&gt;
&lt;p&gt;&lt;img src="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/test-cat.jpg" alt="test-cat.jpg"&gt;
&lt;/p&gt;
&lt;/div&gt;


&lt;p&gt;
As you can see, it appears to be ridden with parasites, causing it to scratch uncontrollably (the toxoplasma isn't visible but assumed) -let's see how our classifier does at guessing that it's a cat.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;check_image&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"~/test-cat.jpg"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre class="example"&gt;
I think this is a cat.
The probability that it's a cat is 1.00
&lt;/pre&gt;


&lt;p&gt;
So, it's pretty sure that this is a cat.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgcdc6054" class="outline-3"&gt;
&lt;h3 id="orgcdc6054"&gt;A Negative Test Image&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-orgcdc6054"&gt;
&lt;p&gt;
We could try any image, but for now, since the dataset used dogs and cats, let's see if it thinks a dog is a cat.
&lt;/p&gt;



&lt;div id="org7f97874" class="figure"&gt;
&lt;p&gt;&lt;img src="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/test-dog.jpg" alt="test-dog.jpg"&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;check_image&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"~/test-dog.jpg"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre class="example"&gt;
I don't think this is a cat.
The probability that it's a cat is 0.00
&lt;/pre&gt;


&lt;p&gt;
It's sure that this isn't a cat.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgb02076a" class="outline-3"&gt;
&lt;h3 id="orgb02076a"&gt;A Strange Cat&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-orgb02076a"&gt;
&lt;p&gt;
I tried to find images of cats that looked like dogs or vice-versa, but it turns out that they're pretty different looking things, so let's just try an unusual looking cat.
&lt;/p&gt;


&lt;div id="orgacf48aa" class="figure"&gt;
&lt;p&gt;&lt;img src="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/elf-cat.jpg" alt="elf-cat.jpg"&gt;
&lt;/p&gt;
&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;check_image&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"~/elf-cat.jpg"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre class="example"&gt;
I think this is a cat.
The probability that it's a cat is 1.00
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgbc002ac" class="outline-2"&gt;
&lt;h2 id="orgbc002ac"&gt;The End&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgbc002ac"&gt;
&lt;p&gt;
So there you go, not really exciting, which I suppose is sort of the point of fastai - it should be simple, almost boring, to do image classification. This is just a rehash of what they did, of course, a better check would be to try something different, but since this is the first take it'll have to do for now.
&lt;/p&gt;

&lt;p&gt;
The top post for the quickstart posts is &lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-quickstart/"&gt;this one&lt;/a&gt; and the next post will be on &lt;a href="https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-quickstart-segmentation/"&gt;Image Segmentation&lt;/a&gt;.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgda8bee9" class="outline-2"&gt;
&lt;h2 id="orgda8bee9"&gt;Sources&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgda8bee9"&gt;
&lt;/div&gt;
&lt;div id="outline-container-org5e7bddb" class="outline-3"&gt;
&lt;h3 id="org5e7bddb"&gt;Fast AI&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org5e7bddb"&gt;
&lt;ul class="org-ul"&gt;
&lt;li&gt;&lt;a href="https://docs.fast.ai/quick_start.html"&gt;The Quickstart&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org85d0868" class="outline-3"&gt;
&lt;h3 id="org85d0868"&gt;Test Images (Wikimedia commons)&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org85d0868"&gt;
&lt;ul class="org-ul"&gt;
&lt;li&gt;&lt;a href="https://commons.wikimedia.org/wiki/File:Golden_Retriever_Hund_Dog.JPG"&gt;Golden Retriever&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://commons.wikimedia.org/wiki/File:Cat_scratching.jpg"&gt;Cat Scratching&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://commons.wikimedia.org/wiki/File:Elf1111111.jpg"&gt;Elf Cat&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description><category>classification</category><category>fastai</category><guid>https://necromuralist.github.io/Neurotic-Networking/posts/fastai/fastai-cats-and-dogs/index.html</guid><pubDate>Wed, 26 Oct 2022 00:50:22 GMT</pubDate></item></channel></rss>